import{j as e,r as x,b as f,u as N,d as C}from"./main-76766219.js";import{S as D,P as v}from"./PaginationControls-913b090a.js";import{L as V}from"./Layout-6c58fe9b.js";import{f as y}from"./formatting-345d2430.js";import{A as P,D as S,C as T,a as I,F as O,P as A}from"./Payments-d37a65ef.js";import{l as B,u as b}from"./index-7202a5e9.js";import{M as p}from"./Modal-fcea6098.js";import"./Button-28ce796a.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-2ac7fbcb.js";import"./index-f332af68.js";import"./MultipleUpload-43545023.js";import"./search-b580d3c8.js";import"./index-34f41ab4.js";function E({creditorViewProps:{showModal:r,hideCreditorView:h,data:o,error:c,isLoading:m,clientId:s,refreshCreditorViewData:n,lease:i,creditorName:d}}){const _=!o;return e.jsx(e.Fragment,{children:e.jsxs(p,{show:r,onHide:h,fullscreen:!0,contentClassName:"custom-bg-whitesmoke",children:[e.jsx(p.Header,{className:"p-0",children:e.jsxs("div",{className:"w-100 p-2 text-center bg-secondary position-relative",children:[e.jsx("h4",{className:"text-white",children:m||c||_?"Creditor View":o.tenantName||"Creditor View"}),e.jsx("button",{type:"button",onClick:h,className:"btn position-absolute top-0 end-0 h-100 d-flex align-items-center text-white",children:e.jsx("i",{className:"material-icons fs-3 px-4",children:"close"})})]})}),e.jsx(p.Body,{children:e.jsxs("div",{className:"position-relative custom-mn-h-5",children:[m&&e.jsxs("div",{className:"text-center position-absolute top-50 start-50 translate-middle",children:[e.jsx("div",{className:"spinner-border text-info spinner-border-md",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{children:"Loading...please wait"})]}),c&&e.jsxs("div",{className:"text-center text-danger position-absolute top-50 start-50 translate-middle",children:[e.jsx("p",{children:e.jsx("i",{className:"material-icons fs-1",children:"warning"})}),e.jsxs("p",{children:["Error: ",B.truncate(c,{length:500})]})]}),!(m||c||_)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row row-cols-3 align-items-stretch",children:[e.jsxs("div",{className:"col p-1",children:[e.jsx(P,{isCreditorView:!0,data:o.agedAnalysis}),e.jsx(S,{isCreditorView:!0,data:o.debtorIntelligence,clientId:s}),e.jsx(T,{isCreditorView:!0,data:o.contactDetails,clientId:s})]}),e.jsx("div",{className:"col p-1",children:e.jsx(I,{isCreditorView:!0,messages:o.communicationHistory,clientId:s,lease:i,creditorId:s})}),e.jsxs("div",{className:"col p-1",children:[e.jsx(O,{isCreditorView:!0,data:o.forecastInflows}),e.jsx(A,{isCreditorView:!0,clientId:s,paymentPlans:o.paymentPlans,refreshClientViewData:n,creditorName:d})]})]})})]})})]})})}function F(){const[r,h]=x.useState(!1),[o,c]=x.useState(null),[m,s]=x.useState(""),[n,i]=x.useState(!1),[d,_]=x.useState(null);function w(t){_(t),h(!0),i(!0),s(""),f(reverseUrl("creditor_details"),{params:{creditor_id:t.creditor_id}}).then(a=>{const l={isCreditorView:!0,tenantName:t.creditor_name,agedAnalysis:{oneTwentyDays:a.data.aged_analysis["120_days_plus"],ninetyDays:a.data.aged_analysis["90_days"],sixtyDays:a.data.aged_analysis["60_days"],thirtyDays:a.data.aged_analysis["30_days"],current:a.data.aged_analysis.current},contactDetails:{contactPerson:`${a.data.creditor.firstname} ${a.data.creditor.surname}`,smsNumber:a.data.creditor.sms_number,otherNumbers:a.data.other_numbers?a.data.creditor.other_numbers.join(", "):"",emailAddress:a.data.creditor.email,address:a.data.creditor.address},paymentPlans:a.data.payment_plans.map(u=>({id:u.id,person:u.spoke_with,date:u.expected_pay_date,amount:u.amount})),communicationHistory:a.data.communication_history.map(u=>({text:u.message,timestamp:u.created_at,user:u.user_name,actionDone:u.action_done?u.action_done:null,communicationType:u.type})),debtorIntelligence:Object.values(a.data.debtor_intelligence).length&&Object.values(a.data.debtor_intelligence).every(Boolean)?{text:a.data.debtor_intelligence.note,timestamp:a.data.debtor_intelligence.updated_at,user:a.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:a.data.forecast_inflows["0-7"],eightToFourteenDays:a.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:a.data.forecast_inflows["14-21"],twentyOnePlusDays:a.data.forecast_inflows["21+"],total:a.data.forecast_inflows.total}};console.log({res:a,resData:l}),c(l),s(""),i(!1)}).catch(a=>{s(b(a)),c(null),i(!1)})}function j(){console.log("refreshing.."),i(!0),s(""),f(reverseUrl("creditor_details"),{params:{creditor_id:d.creditor_id}}).then(t=>{const a={isCreditorView:!0,tenantName:d.creditor_name,agedAnalysis:{oneTwentyDays:t.data.aged_analysis["120_days_plus"],ninetyDays:t.data.aged_analysis["90_days"],sixtyDays:t.data.aged_analysis["60_days"],thirtyDays:t.data.aged_analysis["30_days"],current:t.data.aged_analysis.current},contactDetails:{contactPerson:`${t.data.creditor.firstname} ${t.data.creditor.surname}`,smsNumber:t.data.creditor.sms_number,otherNumbers:t.data.other_numbers?t.data.creditor.other_numbers.join(", "):"",emailAddress:t.data.creditor.email,address:t.data.creditor.address},paymentPlans:t.data.payment_plans.map(l=>({id:l.id,person:l.spoke_with,date:l.expected_pay_date,amount:l.amount})),communicationHistory:t.data.communication_history.map(l=>({text:l.message,timestamp:l.created_at,user:l.user_name,actionDone:l.action_done?l.action_done:null,communicationType:l.type})),debtorIntelligence:Object.values(t.data.debtor_intelligence).length&&Object.values(t.data.debtor_intelligence).every(Boolean)?{text:t.data.debtor_intelligence.note,timestamp:t.data.debtor_intelligence.updated_at,user:t.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:t.data.forecast_inflows["0-7"],eightToFourteenDays:t.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:t.data.forecast_inflows["14-21"],twentyOnePlusDays:t.data.forecast_inflows["21+"],total:t.data.forecast_inflows.total}};c(a),s(""),i(!1)}).catch(t=>{s(b(t)),c(null),i(!1)})}function g(){h(!1)}return console.log(d),{data:o,error:m,isLoading:n,showModal:r,lease:d,clientId:d?d.creditor_id:null,refreshCreditorViewData:j,openCreditorView:w,hideCreditorView:g,creditorName:d?d.creditor_name:""}}function k(r,h,o,c){const m=new URL(N().url).searchParams.get("open_view_for");x.useEffect(()=>{const i=r.find(d=>d.lease_id==m);i&&s.openCreditorView(i)},[m]);const s=F(),n=r.reduce((i,d)=>i+d.balance_owed,0);return console.log({allState:{creditors:r,current_page:h,total_pages:o,total_items:c,balanceTotal:n}}),{balanceTotal:n,creditorViewProps:s}}function H({creditors:r,current_page:h,total_pages:o,total_items:c}){const{balanceTotal:m,creditorViewProps:s}=k(r,h,o,c);return e.jsxs("div",{children:[e.jsx(E,{creditorViewProps:s}),e.jsx("div",{className:"col-4 pb-3",children:e.jsx(D,{searchBy:"search",placeholder:"Search..."})}),e.jsx("h5",{className:"bg-danger text-center text-white p-2 mb-4 rounded-2",children:"CREDITOR SUMMARY"}),e.jsxs("table",{className:"table table-bordered table-responsive table-sm c-fs-small",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"c-thead-bg rounded-2",children:[e.jsx("th",{children:"Creditor ID"}),e.jsx("td",{children:"Creditor Name "}),e.jsx("td",{className:"text-end",children:"Balance Owed"}),e.jsx("td",{className:"text-end bg-white"})]})}),!!r.length&&e.jsxs(e.Fragment,{children:[e.jsx("tbody",{children:r.map((n,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.creditor_id}),e.jsx("td",{children:e.jsx("button",{type:"button",title:"double click for communication history",className:"custom-btn text-decoration-underline",onDoubleClick:()=>s.openCreditorView(n),children:n.creditor_name})}),e.jsx("td",{className:"text-end px-3",children:Number(n.balance_owed)>=0?y(Number(n.balance_owed)):`(${y(Number(n.balance_owed)*-1)})`}),e.jsx("td",{className:"bg-info text-center",style:{fontWeight:"500",fontSize:"16px",color:"white",cursor:"pointer"},onClick:()=>C.Inertia.visit(reverseUrl("detailed_creditor_statement",n.creditor_id),{data:{lease_id:n.lease_id}}),children:"View"})]},n.creditor_id+" - "+i))}),e.jsx("tfoot",{className:"fw-bold c-fs-18",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Total"}),e.jsx("td",{}),e.jsx("td",{className:"text-end",children:m>=0?y(m):`(${y(m*-1)})`}),e.jsx("td",{})]})})]})]}),!r.length&&e.jsx("div",{className:"custom-h-4 d-flex justify-content-center align-items-center border border-2",children:"Nothing to show"}),e.jsx("div",{className:"px-3",children:e.jsx(v,{currentPage:h||1,totalPages:o||1})})]})}H.layout=r=>e.jsx(V,{children:r,title:"Creditor Statements"});export{H as default};
