var F=Object.defineProperty,L=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var D=(a,d,l)=>d in a?F(a,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[d]=l,c=(a,d)=>{for(var l in d||(d={}))$.call(d,l)&&D(a,l,d[l]);if(R)for(var l of R(d))Z.call(d,l)&&D(a,l,d[l]);return a},i=(a,d)=>L(a,O(d));var M=(a,d,l)=>new Promise((m,_)=>{var h=p=>{try{x(l.next(p))}catch(u){_(u)}},S=p=>{try{x(l.throw(p))}catch(u){_(u)}},x=p=>p.done?m(p.value):Promise.resolve(p.value).then(h,S);x((l=l.apply(a,d)).next())});import{u as B,r as g,j as t,b as k}from"./main-b0023e79.js";import{h as N}from"./moment-686b5dfa.js";import{f as C}from"./formatting-345d2430.js";import{L as G}from"./Layout-4b440c51.js";import{I as P,_ as I}from"./index-75883b0c.js";const W=()=>{const{tenant_list:a}=B().props,{errors:d}=B().props,l=a!=null&&a.length?a.filter(e=>e.lease_currency_type.toUpperCase()==="USD"):[];console.log("usdInvoices",l);const m=a!=null&&a.length?a.filter(e=>e.lease_currency_type.toUpperCase()==="ZWG"):[],[_,h]=g.useState(l!=null&&l.length?l.reduce((e,r)=>e+Number(r.owing_amount),0):0),[S,x]=g.useState(m!=null&&m.length?m.reduce((e,r)=>e+Number(r.owing_amount),0):0),[p,u]=g.useReducer(H,l.map(e=>i(c({},e),{invoice_date:`${e==null?void 0:e.payment_period_start}-${N().format("MM-YYYY")}`||"",edited:!1,total:(e==null?void 0:e.owing_amount)||"",operationalCosts:""}))),[j,w]=g.useReducer(E,m.map(e=>i(c({},e),{invoice_date:`${e==null?void 0:e.payment_period_start}-${N().format("MM-YYYY")}`||"",edited:!1,total:(e==null?void 0:e.owing_amount)||"",operationalCosts:""}))),[A,Y]=g.useState(d),[z,T]=g.useState(!1);function H(e,r){switch(r.type){case"updateBaseRental":let o=e.map(s=>s.id===r.id?i(c({},s),{owing_amount:r.owing_amount,edited:!0,total:Number(s.operationalCosts)+Number(r.owing_amount)}):s);return h(o.reduce((s,n)=>s+Number(n.total),0)),o;case"updateInvDate":let f=e.map(s=>s.id===r.id?i(c({},s),{invoice_date:r.invoice_date,edited:!0}):s);return h(f.reduce((s,n)=>s+Number(n.total),0)),f;case"updateOperatingCosts":let y=e.map(s=>s.id===r.id?i(c({},s),{edited:!0,operationalCosts:r.operationalCosts,total:Number(s.owing_amount)+Number(r.operationalCosts)}):s);return h(y.reduce((s,n)=>s+Number(n.total),0)),y;case"filterSubmittedInvoices":let b=e.filter(s=>!r.idsToFilter.includes(s.id));return h(b.reduce((s,n)=>s+Number(n.total),0)),b;default:return e}}function E(e,r){switch(r.type){case"updateBaseRental":let o=e.map(s=>s.id===r.id?i(c({},s),{owing_amount:r.owing_amount,edited:!0,total:Number(s.operationalCosts)+Number(r.owing_amount)}):s);return x(o.reduce((s,n)=>s+Number(n.total),0)),o;case"updateInvDate":let f=e.map(s=>s.id===r.id?i(c({},s),{invoice_date:r.invoice_date,edited:!0}):s);return h(f.reduce((s,n)=>s+Number(n.total),0)),f;case"updateOperatingCosts":let y=e.map(s=>s.id===r.id?i(c({},s),{edited:!0,operationalCosts:r.operationalCosts,total:Number(s.owing_amount)+Number(r.operationalCosts)}):s);return x(y.reduce((s,n)=>s+Number(n.total),0)),y;case"filterSubmittedInvoices":let b=e.filter(s=>!r.idsToFilter.includes(s.id));return x(b.reduce((s,n)=>s+Number(n.total),0)),b;default:return e}}const U=()=>M(void 0,null,function*(){Y({});const e=[],r=[];if(T(!0),p.forEach(o=>{o.edited&&(e.push({leaseId:o.id,invoiceDate:o.invoice_date,baseRental:o.owing_amount,operationCosts:o.operationalCosts}),r.push(o.id))}),j.forEach(o=>{o.edited&&(e.push({leaseId:o.id,invoiceDate:o.invoice_date,baseRental:o.owing_amount,operationCosts:o.operationalCosts}),r.push(o.id))}),e.length===0){T(!1),I.error("No changes were made, please edit at least one invoice",{icon:"❌",duration:5e3});return}try{console.log("data",e);const o=yield k.post(reverseUrl("client_invoice"),e);u({type:"filterSubmittedInvoices",idsToFilter:r}),w({type:"filterSubmittedInvoices",idsToFilter:r}),I.success("Invoice created successfully",{icon:"✔"})}catch(o){I.error("Something went wrong! Please try again",{icon:"❌"}),Y(o.response.data.errors)}finally{T(!1)}});return t.jsxs("div",{className:"card card-raised mt-3 mb-5 mx-4",children:[t.jsxs("div",{className:"card-header px-4 bg-info",style:{height:"50px"},children:[t.jsx(P,{position:"top-right"}),t.jsx("div",{className:"d-flex justify-content-center align-items-center",children:t.jsx("div",{className:"",children:t.jsxs("h2",{className:"display-6 text-white",children:["Rental Invoicing -"," ",N().date()>25?N().add(1,"months").format("MMMM YYYY"):N().format("MMMM YYYY")]})})})]}),t.jsxs("div",{className:"card-body p-4",children:[t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-bordered",children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderTop:"0px",lineHeight:"15px",fontSize:"12px"},children:[t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Inv. Date"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Lease No."}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Address"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Co. Reg. No. / ID No."}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Tenant Name"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Currency"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Base Rental"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Operating Costs"}),t.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Total"})]})}),t.jsxs("tbody",{children:[t.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:t.jsx("th",{scope:"row",children:"USD"})}),p!=null&&p.length?p.map(e=>t.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[t.jsx("th",{scope:"row",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.invoice_date,onChange:r=>u({type:"updateInvDate",id:e.id,invoice_date:r.target.value})})}),t.jsx("td",{children:e.id}),t.jsx("td",{children:e.address}),t.jsx("td",{children:e.reg_number}),t.jsx("td",{children:e.tenant_name}),t.jsx("td",{children:e.lease_currency_type}),t.jsx("td",{className:"text-end",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.owing_amount,onChange:r=>u({type:"updateBaseRental",id:e.id,owing_amount:r.target.value})})}),t.jsx("td",{className:"text-end",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.operationalCosts,onChange:r=>u({type:"updateOperatingCosts",id:e.id,operationalCosts:r.target.value})})}),t.jsx("td",{className:"text-end",children:C(e.total)})]},e.id)):"",t.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[t.jsx("td",{colSpan:7}),t.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),t.jsx("td",{className:"text-end fw-bold",children:C(_)})]}),t.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:t.jsx("th",{scope:"row",children:"ZWG"})}),j!=null&&j.length?j.map(e=>t.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[t.jsx("th",{scope:"row",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.invoice_date,onChange:r=>w({type:"updateInvDate",id:e.id,invoice_date:r.target.value})})}),t.jsx("td",{children:e.id}),t.jsx("td",{children:e.address}),t.jsx("td",{children:e.reg_number}),t.jsx("td",{children:e.tenant_name}),t.jsx("td",{children:e.lease_currency_type}),t.jsx("td",{className:"text-end",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.owing_amount,onChange:r=>w({type:"updateBaseRental",id:e.id,owing_amount:r.target.value})})}),t.jsx("td",{className:"text-end",children:t.jsx("input",{type:"text",className:"form-control form-control-sm",value:e.operationalCosts,onChange:r=>w({type:"updateOperatingCosts",id:e.id,operationalCosts:r.target.value})})}),t.jsx("td",{className:"text-end",children:C(e.total)})]},e.id)):"",t.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[t.jsx("td",{colSpan:7}),t.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),t.jsx("td",{className:"text-end fw-bold",children:C(S)})]})]})]})}),t.jsx("div",{className:"d-flex justify-content-end",children:t.jsx("button",{onClick:U,className:"btn btn-info",children:z?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner-grow spinner-grow-sm"}),t.jsx("span",{className:"ml-2",children:"processing.."})]}):t.jsx(t.Fragment,{children:"Submit"})})})]})]})};W.layout=a=>t.jsx(G,{children:a,title:"Tenant Invoicing"});export{W as default};
