var ke=Object.defineProperty,Me=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var fe=Math.pow,xe=(o,l,t)=>l in o?ke(o,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[l]=t,_=(o,l)=>{for(var t in l||(l={}))pe.call(l,t)&&xe(o,t,l[t]);if(ae)for(var t of ae(l))be.call(l,t)&&xe(o,t,l[t]);return o},C=(o,l)=>Me(o,Oe(l));var ne=(o,l)=>{var t={};for(var i in o)pe.call(o,i)&&l.indexOf(i)<0&&(t[i]=o[i]);if(o!=null&&ae)for(var i of ae(o))l.indexOf(i)<0&&be.call(o,i)&&(t[i]=o[i]);return t};var te=(o,l,t)=>new Promise((i,b)=>{var x=n=>{try{u(t.next(n))}catch(d){b(d)}},h=n=>{try{u(t.throw(n))}catch(d){b(d)}},u=n=>n.done?i(n.value):Promise.resolve(n.value).then(x,h);u((t=t.apply(o,l)).next())});import{b as H,r as m,j as e,a as se,u as ye,R as Ie}from"./main-c733e0a6.js";import"./PageHeader-2f341a06.js";import{C as ve,L as Ae}from"./Layout-fc6cdcd4.js";import{h as E}from"./moment-686b5dfa.js";import{_ as T,I as de}from"./index-9075d868.js";import{R as ce}from"./Receipt-46280682.js";import{f as ie}from"./formatting-345d2430.js";import{M as we}from"./MultipleUpload-fe6dd977.js";import{b as Le,d as Ye,F as Re,u as me,a as De,c as he,C as Fe,M as L}from"./Modal-66bffea1.js";import{S as Ve}from"./search-2c258a90.js";import{B as re}from"./Button-d202d9bf.js";import{B as He,D as $e}from"./DrawerContent-12c2d01f.js";import{E as Ue,e as Ge}from"./removeClass-a7e4e9d4.js";import{S as qe,P as ze}from"./PaginationControls-0ffac7d7.js";import{l as K}from"./lodash-0b022a9a.js";import{f as le,b as Se}from"./index-941ba0b5.js";import"./assertThisInitialized-3be3daa4.js";import"./index-9c877fc7.js";import"./Button-8e76e8f9.js";const{Axios:Vt,AxiosError:X,CanceledError:Ht,isCancel:$t,CancelToken:Ut,VERSION:Gt,all:qt,Cancel:zt,isAxiosError:Jt,spread:Wt,toFormData:Zt,AxiosHeaders:Xt,HttpStatusCode:Kt,formToJSON:Qt,getAdapter:ea,mergeConfig:ta}=H,oe=fe(2,31)-1;function Te(o,l,t){const i=t-Date.now();o.current=i<=oe?setTimeout(l,i):setTimeout(()=>Te(o,l,t),oe)}function Je(){const o=Le(),l=m.useRef();return Ye(()=>clearTimeout(l.current)),m.useMemo(()=>{const t=()=>clearTimeout(l.current);function i(b,x=0){o()&&(t(),x<=oe?l.current=setTimeout(b,x):Te(l,b,Date.now()+x))}return{set:i,clear:t,handleRef:l}},[])}const We={[Ue]:"showing",[Ge]:"showing show"},_e=m.forwardRef((o,l)=>e.jsx(Re,C(_({},o),{ref:l,transitionClasses:We})));_e.displayName="ToastFade";const Ze=_e,Xe=m.createContext({onClose(){}}),Ce=Xe,Pe=m.forwardRef((n,u)=>{var d=n,{bsPrefix:o,closeLabel:l="Close",closeVariant:t,closeButton:i=!0,className:b,children:x}=d,h=ne(d,["bsPrefix","closeLabel","closeVariant","closeButton","className","children"]);o=me(o,"toast-header");const c=m.useContext(Ce),w=De(N=>{c==null||c.onClose==null||c.onClose(N)});return e.jsxs("div",C(_({ref:u},h),{className:he(o,b),children:[x,i&&e.jsx(Fe,{"aria-label":l,variant:t,onClick:w,"data-dismiss":"toast"})]}))});Pe.displayName="ToastHeader";const Ke=Pe,Be=m.forwardRef((x,b)=>{var h=x,{className:o,bsPrefix:l,as:t="div"}=h,i=ne(h,["className","bsPrefix","as"]);return l=me(l,"toast-body"),e.jsx(t,_({ref:b,className:he(o,l)},i))});Be.displayName="ToastBody";const Qe=Be,Ee=m.forwardRef((Y,g)=>{var R=Y,{bsPrefix:o,className:l,transition:t=Ze,show:i=!0,animation:b=!0,delay:x=5e3,autohide:h=!1,onClose:u,onEntered:n,onExit:d,onExiting:c,onEnter:w,onEntering:N,onExited:a,bg:s}=R,r=ne(R,["bsPrefix","className","transition","show","animation","delay","autohide","onClose","onEntered","onExit","onExiting","onEnter","onEntering","onExited","bg"]);o=me(o,"toast");const P=m.useRef(x),M=m.useRef(u);m.useEffect(()=>{P.current=x,M.current=u},[x,u]);const O=Je(),S=!!(h&&i),k=m.useCallback(()=>{S&&(M.current==null||M.current())},[S]);m.useEffect(()=>{O.set(k,P.current)},[O,k]);const v=m.useMemo(()=>({onClose:u}),[u]),V=!!(t&&b),$=e.jsx("div",C(_({},r),{ref:g,className:he(o,l,s&&`bg-${s}`,!V&&(i?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return e.jsx(Ce.Provider,{value:v,children:V&&t?e.jsx(t,{in:i,onEnter:w,onEntering:N,onEntered:n,onExit:d,onExiting:c,onExited:a,unmountOnExit:!0,children:$}):$})});Ee.displayName="Toast";const Ne=Object.assign(Ee,{Body:Qe,Header:Ke});function et(o,l){const[t,i]=m.useState(o);return m.useEffect(()=>{const b=setTimeout(()=>{i(o)},l);return()=>{clearTimeout(b)}},[o,l]),t}function tt(o,l,t,i,b){const[x,h]=m.useState(!1),[u,n]=m.useState(""),[d,c]=m.useState(!1),[w,N]=m.useState({}),[a,s]=m.useState("single"),{data:r,setData:g,post:Y,reset:R}=se({identificationNumber:(t==null?void 0:t.reg_ID_Number)||"",lesseeName:(t==null?void 0:t.name)||"",lesseeAddress:(t==null?void 0:t.address)||"",lesseePhone:(t==null?void 0:t.mobile)||"",leaseDetails:(t==null?void 0:t.lease_details)||"",leaseStartDate:(t==null?void 0:t.start_date)||"",leaseEndDate:(t==null?void 0:t.end_date)||"",leaseCurrency:(t==null?void 0:t.currency)||"USD",depositAmount:(t==null?void 0:t.deposit_amount)||0,leasePeriod:i||(t==null?void 0:t.lease_period),rentVariable:(t==null?void 0:t.rent_variable)||!1,depositPeriod:(t==null?void 0:t.deposit_period)||0,monthlyRental:(t==null?void 0:t.monthly_rentals)||0,paymentPeriodStart:(t==null?void 0:t.payment_period_start)||"25",paymentPeriodEnd:(t==null?void 0:t.payment_period_end)||"7",isCompany:!1,leaseId:(t==null?void 0:t.lease_id)||-1,monthOneBalance:"",monthTwoBalance:"",monthThreeBalance:"",moreThanThreeMonthsBalance:"",currentBalance:"",landlordType:"INDIVIDUAL",regIdNumber:"",landlordName:"",commission:0}),P=E(),M=P.clone().add(r.paymentPeriodEnd>=P.date()?0:1,"months").date(r.paymentPeriodEnd).format("DD-MMM-YY"),O=P.clone().subtract(r.paymentPeriodEnd>=P.date()?1:0,"months").date(r.paymentPeriodEnd).format("DD-MMM-YY"),S=P.clone().subtract(r.paymentPeriodEnd>=P.date()?2:1,"months").date(r.paymentPeriodEnd).format("DD-MMM-YY"),k=P.clone().subtract(r.paymentPeriodEnd>=P.date()?3:2,"months").date(r.paymentPeriodEnd).format("DD-MMM-YY"),v=et(r.identificationNumber,500),V=m.useCallback(()=>{if(v&&v.length>=5)try{h(!0),H.post(reverseUrl("get-user"),{identificationNumber:r.identificationNumber}).then(f=>{var y,A,D,G,F,Z,z,j;(y=f.data)!=null&&y.props.name?(g(C(_({},r),{lesseeName:((A=f.data)==null?void 0:A.props.name)||"",lesseeAddress:((D=f.data)==null?void 0:D.props.address)||"",lesseePhone:((G=f.data)==null?void 0:G.props.phone)||""})),N((Z=(F=f.data)==null?void 0:F.props)==null?void 0:Z.openingBalances)):((r.identificationNumber.length===6||r.identificationNumber.length>7)&&T.error("User not found!",{duration:4e3,id:"error-toast",icon:"❌"}),n((j=(z=f.data)==null?void 0:z.props)==null?void 0:j.errors)),h(!1)}).catch(f=>{T.error("Something went wrong! Please try again"),n(f)}).finally(()=>{h(!1)})}catch(f){T.error("Something went wrong! Please try again"),n(f)}},[v]);m.useEffect(()=>{l==="add"&&V()},[l,V]),m.useEffect(()=>{if(r.leaseStartDate){const y=E(r.leaseStartDate);g(C(_({},r),{leaseEndDate:y}))}},[]);const $=f=>{f.target.id==="rentVariable"?g(C(_({},r),{[f.target.id]:f.target.checked})):f.target.id==="leasePeriod"?Number(f.target.value)>Number(i)?(T.error(`Lease period cannot be more than your subscription period (${i} months)`),g(C(_({},r),{[f.target.id]:i}))):g(C(_({},r),{[f.target.id]:f.target.value})):g(C(_({},r),{[f.target.id]:f.target.value}))},U=f=>te(this,null,function*(){if(f.preventDefault(),r.lesseeName===""){T.error("Please enter a valid lessee");return}r.leaseEndDate=E(r.leaseStartDate).add(r.leasePeriod,"months").format("YYYY-MM-DD"),r.leaseStartDate=E(r.leaseStartDate).format("YYYY-MM-DD"),r.monthOneBalance=Number(r.monthOneBalance),r.monthTwoBalance=Number(r.monthTwoBalance),r.monthThreeBalance=Number(r.monthThreeBalance),r.moreThanThreeMonthsBalance=Number(r.moreThanThreeMonthsBalance),r.currentBalance=Number(r.currentBalance),r.monthOneDate=E(O).format("YYYY-MM-DD"),r.monthTwoDate=E(S).format("YYYY-MM-DD"),r.monthThreeDate=E(k).format("YYYY-MM-DD"),r.currentDate=E(M).format("YYYY-MM-DD"),r.monthlyRental=Number(r.monthlyRental),r.depositAmount=r.depositAmount,r.depositPeriod=Number(r.depositPeriod),r.leasePeriod=Number(r.leasePeriod),r.outStandingBalance=r.moreThanThreeMonthsBalance+r.monthThreeBalance+r.monthTwoBalance+r.monthOneBalance+r.currentBalance,Y(reverseUrl("create-individual-lease"),{onStart:()=>{h(!0)},onSuccess:y=>{var D,G,F;const A=(D=y==null?void 0:y.props)==null?void 0:D.flash.message;A&&((G=y==null?void 0:y.props)==null?void 0:G.flash.type)==="success"?(o(),b(A,r.lesseeName)):A&&((F=y==null?void 0:y.props)==null?void 0:F.flash.type)==="error"&&T.error(A.message),R(),h(!1)},onError:y=>{T.error(f.message||"Something went wrong! Please try again"),n(f),h(!1)}})}),q=f=>{f.preventDefault(),r.leaseStartDate=E(r.leaseStartDate).format("YYYY-MM-DD"),r.leaseEndDate=E(r.leaseStartDate).add(r.leasePeriod,"months").format("YYYY-MM-DD"),Y(reverseUrl("client-edit-lease"),{onStart:()=>{h(!0)},onSuccess:y=>{var A,D;((A=y==null?void 0:y.props)==null?void 0:A.flash.type)==="success"?(o(),b("Lease updated successfully")):((D=y==null?void 0:y.props)==null?void 0:D.flash.type)==="error"&&T.error("An error occurred, please try again later"),h(!1)},onError:y=>{T.error("Something went wrong! Please try again"),n(y),h(!1)}})};function I(f){if(f.preventDefault,l==="add")U(f);else if(l==="edit")q(f);else throw new Error("Invalid action: "+l)}return{isSingleTab:a==="single",toggleTab:()=>{s(f=>f==="single"?"multiple":"single")},handleAddLease:U,handleUpdateLease:q,changeHandler:$,errors:u,monthThree:k,monthTwo:S,monthOne:O,currentDate:M,data:r,isLoading:x,showReceipt:d,viewReceipt:()=>c(!0),closeReceipt:()=>c(!1),handleSubmit:I,changeLandlordType:f=>g(y=>C(_({},y),{landlordType:f,regIdNumber:"",landlordName:""})),changeLandlord:f=>g(y=>C(_({},y),{landlordName:f.label.split(" - ")[0],regIdNumber:f.label.split(" - ")[1],landlordName:f.label.split(" - ")[0]}))}}function je({show:o,handleClose:l,action:t,lesseeDetails:i,subscriptionPeriod:b,handleShowAlert:x}){const{isSingleTab:h,toggleTab:u,changeHandler:n,errors:d,monthThree:c,monthTwo:w,monthOne:N,currentDate:a,data:s,isLoading:r,showReceipt:g,viewReceipt:Y,closeReceipt:R,handleSubmit:P,changeLandlordType:M,changeLandlord:O}=tt(l,t,i,b,x);return e.jsxs(L,{size:"lg",show:o,onHide:l,children:[e.jsxs(L.Header,{closeButton:!0,className:"card-header bg-transparent ps-0",children:[e.jsx("button",{className:`btn btn-sm ${h?"btn-info text-white":"btn-light"}`,onClick:u,children:"Single"}),e.jsx("button",{className:`btn btn-sm ${h?"btn-light":"btn-info text-white"}`,onClick:u,children:"Multiple"})]}),e.jsx(L.Body,{className:"p-0",children:h?e.jsxs("div",{className:"card card-raised",children:[e.jsx("div",{className:"card-header bg-info",children:e.jsx("h2",{className:"display-6 mb-0 text-white",children:t==="view"?"View Lease - Individual":t==="edit"?"Edit Lease - Individual":"Add Lease - Individual"})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h6",{className:"bg-info p-1 display-6 m-0 text-center text-white",children:"Lease details"}),e.jsxs("form",{className:"p-5 border border-2 border-info",onSubmit:P,children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx(de,{}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"National ID:"}),e.jsx("input",{value:s.identificationNumber,onChange:n,type:"text",required:!0,name:"identificationNumber",id:"identificationNumber",className:"form-control form-control-sm"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.identificationNumber})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lessee Name:"}),e.jsx("input",{value:s.lesseeName,onChange:n,type:"text",name:"lesseeName",required:!0,id:"lesseeName",className:"form-control form-control-sm",readOnly:!0}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.lesseeName})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lessee Mobile Number"}),e.jsx("input",{value:s.lesseePhone,onChange:n,type:"text",name:"lesseePhone",id:"lesseePhone",required:!0,className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.lesseePhone})]})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Address:"}),e.jsx("textarea",{value:s.lesseeAddress,onChange:n,type:"text",required:!!s.lesseeName,name:"lesseeAddress",id:"lesseeAddress",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.lesseeAddress})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Details:"}),e.jsx("textarea",{value:s.leaseDetails,onChange:n,name:"leaseDetails",id:"leaseDetails",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.leaseDetails})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Currency"}),e.jsxs("select",{value:s.leaseCurrency,onChange:n,id:"leaseCurrency",name:"leaseCurrency",className:"form-select form-select-sm",readOnly:t==="view",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"ZWG",children:"ZWG"})]}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.leaseCurrency})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Monthly Rental:"}),e.jsx("input",{value:s.monthlyRental===0?"":s.monthlyRental,placeholder:"enter monthly rental",onChange:n,type:"text",required:!!s.lesseeName,id:"monthlyRental",name:"monthlyRental",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.monthlyRental})]}),e.jsxs("div",{className:"mt-1 col-lg-4 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Variable Rent:"}),e.jsx("input",{checked:s.rentVariable,onChange:n,type:"checkbox",id:"rentVariable",name:"rentVariable",className:"form-check-input border-1 p-2 border-black"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.rentVariable})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Deposit Period(Months):"}),e.jsx("input",{value:s.depositPeriod===0?"":s.depositPeriod,placeholder:"enter deposit period",onChange:n,type:"text",id:"depositPeriod",name:"depositPeriod",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.depositPeriod})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Deposit Amount:"}),e.jsx("input",{value:s.depositAmount===0?"":s.depositAmount,placeholder:"enter deposit amount",onChange:n,type:"text",name:"depositAmount",id:"depositAmount",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.depositAmount})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Subs Months Remaining:"}),e.jsx("input",{value:s.leasePeriod,onChange:n,type:"number",id:"leasePeriod",name:"leasePeriod",className:"form-control form-control-sm"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.leasePeriod})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Start Date:"}),e.jsx("input",{value:s.leaseStartDate,onChange:n,type:"date",required:!!s.lesseeName,name:"leaseStartDate",id:"leaseStartDate",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.leaseStartDate})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease End Date:"}),e.jsx("span",{className:"form-control form-control-sm",children:s.leaseStartDate?E(s.leaseStartDate).add(s.leasePeriod,"months").subtract(1,"days").format("DD / MM / YYYY"):""}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.leaseEndDate})]}),e.jsxs("div",{className:"col-lg-4 mt-1",children:[e.jsx("label",{className:"form-label",children:"Payment Period Start Date:"}),e.jsx("input",{value:s.paymentPeriodStart,type:"number",id:"paymentPeriodStart",name:"paymentPeriodStart",className:"form-control form-control-sm",readOnly:!0,disabled:!0}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.paymentPeriodStart})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Payment Period End Date:"}),e.jsx("input",{value:s.paymentPeriodEnd,onChange:n,type:"number",min:"1",max:"31",required:!!s.lesseeName,name:"paymentPeriodEnd",id:"paymentPeriodEnd",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.paymentPeriodEnd})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-center p-2 fw-bolder h6 custom-bg-grey",children:"Agents"}),e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Landlord Type:"}),e.jsxs("select",{className:"form-select form-select-md",name:"landlordType",id:"landlordType",value:s.landlordType,disabled:t==="view",onChange:S=>M(S.target.value),children:[e.jsx("option",{value:"INDIVIDUAL",children:"Individual"}),e.jsx("option",{value:"COMPANY",children:"Company"})]}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.landlordType})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsxs("label",{htmlFor:"regIdNumber",className:"form-label",children:[s.landlordType==="COMPANY"?"Reg Number":"ID"," (or Name)",":"]}),e.jsx(ve,{onChange:S=>O(S),extraProps:{required:!1,id:"regIdNumber",className:"w-100",name:"regIdNumber"},defaultValue:t==="view"?s.regIdNumber:"",isDisabled:t==="view"||s.landlordType==="",useAlternateFetchOptions:{type:s.landlordType.toLowerCase()}},s.landlordType),d&&e.jsx("div",{className:"text-danger mt-1",children:d.idRegOrName})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{htmlFor:"landlordName",className:"form-label",children:"Landlord Name"}),e.jsx("input",{value:s.landlordName,name:"landlordName",id:"landlordName",className:"form-control form-control-md custom-no-pointer-events border border-2",readOnly:!0}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.landlordName})]}),e.jsxs("div",{className:"mt-2 col-lg-4",children:[e.jsx("label",{htmlFor:"commission",className:"form-label",children:"Commission %"}),e.jsx("input",{value:s.commission,onChange:n,type:"number",min:0,max:100,name:"commission",id:"commission",className:"form-control form-control-sm",readOnly:t==="view"}),d&&e.jsx("div",{className:"text-danger mt-1",children:d.commission})]})]})]}),t==="add"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-center p-2 fw-bolder h6 custom-bg-grey",children:"Opening Rent Balances"}),e.jsx("table",{className:"table table-responsive table-bordered",children:e.jsxs("tbody",{children:[e.jsxs("tr",{style:{lineHeight:"5px",fontSize:"12px"},children:[e.jsx("th",{scope:"row",className:"fw-bold",style:{lineHeight:"15px"},children:"Payment Date"}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:"More than 3 months"}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:c}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:w}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:N}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:a}),e.jsx("td",{className:"fw-bold",style:{lineHeight:"15px"},children:"Outstanding Balance"})]}),e.jsxs("tr",{style:{lineHeight:"5px",fontSize:"12px"},children:[e.jsx("th",{scope:"row",className:"fw-bold",children:"Amount"}),e.jsx("td",{className:"bg-black text-white",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"moreThanThreeMonthsBalance",name:"moreThanThreeMonthsBalance",onChange:n,value:s.moreThanThreeMonthsBalance})}),e.jsx("td",{className:"text-white bg-danger",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthThreeBalance",name:"monthThreeBalance",onChange:n,value:s.monthThreeBalance})}),e.jsx("td",{className:"text-white",style:{backgroundColor:"#f87171"},children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthTwoBalance",name:"monthTwoBalance",onChange:n,value:s.monthTwoBalance})}),e.jsx("td",{className:"text-white bg-warning",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthOneBalance",name:"monthOneBalance",onChange:n,value:s.monthOneBalance})}),e.jsx("td",{className:"text-white bg-success",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"currentBalance",name:"currentBalance",onChange:n,value:s.currentBalance})}),e.jsx("td",{className:`text-white d-flex align-items-center justify-content-center py-4 my-auto ${Number(s.moreThanThreeMonthsBalance)>0?"bg-black":Number(s.monthThreeBalance)>0?"bg-danger":Number(s.monthTwoBalance)>0?"bg-transperant":Number(s.monthOneBalance)>0?"bg-warning":"bg-success"}`,style:{backgroundColor:Number(s.monthTwoBalance)>0?"#f87171":""},children:ie(Number(s.moreThanThreeMonthsBalance)+Number(s.monthThreeBalance)+Number(s.monthTwoBalance)+Number(s.monthOneBalance)+Number(s.currentBalance)||0)})]})]})})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:t==="view"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-info text-white",onClick:Y,children:"Receipt"}),e.jsx("button",{className:"btn btn-success",onClick:l,children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:l,children:"Terminate"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"}),e.jsx("button",{className:"btn btn-info text-white",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"d-inline-block ml-2",children:"processing.."})]}):"Submit"})]})})]}),e.jsx(ce,{show:g,handleClose:R})]})]}):e.jsx(we,{type:"individual",actionType:"lease"})})]})}function at(o,l,t,i,b){const[x,h]=m.useState(!1),[u,n]=m.useState("single"),[d,c]=m.useState(""),[w,N]=m.useState(!1),{data:a,setData:s,post:r,reset:g}=se({identificationNumber:(t==null?void 0:t.reg_ID_Number)||"",lesseeName:(t==null?void 0:t.name)||"",lesseeAddress:(t==null?void 0:t.address)||"",mobile:(t==null?void 0:t.mobile)||"",email:(t==null?void 0:t.email)||"",rentGuarantorId:(t==null?void 0:t.rent_guarantor_id)||"",rentGuarantorIdType:(t==null?void 0:t.rent_guarantor_id_type)||"",rentGuarantorName:(t==null?void 0:t.rent_guarantor_name)||"",leaseDetails:(t==null?void 0:t.lease_details)||"",leaseStartDate:(t==null?void 0:t.start_date)||"",rentVariable:(t==null?void 0:t.rent_variable)||!1,leaseEndDate:(t==null?void 0:t.end_date)||"",leaseCurrency:(t==null?void 0:t.currency)||"USD",depositAmount:(t==null?void 0:t.deposit_amount)||0,leasePeriod:i||(t==null?void 0:t.lease_period),depositPeriod:(t==null?void 0:t.deposit_period)||0,monthlyRental:(t==null?void 0:t.monthly_rentals)||0,paymentPeriodStart:(t==null?void 0:t.payment_period_start)||"25",paymentPeriodEnd:(t==null?void 0:t.payment_period_end)||"7",isCompany:!0,leaseId:(t==null?void 0:t.lease_id)||-1,monthOneBalance:"",monthTwoBalance:"",monthThreeBalance:"",moreThanThreeMonthsBalance:"",currentBalance:"",isGovernment:!1,landlordType:"COMPANY",regIdNumber:"",landlordName:"",commission:0,accountNumber:""}),[Y,R]=m.useState(l==="edit"?a.lesseeName:""),[P,M]=m.useState(a.lesseeName),[O,S]=m.useState(a.email),[k,v]=m.useState(a.identificationNumber),[V,$]=m.useState(a.mobile),[U,q]=m.useState(a.lesseeAddress),I=E(),f=I.clone().add(a.paymentPeriodEnd>=I.date()?0:1,"months").date(a.paymentPeriodEnd).format("DD-MMM-YY"),y=I.clone().subtract(a.paymentPeriodEnd>=I.date()?1:0,"months").date(a.paymentPeriodEnd).format("DD-MMM-YY"),A=I.clone().subtract(a.paymentPeriodEnd>=I.date()?2:1,"months").date(a.paymentPeriodEnd).format("DD-MMM-YY"),D=I.clone().subtract(a.paymentPeriodEnd>=I.date()?3:2,"months").date(a.paymentPeriodEnd).format("DD-MMM-YY");m.useEffect(()=>{s(C(_({},a),{lesseeName:P,email:O,identificationNumber:String(k),mobile:V,lesseeAddress:U}))},[k,P,O,V,U]),m.useEffect(()=>{l==="add"&&(()=>{if(a.rentGuarantorId&&/^[\d]{8,9}[A-Za-z]{1}[\d]{2}$/.test(a.rentGuarantorId))try{h(!0),H.post(reverseUrl("get-user"),{identificationNumber:a.rentGuarantorId}).then(p=>{var B,J,Q,ee,ue;(B=p.data)!=null&&B.props.name?s(C(_({},a),{rentGuarantorName:((J=p.data)==null?void 0:J.props.name)||"",rentGuarantorIdType:((Q=p.data)==null?void 0:Q.props.identification_type)||""})):(T.error("User not found!",{duration:4e3,icon:"❌"}),c((ue=(ee=p.data)==null?void 0:ee.props)==null?void 0:ue.errors)),h(!1)}).catch(p=>{T.error("Something went wrong! Please try again"),c(p)}).finally(()=>{h(!1)})}catch(p){T.error("Something went wrong! Please try again"),c(p)}})()},[a.rentGuarantorId]);const G=j=>{j.target.id==="rentVariable"?s(C(_({},a),{[j.target.id]:j.target.checked})):j.target.id==="leasePeriod"?Number(j.target.value)>Number(i)?(T.error(`Lease period cannot be more than your subscription period (${i} months)`),s(C(_({},a),{[j.target.id]:i}))):s(C(_({},a),{[j.target.id]:j.target.value})):s(C(_({},a),{[j.target.id]:j.target.value}))},F=j=>te(this,null,function*(){if(j.preventDefault(),!a.lesseeName){T.error("Please add a valid lessee");return}h(!0),a.leaseEndDate=E(a.leaseStartDate).add(a.leasePeriod,"months").format("YYYY-MM-DD"),a.monthOneBalance=Number(a.monthOneBalance),a.monthTwoBalance=Number(a.monthTwoBalance),a.monthThreeBalance=Number(a.monthThreeBalance),a.moreThanThreeMonthsBalance=Number(a.moreThanThreeMonthsBalance),a.currentBalance=Number(a.currentBalance),a.monthOneDate=E(y).format("YYYY-MM-DD"),a.monthTwoDate=E(A).format("YYYY-MM-DD"),a.monthThreeDate=E(D).format("YYYY-MM-DD"),a.currentDate=E(f).format("YYYY-MM-DD"),a.monthlyRental=Number(a.monthlyRental),a.depositAmount=a.depositAmount,a.depositPeriod=Number(a.depositPeriod),a.leasePeriod=Number(a.leasePeriod),a.outStandingBalance=a.moreThanThreeMonthsBalance+a.monthThreeBalance+a.monthTwoBalance+a.monthOneBalance+a.currentBalance,r(reverseUrl("create-company-lease"),{onStart:()=>{h(!0)},onSuccess:p=>{var J,Q,ee;const B=(J=p==null?void 0:p.props)==null?void 0:J.flash.message;B&&((Q=p==null?void 0:p.props)==null?void 0:Q.flash.type)==="success"?(o(),g(),b(B,a.lesseeName)):B&&((ee=p==null?void 0:p.props)==null?void 0:ee.flash.type)==="error"&&T.error(B.message),h(!1)},onError:p=>{T.error(j.message||"Something went wrong! Please try again"),c(j),h(!1)}})}),Z=j=>{j.preventDefault(),a.leaseStartDate=E(a.leaseStartDate).format("YYYY-MM-DD"),r(reverseUrl("client-edit-lease"),{onStart:()=>{h(!0)},onSuccess:p=>{var B,J;((B=p==null?void 0:p.props)==null?void 0:B.flash.type)==="success"?(o(),b("Lease updated successfully")):((J=p==null?void 0:p.props)==null?void 0:J.flash.type)==="error"&&T.error("An error occurred, please try again"),h(!1)},onError:p=>{T.error("Something went wrong! Please try again"),c(p),h(!1)}})};function z(j){if(j.preventDefault,l==="add")F(j);else if(l==="edit")Z(j);else throw new Error("Invalid action: "+l)}return{isSingleTab:u==="single",isLoading:x,errors:d,showReceipt:w,data:a,value:Y,currentDate:f,monthOne:y,monthTwo:A,monthThree:D,handleSubmit:z,toggleTab:()=>{n(j=>j==="single"?"multiple":"single")},viewReceipt:()=>N(!0),closeReceipt:()=>N(!1),setValue:R,setClientName:M,setClientId:v,setMobileNo:$,setRegNumber:S,setAddress:q,changeHandler:G,changeLandlordType:j=>s(p=>C(_({},p),{landlordType:j,regIdNumber:"",landlordName:""})),changeLandlord:j=>s(p=>C(_({},p),{landlordName:j.label.split(" - ")[0],regIdNumber:j.label.split(" - ")[1],landlordName:j.label.split(" - ")[0]})),toggleIsGovernment:()=>s(j=>C(_({},j),{isGovernment:!j.isGovernment}))}}const ge=({show:o,handleClose:l,action:t,lesseeDetails:i,subscriptionPeriod:b,handleShowAlert:x})=>{const{isLoading:h,isSingleTab:u,errors:n,showReceipt:d,data:c,value:w,currentDate:N,monthOne:a,monthTwo:s,monthThree:r,handleSubmit:g,toggleTab:Y,setValue:R,setClientName:P,setClientId:M,setMobileNo:O,setRegNumber:S,setAddress:k,changeHandler:v,viewReceipt:V,closeReceipt:$,changeLandlordType:U,changeLandlord:q,toggleIsGovernment:I}=at(l,t,i,b,x);return e.jsxs(L,{size:"lg",show:o,onHide:l,children:[e.jsxs(L.Header,{closeButton:!0,className:"card-header bg-transparent ps-0",children:[e.jsx("button",{className:`btn btn-sm ${u?"btn-info text-white":"btn-light"}`,onClick:Y,children:"Single"}),e.jsx("button",{className:`btn btn-sm ${u?"btn-light":"btn-info text-white"}`,onClick:Y,children:"Multiple"})]}),e.jsx(L.Body,{className:"p-0",children:u?e.jsxs("div",{className:"card card-raised",children:[e.jsx("div",{className:"card-header bg-info",children:e.jsx("h2",{className:"display-6 mb-0 text-white",children:t==="view"?"View Lease - Company":t==="edit"?"Edit Lease - Company":"Add Lease - Company"})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h6",{className:"bg-info p-1 display-6 m-0 text-center text-white",children:"Lease details"}),e.jsxs("form",{className:"p-5 border border-2 border-info",onSubmit:g,children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx(de,{}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Company Name:"}),e.jsx(Ve,{from:"leases",delay:500,placeholder:"Company Name",value:w,setValue:R,url:reverseUrl("get_searched_companies"),type:"company",setAddress:k,setClientName:P,setRegNumber:S,setClientId:M,setMobileNo:O}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.identificationNumber})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Account Number:"}),e.jsx("input",{value:c.accountNumber,onChange:v,type:"text",name:"accountNumber",id:"accountNumber",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.accountNumber})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lessee Name:"}),e.jsx("input",{value:c.lesseeName,onChange:v,type:"text",name:"lesseeName",readOnly:!0,required:!0,id:"lesseeName",className:"form-control form-control-sm"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.lesseeName})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Email:"}),e.jsx("input",{value:c.email,onChange:v,type:"text",name:"email",required:!0,id:"email",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.email})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Mobile:"}),e.jsx("input",{value:c.mobile,onChange:v,type:"text",name:"mobile",required:!0,id:"mobile",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.mobile})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Rent Guarantor ID:"}),e.jsx("input",{value:c.rentGuarantorId,onChange:v,type:"text",name:"rentGuarantorId",id:"rentGuarantorId",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.rentGuarantorId})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Rent Guarantor Name:"}),e.jsx("input",{value:c.rentGuarantorName,onChange:v,type:"text",name:"rentGuarantorName",id:"rentGuarantorName",className:"form-control form-control-sm",readOnly:!0}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.rentGuarantorName})]}),e.jsxs("div",{className:"mt-1 col-lg-4 d-flex flex-column",children:[e.jsx("label",{htmlFor:"isGovernment",className:"form-label",children:"Government:"}),e.jsx("input",{checked:c.isGovernment,onChange:I,type:"checkbox",id:"isGovernment",name:"isGovernment",className:"form-check-input border-1 p-2 border-black",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.isGovernment})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Address:"}),e.jsx("textarea",{value:c.lesseeAddress,onChange:v,type:"text",required:!!c.lesseeName,name:"lesseeAddress",id:"lesseeAddress",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.lesseeAddress})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Details:"}),e.jsx("textarea",{value:c.leaseDetails,onChange:v,type:"text",name:"leaseDetails",id:"leaseDetails",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.leaseDetails})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Currency"}),e.jsxs("select",{value:c.leaseCurrency,onChange:v,id:"leaseCurrency",name:"leaseCurrency",className:"form-select form-select-sm",readOnly:t==="view",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"ZWG",children:"ZWG"})]}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.leaseCurrency})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Monthly Rental:"}),e.jsx("input",{value:c.monthlyRental===0?"":c.monthlyRental,placeholder:"enter monthly rental",onChange:v,type:"text",required:!!c.lesseeName,id:"monthlyRental",name:"monthlyRental",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.monthlyRental})]}),e.jsxs("div",{className:"mt-1 col-lg-4 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Variable Rent:"}),e.jsx("input",{checked:c.rentVariable,onChange:v,type:"checkbox",id:"rentVariable",name:"rentVariable",className:"form-check-input border-1 p-2 border-black",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.rentVariable})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Deposit Period(Months):"}),e.jsx("input",{value:c.depositPeriod===0?"":c.depositPeriod,placeholder:"enter deposit period",onChange:v,type:"text",id:"depositPeriod",name:"depositPeriod",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.depositPeriod})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Deposit Amount:"}),e.jsx("input",{value:c.depositAmount===0?"":c.depositAmount,placeholder:"enter deposit amount",onChange:v,type:"text",name:"depositAmount",id:"depositAmount",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.depositAmount})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Subs Months Remaining:"}),e.jsx("input",{value:c.leasePeriod,onChange:v,type:"number",id:"leasePeriod",name:"leasePeriod",className:"form-control form-control-sm"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.leasePeriod})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease Start Date:"}),e.jsx("input",{value:c.leaseStartDate,onChange:v,type:"date",name:"leaseStartDate",required:!!c.lesseeName,id:"leaseStartDate",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.leaseStartDate})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Lease End Date:"}),e.jsx("span",{className:"form-control form-control-sm",children:c.leaseStartDate?E(c.leaseStartDate).add(c.leasePeriod,"months").subtract(1,"days").format("DD / MM / YYYY"):""}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.leaseEndDate})]}),e.jsxs("div",{className:"col-lg-4 mt-1",children:[e.jsx("label",{className:"form-label",children:"Payment Period Start Date:"}),e.jsx("input",{value:c.paymentPeriodStart,onChange:v,type:"number",id:"paymentPeriodStart",name:"paymentPeriodStart",className:"form-control form-control-sm",readOnly:!0,disabled:!0}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.paymentPeriodStart})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Payment Period End Date:"}),e.jsx("input",{value:c.paymentPeriodEnd,onChange:v,min:"1",max:"31",type:"number",required:!!c.lesseeName,name:"paymentPeriodEnd",id:"paymentPeriodEnd",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.paymentPeriodEnd})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-center p-2 fw-bolder h6 custom-bg-grey",children:"Agents"}),e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{className:"form-label",children:"Landlord Type:"}),e.jsxs("select",{className:"form-select form-select-md",name:"landlordType",id:"landlordType",value:c.landlordType,disabled:t==="view",onChange:f=>U(f.target.value),children:[e.jsx("option",{value:"INDIVIDUAL",children:"Individual"}),e.jsx("option",{value:"COMPANY",children:"Company"})]}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.landlordType})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsxs("label",{htmlFor:"regIdNumber",className:"form-label",children:[c.landlordType==="COMPANY"?"Reg Number":"ID"," (or Name)",":"]}),e.jsx(ve,{onChange:f=>q(f),extraProps:{required:!1,id:"regIdNumber",className:"w-100",name:"regIdNumber"},defaultValue:t==="view"?c.regIdNumber:"",isDisabled:t==="view"||c.landlordType==="",useAlternateFetchOptions:{type:c.landlordType.toLowerCase()}},c.landlordType),n&&e.jsx("div",{className:"text-danger mt-1",children:n.regIdNumber})]}),e.jsxs("div",{className:"mt-1 col-lg-4",children:[e.jsx("label",{htmlFor:"landlordName",className:"form-label",children:"Landlord Name"}),e.jsx("input",{value:c.landlordName,name:"landlordName",id:"landlordName",className:"form-control form-control-md custom-no-pointer-events border border-2",readOnly:!0}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.landlordName})]}),e.jsxs("div",{className:"mt-2 col-lg-4",children:[e.jsx("label",{htmlFor:"commission",className:"form-label",children:"Commission %"}),e.jsx("input",{value:c.commission,onChange:v,type:"number",min:0,max:100,name:"commission",id:"commission",className:"form-control form-control-sm",readOnly:t==="view"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.commission})]})]})]}),t==="add"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-center p-2 fw-bolder h6 custom-bg-grey",children:"Opening Rent Balances"}),e.jsx("table",{className:"table table-responsive table-bordered",children:e.jsxs("tbody",{children:[e.jsxs("tr",{style:{lineHeight:"5px",fontSize:"12px"},children:[e.jsx("th",{scope:"row",className:"fw-bold",style:{lineHeight:"15px"},children:"Payment Date"}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:"More than 3 months"}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:r}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:s}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:a}),e.jsx("td",{className:"",style:{lineHeight:"15px"},children:N}),e.jsx("td",{className:"fw-bold",style:{lineHeight:"15px"},children:"Outstanding Balance"})]}),e.jsxs("tr",{style:{lineHeight:"5px",fontSize:"12px"},children:[e.jsx("th",{scope:"row",className:"fw-bold",children:"Amount"}),e.jsx("td",{className:"bg-black text-white",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"moreThanThreeMonthsBalance",name:"moreThanThreeMonthsBalance",onChange:v,value:c.moreThanThreeMonthsBalance})}),e.jsx("td",{className:"text-white bg-danger",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthThreeBalance",name:"monthThreeBalance",onChange:v,value:c.monthThreeBalance})}),e.jsx("td",{className:"text-white",style:{backgroundColor:"#f87171"},children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthTwoBalance",name:"monthTwoBalance",onChange:v,value:c.monthTwoBalance})}),e.jsx("td",{className:"text-white bg-warning",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"monthOneBalance",name:"monthOneBalance",onChange:v,value:c.monthOneBalance})}),e.jsx("td",{className:"text-white bg-success",children:e.jsx("input",{className:"form-control form-control-sm",type:"text",id:"currentBalance",name:"currentBalance",onChange:v,value:c.currentBalance})}),e.jsx("td",{className:`text-white text-end h-100 d-flex align-items-center justify-content-center py-4 my-auto ${Number(c.moreThanThreeMonthsBalance)>0?"bg-black":Number(c.monthThreeBalance)>0?"bg-danger":Number(c.monthTwoBalance)>0?"bg-transperant":Number(c.monthOneBalance)>0?"bg-warning":"bg-success"}`,style:{backgroundColor:Number(c.monthTwoBalance)>0?"#f87171":""},children:ie(Number(c.moreThanThreeMonthsBalance)+Number(c.monthThreeBalance)+Number(c.monthTwoBalance)+Number(c.monthOneBalance)+Number(c.currentBalance)||0)})]})]})})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-center gap-3",children:t==="view"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-info text-white",onClick:V,children:"Receipt"}),e.jsx("button",{className:"btn btn-success",onClick:l,children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:l,children:"Terminate"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"}),e.jsx("button",{className:"btn btn-info text-white",type:"submit",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"d-inline-block ml-2",children:"processing.."})]}):"Submit"})]})})]}),e.jsx(ce,{show:d,handleClose:$})]})]}):e.jsx(we,{type:"company",actionType:"lease"})})]})},nt=({show:o,handleClose:l,handleShowAlert:t,leaseData:i})=>{const[b,x]=m.useState(!1),{data:h,post:u}=se({leaseId:i.lease_id}),n=()=>{u(reverseUrl("delete_lease"),{onStart:()=>{x(!0)},onSuccess:d=>{t("Lease terminated successfully"),x(!1)},onError:d=>{T.error("Something went wrong! Please try again"),x(!1)},onFinish:()=>{l()}})};return e.jsx("div",{className:"container-xl p-5",children:e.jsx("div",{className:"card card-raised",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs(L,{show:o,onHide:l,size:"md",backdrop:"static",centered:!0,children:[e.jsx(L.Header,{closeButton:!0,className:"h4 bg-info text-white text-center text-uppercase",children:"Confirm Lease Termination"}),e.jsxs(L.Body,{className:"p-4 d-flex justify-content-between align-items-center gap-4",children:[e.jsx(de,{}),e.jsxs("p",{className:"my-3 text-center",children:["Are you sure you want to terninate lease for ",i.name,"? This action cannot be undone."]})]}),e.jsxs(L.Footer,{className:"p-4 d-flex justify-content-end gap-4",children:[e.jsxs(re,{onClick:l,variant:"secondary",children:[e.jsx("i",{className:"material-icons",children:"cancel"}),"Cancel"]}),e.jsxs(re,{onClick:n,variant:"danger",children:[e.jsx("i",{className:"material-icons",children:"done"}),"Delete"]})]})]})})})})},st=({show:o,handleClose:l,url:t,setVerified:i,verification_type:b,setCreditInfo:x})=>{const[h,u]=m.useState(!1),[n,d]=m.useState({}),{data:c,setData:w,post:N,reset:a}=se({otp:"",verification_type:b}),[s,r]=m.useState(!1),[g,Y]=m.useState(30);m.useEffect(()=>{const S=setInterval(()=>{Y(k=>k<=1?(clearInterval(S),r(!0),0):k-1)},1e3);return()=>clearInterval(S)},[]);const R=()=>te(void 0,null,function*(){r(!1);try{(yield H.get(reverseUrl("new_otp"))).data.status==="success"?T.success("OTP sent successfully"):T.error("Something went wrong! Please try again")}catch(S){T.error("Something went wrong! Please try again")}}),P=S=>w(C(_({},c),{[S.target.id]:S.target.value})),M=()=>c.otp.length!==4?(d({otp:"otp must be four digits"}),!1):parseInt(c.otp,10)?!0:(d({otp:"otp must be a number"}),!1),O=S=>{console.log("indi"),S.preventDefault(),M()&&(N(reverseUrl(t),{onStart:()=>{u(!0)},onSuccess:k=>{l(),a(),T.success("Verification successful"),u(!1),typeof i=="function"&&i(!0)},onError:k=>{T.error("Something went wrong! Please try again"),d(k),console.log(erros),u(!1)}}),u(!1))};return e.jsx(e.Fragment,{children:e.jsx(L,{size:"lg",show:o,onHide:l,centered:!0,children:e.jsx("div",{children:e.jsxs("div",{className:"card card-raised",children:[e.jsx("div",{className:"card-header bg-info px-4",children:e.jsxs("div",{className:`d-flex justify-content-between
                                align-items-center`,children:[e.jsxs("div",{className:"me-4",children:[e.jsx("h2",{className:"display-6 mb-0 text-white",children:"Verify OTP"}),e.jsx("div",{className:"card-text"})]}),e.jsx("div",{className:"d-flex gap-2"})]})}),e.jsx("div",{className:"card-body p-4",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body p-4",style:{borderStyle:"solid",borderColor:"#26a69a"},children:[e.jsx(L.Body,{children:e.jsxs("div",{className:"row mb-4",children:[e.jsxs("div",{className:"col-md-12",children:[e.jsx("div",{children:e.jsx("p",{children:b==="individual"?"Enter the 4-digit code we sent to user's mobile number. This code will expire after 5 minutes":"Enter the 4-digit code we sent to user's email. This code will expire after 5 minutes"})}),e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Verification Code"}),e.jsx("input",{value:c.otp,onChange:P,type:"text",name:"otp",id:"otp",placeholder:"Enter your 4 digit otp",className:"form-control form-control-sm"}),n&&e.jsx("div",{className:"text-danger mt-1",children:n.otp})]})})]}),e.jsxs("div",{className:"mt-5 d-flex gap-4 align-items-center ",children:[e.jsxs("p",{children:["Didn't receive code?",e.jsx("button",{onClick:R,className:"ms-2 text-decoration-underline border-0 bg-transparent text-info",disabled:s===!1,children:"Resend Code"})]}),g>0&&e.jsx("p",{className:"text-success",children:`Resend code in ${g} seconds`})]})]})}),e.jsx(L.Footer,{children:e.jsx(re,{className:"text-white",variant:"info",onClick:S=>O(S),disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"processing.."})]}):"Verify"})})]})})})]})})})})};function W({title:o,children:l,noBoundary:t}){const i=t?"bg-white mb-3":"bg-white rounded-2 border overflow-hidden border-dark shadow-sm mb-3";return e.jsxs("div",{className:i,children:[e.jsx("div",{className:"rounded-top-2 custom-bg-grey text-white text-center p-1",children:K.capitalize(o)}),l]})}function rt({data:o}){let l=0;return Object.keys(o).forEach(t=>l+=o[t]),e.jsx(W,{title:"aged analysis",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"90+ Days"}),e.jsx("th",{children:"90 Days"}),e.jsx("th",{children:"60 Days"}),e.jsx("th",{children:"30 Days"}),e.jsx("th",{children:"Current"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:o.oneTwentyDays}),e.jsx("td",{children:o.ninetyDays}),e.jsx("td",{children:o.sixtyDays}),e.jsx("td",{children:o.thirtyDays}),e.jsx("td",{children:o.current}),e.jsxs("td",{children:["$",l]})]})})]})})}function lt(o,l){const[t,i]=m.useState(!o),[b,x]=m.useState(o),[h,u]=m.useState(""),[n,d]=m.useState(!1),{Auth:c}=ye().props,w=`${c.user_profile.first_name} ${c.user_profile.last_name}`;function N(a){a.preventDefault(),d(!0),u("");const s=Object.fromEntries(new FormData(a.target).entries());s.client_id=l.toString(),H.put(reverseUrl("debtor_intelligence"),s).then(r=>{const g={text:r.data.note,user:r.data.user_name,timestamp:r.data.updated_at||r.data.created_at};x(g),u(""),d(!1),i(!1)}).catch(r=>{r instanceof X?u(r.response.status===500?`Error: ${r.response.statusText}`:JSON.stringify(r.response.data)):u(r),d(!1),i(!b)})}return{data:b,isEditMode:t,handleSave:N,loggedInUser:w,setIsEditMode:i,error:h,setError:u,isLoading:n}}function ot({data:o,clientId:l}){const{data:t,isEditMode:i,handleSave:b,loggedInUser:x,setIsEditMode:h,error:u,setError:n,isLoading:d}=lt(o,l);return e.jsx(W,{title:"debtor intelligence",children:e.jsxs("div",{className:"px-3 py-2",children:[u&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>n(""),className:"btn-close btn-sm"}),K.truncate(u,{length:150})]}),i?e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"note",className:"form-label",children:t&&t.text?"Edit note":"No note found, create new note"}),e.jsx("textarea",{className:"form-control",name:"note",id:"note",rows:"2",defaultValue:t&&t.text?t.text:"",placeholder:"type here...",disabled:d})]}),e.jsx("b",{className:"d-block my-1",children:x}),e.jsx("div",{className:"small text-success",children:"today"}),e.jsx("button",{disabled:d,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:d?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsx("small",{children:t.text}),e.jsx("b",{className:"d-block my-1",children:t.user}),e.jsx("div",{className:"small text-success",children:le(t.timestamp)}),e.jsx("button",{onClick:()=>h(!0),type:"button",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Edit"})]})]})})}function dt(o,l){const[t,i]=m.useState(!o),[b,x]=m.useState(o),[h,u]=m.useState(""),[n,d]=m.useState(!1);function c(w){w.preventDefault(),d(!0),u("");const N=Object.fromEntries(new FormData(w.target).entries());N.client_id=l.toString(),N.other_numbers=N.other_numbers.split(",").filter(Boolean).map(a=>a.trim()),H.put(reverseUrl("update_client_contact_details"),N).then(a=>{const s={contactPerson:`${a.data.firstname} ${a.data.surname}`,smsNumber:a.data.sms_number,otherNumbers:a.data.other_numbers?a.data.other_numbers.join(", "):"",emailAddress:a.data.email_address,address:a.data.address};x(s),u(""),d(!1),i(!1)}).catch(a=>{a instanceof X?u(a.response.status===500?`Error: ${a.response.statusText}`:JSON.stringify(a.response.data)):u(a),d(!1),i(!b)})}return{data:b,isEditMode:t,handleSave:c,setIsEditMode:i,error:h,setError:u,isLoading:n}}function ct({data:o,clientId:l}){const{data:t,isEditMode:i,handleSave:b,setIsEditMode:x,error:h,setError:u,isLoading:n}=dt(o,l);return e.jsx(W,{title:"contact details",children:e.jsxs("div",{className:"py-2",children:[h&&e.jsxs("p",{className:"d-flex align-items-start px-2 gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>u(""),className:"btn-close btn-sm"}),K.truncate(h,{length:150})]}),i?e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"firstname",className:"form-label small",children:"First Name"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"firstname",id:"firstname",disabled:n,defaultValue:t&&t.contactPerson?t.contactPerson.trim().split(" ")[0]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"surname",className:"form-label small",children:"Surname"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"surname",id:"surname",disabled:n,defaultValue:t&&t.contactPerson?t.contactPerson.trim().split(" ")[1]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"sms_number",className:"form-label small",children:"SMS Number"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"sms_number",id:"sms_number",disabled:n,defaultValue:t&&t.smsNumber?t.smsNumber:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"other_numbers",className:"form-label small",children:"Other Numbers (comma separated)"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"other_numbers",id:"other_numbers",disabled:n,defaultValue:t&&t.other_numbers?t.other_numbers:"",placeholder:"(comma separated)"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"email_address",className:"form-label small",children:"Email Address"}),e.jsx("input",{type:"email",className:"form-control form-control-sm w-50 rounded-2",name:"email_address",id:"email_address",disabled:n,defaultValue:t&&t.emailAddress?t.emailAddress:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"address",className:"form-label small",children:"Address"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"address",id:"address",disabled:n,defaultValue:t&&t.address?t.address:""})]}),e.jsx("button",{disabled:n,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:n?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Contact Person: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:t.contactPerson})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{children:"SMS Number: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:t.smsNumber})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Other Numbers: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:t.otherNumbers})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{children:"Email Address: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:t.emailAddress})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Address: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:t.address})]}),e.jsx("div",{className:"mt-4 px-2",children:e.jsx("button",{onClick:()=>x(!0),type:"button",className:"d-block btn btn-info w-100 text-white",children:"Edit"})})]})]})})}function it({data:o}){return e.jsx(W,{title:"forecast inflows",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"0-7 Days"}),e.jsx("th",{children:"8-14 Days"}),e.jsx("th",{children:"14-21 Days"}),e.jsx("th",{children:"21+ Days"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:o.zeroToSevenDays}),e.jsx("td",{children:o.eightToFourteenDays}),e.jsx("td",{children:o.fourteenToTwentyOneDays}),e.jsx("td",{children:o.twentyOnePlusDays}),e.jsxs("td",{children:["$",o.total]})]})})]})})}function mt(o,l){const[t,i]=m.useState(o),[b,x]=m.useState(""),[h,u]=m.useState(!1),[n,d]=m.useState("note");function c(w){w.preventDefault(),u(!0),x("");const N=Object.fromEntries(new FormData(w.target).entries());N.client_id=l.toString(),N.reminder_type=n.toUpperCase(),n==="note"&&(N.action_date=new Date().toISOString().split("T")[0]),H.post(reverseUrl("communication_history"),N).then(a=>{i(s=>[...s,{text:a.data.message,actionDone:a.data.action_done,user:a.data.user_name,communicationType:a.data.reminder_type.toLowerCase(),timestamp:a.data.created_at}]),x(""),u(!1)}).catch(a=>{a instanceof X?x(a.response.status===500?`Error: ${a.response.statusText}`:JSON.stringify(a.response.data)):x(a),u(!1)})}return{messages:t,handleSubmit:c,error:b,setError:x,isLoading:h,remainderType:n,setRemainderType:d}}function ht({messages:o,clientId:l}){const{handleSubmit:t,messages:i,error:b,setError:x,isLoading:h,remainderType:u,setRemainderType:n}=mt(o,l);return e.jsx(W,{noBoundary:!0,title:"communication history",children:e.jsxs("div",{className:"custom-bg-whitesmoke px-5 py-3",children:[e.jsxs("div",{className:"custom-vh-50 custom-overflow-y-auto",children:[i.map((d,c)=>e.jsxs("div",{className:"custom-message py-2 px-3 border shadow-sm mb-3",children:[e.jsx("small",{children:d.text+(d.communicationType.toLowerCase().trim()!=="note"&&d.actionDone?` (action date: ${le(d.actionDone)})`:"")}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end align-items-center text-end gap-2",children:[e.jsx("small",{className:"smallest",children:e.jsxs("b",{children:[d.user,d.communicationType&&" | "+d.communicationType.toLowerCase()]})}),e.jsx("small",{className:"text-success smallest",children:le(d.timestamp)})]})]},c)),i.length===0&&e.jsxs("small",{className:"h-100 text-grey d-flex justify-content-center align-items-center text-center",children:["No communication ",e.jsx("br",{})," history"]})]}),e.jsxs("form",{onSubmit:t,className:"border-top border-4 w-100 pt-3",children:[b&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>x(""),className:"btn-close btn-sm"}),K.truncate(b,{length:150})]}),e.jsx("textarea",{rows:2,name:"message",id:"message",placeholder:"Type message here...",className:"d-block w-100 p-2 custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0,disabled:h}),e.jsxs("div",{className:"d-flex justify-content-center pt-2 gap-2 align-items-center",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:h,value:"note",id:"reminder_type-note",checked:u==="note",onChange:d=>n(d.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-note",children:"Note"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:h,value:"email",id:"reminder_type-email",checked:u==="email",onChange:d=>n(d.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-email",children:"Email"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:h,value:"sms",id:"reminder_type-sms",checked:u==="sms",onChange:d=>n(d.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-sms",children:"SMS"})]})]}),u!=="note"&&e.jsxs("div",{className:"d-flex my-2 gap-2 align-items-center justify-content-center",children:[e.jsxs("label",{htmlFor:"action_date",className:"small d-block text-nowrap form-label",children:["Send ",u," on:"]}),e.jsx("input",{min:new Date().toISOString().split("T")[0],type:"date",className:"form-control form-control-sm rounded-4",name:"action_date",id:"action_date",required:!0})]}),e.jsx("button",{disabled:h,type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:h?"Submiting...":"Submit"})]})]})})}function ut(o,l,t){const[i,b]=m.useState(o),[x,h]=m.useState(""),[u,n]=m.useState(!1),[d,c]=m.useState([]);function w(){n(!0),h("");const s={plans:d.map(r=>C(_({},r),{client_id:l.toString()}))};H.post(reverseUrl("payment_plans"),s).then(r=>{c([]),h(""),n(!1),t()}).catch(r=>{r instanceof X?h(r.response.status===500?`Error: ${r.response.statusText}`:JSON.stringify(r.response.data)):h(r),c([]),n(!1)})}function N(s){c(r=>[...r,s])}function a(){c([])}return{paymentPlans:i,newPaymentPlans:d,addNewPaymentPlan:N,confirmNewPaymentPlans:w,clearNewPaymentPlans:a,error:x,setError:h,isLoading:u}}function xt({addNewPaymentPlan:o}){function l(t){t.preventDefault();const i=Object.fromEntries(new FormData(t.target).entries());o(i)}return e.jsx(W,{title:"payment plan",children:e.jsxs("form",{onSubmit:l,className:"p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"spoke_with",className:"text-nowrap",children:"Person spoken with:"}),e.jsx("input",{type:"text",name:"spoke_with",id:"spoke_with",placeholder:"Person spoken with here",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"expected_pay_date",className:"text-nowrap",children:"Expected Pay Date:"}),e.jsx("input",{type:"date",name:"expected_pay_date",id:"expected_pay_date",className:"custom-form-control border-0 custom-pointer border-bottom border-bottom-3 border-dark",required:!0,defaultValue:new Date().toISOString().split("T")[0],min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-nowrap",children:"Amount ($):"}),e.jsx("input",{min:0,type:"number",name:"amount",id:"amount",placeholder:"Amount in $",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsx("button",{type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Add to payment plan"})]})})}function pt({paymentPlans:o}){return e.jsx(W,{title:"payment plans",children:e.jsx("div",{className:"custom-mx-h-15 overflow-auto",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan ID"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Date"})]})}),e.jsxs("tbody",{children:[o.map((l,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.id||t}),e.jsx("td",{children:l.amount}),e.jsx("td",{children:Se(l.date)})]},l.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center small text-grey py-3",children:"No payment plans"})})]})]})})})}function bt({newPaymentPlans:o,confirmNewPaymentPlans:l,clearNewPaymentPlans:t,error:i,setError:b,isLoading:x}){return e.jsx(W,{title:"plan details",children:e.jsxs("div",{className:"p-3 pb-2",children:[e.jsxs("div",{className:"custom-h-07 overflow-auto",children:[o.map((h,u)=>e.jsx("div",{className:"p-1 small border-bottom",children:`${h.spoke_with} promised to pay USD${h.amount} on ${Se(h.expected_pay_date)}`},u)),o.length===0&&e.jsx("div",{className:"text-center small text-grey py-3",children:"No new payment plans"})]}),e.jsxs("div",{className:"pt-2 bg-white",children:[i&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>b(""),className:"btn-close btn-sm"}),K.truncate(i,{length:150})]}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"d-block btn btn-info w-100 text-white",disabled:x||!o.length,children:x?"Saving...":"Save plan"}),e.jsx("button",{type:"button",onClick:t,className:"d-block btn btn-dark w-100 text-white",disabled:x||!o.length,children:"Clear All"})]})]})]})})}function ft({paymentPlans:o,clientId:l,refreshClientViewData:t}){const{paymentPlans:i,newPaymentPlans:b,addNewPaymentPlan:x,confirmNewPaymentPlans:h,clearNewPaymentPlans:u,error:n,setError:d,isLoading:c}=ut(o,l,t);return e.jsxs(e.Fragment,{children:[e.jsx(xt,{addNewPaymentPlan:x,clientId:l}),e.jsx(bt,{newPaymentPlans:b,confirmNewPaymentPlans:h,clearNewPaymentPlans:u,error:n,setError:d,isLoading:c}),e.jsx(pt,{paymentPlans:i})]})}function Nt({clientViewProps:{showModal:o,hideClientView:l,data:t,error:i,isLoading:b,clientId:x,refreshClientViewData:h}}){const u=!t;return e.jsx(e.Fragment,{children:e.jsxs(L,{show:o,onHide:l,fullscreen:!0,contentClassName:"custom-bg-whitesmoke",children:[e.jsx(L.Header,{className:"p-0",children:e.jsxs("div",{className:"w-100 p-2 text-center bg-info position-relative",children:[e.jsx("h4",{className:"text-white",children:b||i||u?"Client View":t.tenantName}),e.jsx("button",{type:"button",onClick:l,className:"btn position-absolute top-0 end-0 h-100 d-flex align-items-center text-white",children:e.jsx("i",{className:"material-icons fs-3 px-4",children:"close"})})]})}),e.jsx(L.Body,{children:e.jsxs("div",{className:"position-relative custom-mn-h-5",children:[b&&e.jsxs("div",{className:"text-center position-absolute top-50 start-50 translate-middle",children:[e.jsx("div",{className:"spinner-border text-info spinner-border-md",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{children:"Loading...please wait"})]}),i&&e.jsxs("div",{className:"text-center text-danger position-absolute top-50 start-50 translate-middle",children:[e.jsx("p",{children:e.jsx("i",{className:"material-icons fs-1",children:"warning"})}),e.jsxs("p",{children:["Error: ",K.truncate(i,{length:500})]})]}),!(b||i||u)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row row-cols-3 align-items-stretch",children:[e.jsxs("div",{className:"col p-1",children:[e.jsx(rt,{data:t.agedAnalysis}),e.jsx(ot,{data:t.debtorIntelligence,clientId:x}),e.jsx(ct,{data:t.contactDetails,clientId:x})]}),e.jsx("div",{className:"col p-1",children:e.jsx(ht,{messages:t.communicationHistory,clientId:x})}),e.jsxs("div",{className:"col p-1",children:[e.jsx(it,{data:t.forecastInflows}),e.jsx(ft,{clientId:x,paymentPlans:t.paymentPlans,refreshClientViewData:h})]})]})})]})})]})})}function jt(){const[o,l]=m.useState(!1),[t,i]=m.useState(null),[b,x]=m.useState(""),[h,u]=m.useState(!1),[n,d]=m.useState(null);function c(a){d(a),l(!0),u(!0),x(""),H(reverseUrl("client_details"),{params:{lease_id:a.lease_id}}).then(s=>{const r={tenantName:a.name,agedAnalysis:{oneTwentyDays:s.data.aged_analysis["120_days_plus"],ninetyDays:s.data.aged_analysis["90_days"],sixtyDays:s.data.aged_analysis["60_days"],thirtyDays:s.data.aged_analysis["30_days"],current:s.data.aged_analysis.current},contactDetails:{contactPerson:`${s.data.client.firstname} ${s.data.client.surname}`,smsNumber:s.data.client.sms_number,otherNumbers:s.data.other_numbers?s.data.client.other_numbers.join(", "):"",emailAddress:s.data.client.email,address:s.data.client.address},paymentPlans:s.data.payment_plans.map(g=>({id:g.id,person:g.spoke_with,date:g.expected_pay_date,amount:g.amount})),communicationHistory:s.data.communication_history.map(g=>({text:g.message,timestamp:g.created_at,user:g.user_name,actionDone:g.action_done?g.action_done:null,communicationType:g.type})),debtorIntelligence:Object.values(s.data.debtor_intelligence).length&&Object.values(s.data.debtor_intelligence).every(Boolean)?{text:s.data.debtor_intelligence.note,timestamp:s.data.debtor_intelligence.updated_at,user:s.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:s.data.forecast_inflows["0-7"],eightToFourteenDays:s.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:s.data.forecast_inflows["14-21"],twentyOnePlusDays:s.data.forecast_inflows["21+"],total:s.data.forecast_inflows.total}};console.log({res:s,resData:r}),i(r),x(""),u(!1)}).catch(s=>{s instanceof X?x(s.response.status===500?`Error: ${s.response.statusText}`:JSON.stringify(s.response.data)):x(s),i(null),u(!1)})}function w(){console.log("refreshing.."),u(!0),x(""),H(reverseUrl("client_details"),{params:{lease_id:n.lease_id}}).then(a=>{const s={tenantName:n.name,agedAnalysis:{oneTwentyDays:a.data.aged_analysis["120_days_plus"],ninetyDays:a.data.aged_analysis["90_days"],sixtyDays:a.data.aged_analysis["60_days"],thirtyDays:a.data.aged_analysis["30_days"],current:a.data.aged_analysis.current},contactDetails:{contactPerson:`${a.data.client.firstname} ${a.data.client.surname}`,smsNumber:a.data.client.sms_number,otherNumbers:a.data.other_numbers?a.data.client.other_numbers.join(", "):"",emailAddress:a.data.client.email,address:a.data.client.address},paymentPlans:a.data.payment_plans.map(r=>({id:r.id,person:r.spoke_with,date:r.expected_pay_date,amount:r.amount})),communicationHistory:a.data.communication_history.map(r=>({text:r.message,timestamp:r.created_at,user:r.user_name,actionDone:r.action_done?r.action_done:null,communicationType:r.type})),debtorIntelligence:Object.values(a.data.debtor_intelligence).length&&Object.values(a.data.debtor_intelligence).every(Boolean)?{text:a.data.debtor_intelligence.note,timestamp:a.data.debtor_intelligence.updated_at,user:a.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:a.data.forecast_inflows["0-7"],eightToFourteenDays:a.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:a.data.forecast_inflows["14-21"],twentyOnePlusDays:a.data.forecast_inflows["21+"],total:a.data.forecast_inflows.total}};i(s),x(""),u(!1)}).catch(a=>{a instanceof X?x(a.response.status===500?`Error: ${a.response.statusText}`:JSON.stringify(a.response.data)):x(a),i(null),u(!1)})}function N(){l(!1)}return{showModal:o,openClientView:c,hideClientView:N,data:t,error:b,isLoading:h,clientId:n?n.id:null,refreshClientViewData:w}}const gt=({leases:o,total_pages:l,total_items:t,current_page:i})=>{const[b,x]=m.useState(!1),[h,u]=m.useState(!1),[n,d]=m.useState({}),[c,w]=m.useState([]),[N,a]=m.useState({}),[s,r]=m.useState(!1),[g,Y]=m.useState(!1),[R,P]=m.useState(0),[M,O]=m.useState(!1),[S,k]=m.useState(!1),[v,V]=m.useState(""),[$,U]=m.useState(!1),[q,I]=m.useState(!1),[f,y]=m.useState(""),[A,D]=m.useState(""),G=jt(),F=(p,B)=>{I(!0),D(B),y(p)},Z=()=>{I(!1),D(""),y("")};m.useEffect(()=>{H.post(reverseUrl("open_subscription")).then(p=>{w(p.data)}).catch(p=>{})},[w]);const z=document.getElementById("hide-footer");m.useEffect(()=>(z!==null&&document.getElementById("footer").classList.add("d-none"),()=>{z!==null&&document.getElementById("footer").classList.remove("d-none")}),[z]);const j=ye().props.error;return j&&T.error(j),e.jsxs("main",{className:"position-relative",id:"hide-footer",style:{height:"100%"},children:[e.jsx(Nt,{clientViewProps:G}),f&&e.jsxs(Ne,{onClose:Z,show:q,delay:1e4,className:"w-100 shadow-none ",style:{background:"#dcfce7"},autohide:!0,children:[e.jsxs(Ne.Header,{className:"text-uppercase w-100",children:[e.jsx("strong",{className:"me-auto",children:A?`Following message has been sent to ${A}`:""}),e.jsx("small",{className:"text-muted text-capitalize ms-auto",children:"just now"})]}),e.jsx("p",{className:"p-4",children:f})]}),e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"card card-raised mb-5",children:[e.jsx("div",{className:"card-header px-4",style:{height:"50px",backgroundColor:"#32a4a8"},children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"",children:e.jsx("h2",{className:"display-6 tf-color",children:"Lease Management"})})})}),e.jsxs("div",{className:"card-body p-4 position-relative ",children:[e.jsx("div",{className:"row mb-2",children:e.jsx("div",{className:"col-md-4",children:e.jsx(qe,{searchBy:"name"})})}),e.jsx("div",{className:"",style:{backgroundColor:"#428f38"},children:e.jsx("h5",{className:"text-center tf-color",children:"Active Lease"})}),e.jsx("div",{className:"table-responsive tableFixHead",children:e.jsxs("table",{className:"table-responsive table table-bordered",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{style:{borderTop:"0px"},children:[e.jsx("th",{scope:"col",className:"custom-z-0",style:{width:"100px"},children:"No."}),e.jsx("th",{scope:"col",className:"custom-z-0",style:{},children:"Tenant"}),e.jsx("th",{scope:"col",className:"custom-z-0",style:{},children:"Customer Number"}),e.jsx("th",{scope:"col",className:"custom-z-0 text-end",children:"Rent Owing"}),e.jsx("th",{scope:"col",colSpan:3,className:"custom-z-0 tf-borderRight",children:e.jsx("span",{style:{visibility:"hidden"},children:"Actions to be done"})})]})}),e.jsx("tbody",{children:o==null?void 0:o.map((p,B)=>e.jsxs("tr",{className:"w-100 py-2",children:[e.jsx("th",{scope:"row",children:B+1}),e.jsx("td",{children:e.jsx("button",{title:"double click to view client",type:"button",onDoubleClick:()=>G.openClientView(p),className:"custom-btn text-decoration-underline",children:p.name})}),e.jsx("td",{children:p.customer_number}),e.jsxs("td",{className:`bg-${p.color} text-white text-end`,style:{backgroundColor:p.color=="light-red"?"#f87171":""},children:[p.currency,ie(p.owing_amount)]}),e.jsx("td",{className:"bg-info text-white text-center tfRow",onClick:()=>{Y(!0),d(p)},children:"Receipt"}),e.jsx("td",{className:"bg-primary text-white text-center tfRow",onClick:()=>{u(!0),x(!1),d(p),a({type:p.is_company?"company":"individual"})},children:"Adjust"}),e.jsx("td",{className:"bg-danger text-white text-center tfRow",onClick:()=>{r(!0),d(p)},children:"Terminate"})]},"lease"+B))})]})}),e.jsx(ze,{currentPage:i,totalPages:l}),(N==null?void 0:N.type)==="individual"&&b&&e.jsx(je,{action:"add",show:b,handleClose:()=>{x(!1),d({})},setShowVerify:O,lesseeDetails:n,subscriptionPeriod:R,handleShowAlert:F}),(N==null?void 0:N.type)==="individual"&&h&&e.jsx(je,{action:"edit",show:h,handleClose:()=>{u(!1),d({})},handleShowAlert:F,lesseeDetails:n,subscriptionPeriod:n.lease_period}),(N==null?void 0:N.type)==="company"&&b&&e.jsx(ge,{action:"add",show:b,handleClose:()=>{x(!1),d({})},lesseeDetails:n,subscriptionPeriod:R,handleShowAlert:F}),(N==null?void 0:N.type)==="company"&&h&&e.jsx(ge,{action:"edit",show:h,handleClose:()=>{u(!1),d({})},handleShowAlert:F,lesseeDetails:n,subscriptionPeriod:n.lease_period}),s&&e.jsx(nt,{show:s,handleClose:()=>{r(!1),d({})},handleShowAlert:F,leaseData:n}),g&&e.jsx(ce,{show:g,handleClose:p=>te(void 0,null,function*(){y(p),Y(!1),I(!0),d({})}),leaseDetails:n,myKey:"leases"}),M&&e.jsx(st,{show:M,handleClose:()=>{O(!1)},url:"client-individual-verify-otp",setVerified:k,verification_type:v})]})]})}),e.jsx("div",{className:"w-100 ",style:{backgroundColor:"#e3d329",position:"fixed",bottom:"0",right:"0",width:"100%"},children:e.jsx(He,{isVisible:$,setIsVisible:U,trigger:e.jsxs("div",{style:{backgroundColor:"#e3d329"},className:"position-relative tf-color",children:[e.jsx("h5",{className:"text-center tf-color py-2",children:"Open Subscriptions"}),e.jsx("i",{className:"icon material-icons position-absolute top-50 translate-middle",style:{right:"35%",fontSize:"50px",transform:"translateY(-50%)"},children:"keyboard_arrow_up"})]}),children:e.jsx($e,{title:"Open Subscriptions",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Type"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Open Slots"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Period (months)"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Start Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"End Date"}),e.jsx("th",{scope:"col",colSpan:"2",className:"tf-borderRight"})]})}),e.jsx("tbody",{children:c==null?void 0:c.map((p,B)=>e.jsx(Ie.Fragment,{children:p.open_slots>0&&e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:B+1}),e.jsx("td",{children:p.subscription_class}),e.jsx("td",{children:p.open_slots}),e.jsx("td",{children:p.period_length}),e.jsx("td",{children:p.start_date}),e.jsx("td",{children:p.end_date}),e.jsx("td",{colSpan:"2",className:`${p.open_slots===0?"bg-gray":"bg-success"} text-white text-center tfRow`,onClick:()=>{p.open_slots!==0&&(x(!0),u(!1),U(!1),d({}),a({type:p.subscription_class}),V(p.subscription_class),P(p.period_length))},children:"Activate"})]},"subscription"+B)},B))})]})})})})})]})};gt.layout=o=>e.jsx(Ae,{children:o,title:"Leases"});export{gt as default};
