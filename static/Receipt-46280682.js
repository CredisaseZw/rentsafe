var O=Object.defineProperty,P=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var A=(s,o,r)=>o in s?O(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,g=(s,o)=>{for(var r in o||(o={}))H.call(o,r)&&A(s,r,o[r]);if(S)for(var r of S(o))M.call(o,r)&&A(s,r,o[r]);return s},h=(s,o)=>P(s,z(o));var B=(s,o,r)=>new Promise((i,_)=>{var R=l=>{try{u(r.next(l))}catch(x){_(x)}},N=l=>{try{u(r.throw(l))}catch(x){_(x)}},u=l=>l.done?i(l.value):Promise.resolve(l.value).then(R,N);u((r=r.apply(s,o)).next())});import{r as c,a as U,j as e,i as Y}from"./main-c733e0a6.js";import{I as V,_ as b}from"./index-9075d868.js";import{C as W}from"./Layout-fc6cdcd4.js";import{M as j}from"./Modal-66bffea1.js";function te({myKey:s,show:o,handleClose:r,leaseDetails:i}){const[_,R]=c.useState(""),[N,u]=c.useState(!1);c.useState(0);const[l,x]=c.useState({});c.useReducer(L,[]);const[$,C]=c.useState(null),{data:q,setData:G,post:J,reset:I}=U([]);c.useEffect(()=>{s&&C(s)},[s]),console.log("leaseDetails",i);function L(n,a){switch(a.type){case"initialize":return[...n,...a.payload];case"updatePaymentAmount":return n.map(t=>t.lease_id===a.payload.lease_id?h(g({},t),{paymentAmount:a.payload.paymentAmount}):t);case"updatePaymentDate":return n.map(t=>t.lease_id===a.payload.lease_id?h(g({},t),{paymentDate:a.payload.paymentDate}):t);case"updateReceiptNumber":return n.map(t=>t.lease_id===a.payload.lease_id?h(g({},t),{receiptNumber:a.payload.receiptNumber}):t);case"updateDetails":return n.map(t=>t.lease_id===a.payload.lease_id?h(g({},t),{details:a.payload.details}):t);default:return n}}const D=n=>B(this,null,function*(){n.preventDefault(),u(!0),Y.Inertia.post(reverseUrl("create_receipt_and_payment"),{rows:m,myKey:s},{onSuccess:a=>{var t,d;if(((t=a.props)==null?void 0:t.result)==="error"){b.error((d=a.props)==null?void 0:d.result);return}r("Receipts created successfully").then(()=>{I()})},onError:a=>{R(a),b.error("Something went wrong! Please try again")},onFinish:()=>{u(!1)}})}),T=[{id:1,paymentDate:new Date().toISOString().split("T")[0],tenant:"",receiptNumber:"",details:"",currency:"",rent_owing:"",color:"",paymentAmount:"",accountBalance:"",opening_balance_date:""}];c.useEffect(()=>{i&&i.owing_amount&&f([{id:1,lease_id:i.lease_id,paymentDate:new Date().toISOString().split("T")[0],tenant:i.name,receiptNumber:"",details:"",currency:i.currency,rent_owing:i.owing_amount,color:i.color,paymentAmount:"",accountBalance:i.owing_amount,opening_balance_date:i.opening_balance_date}])},[i]);const[m,f]=c.useState(T),k=()=>{const n={id:m.length+1,paymentDate:new Date().toISOString().split("T")[0],customerType:"",customerName:"",details:"",accountBalance:"",endBalance:"",opening_balance_date:""};f([...m,n])},w=(n,a)=>{const{name:t,value:d}=n.target,p=[...m];if(p[a][t]=d,t==="paymentAmount"){const y=parseFloat(p[a].rent_owing)||0,v=parseFloat(d)||0;p[a].accountBalance=y-v}if(t==="paymentDate"){const y=new Date(p[a].paymentDate),v=new Date(p[a].opening_balance_date),E=new Date(new Date().toISOString().split("T")[0]);if(y<v){b.error("You are attempting to post a payment/adjustment made before your opening balance date. Received amounts are already factored into the opening balance. If you need to make an adjustment, use the Accounting Adjustment menu option.");return}if(y>E){b.error("You are attempting to post a payment/adjustment made before your opening balance date. Received amounts are already factored into the opening balance. If you need to make an adjustment, use the Accounting Adjustment menu option.");return}}f(p)},F=(n,a)=>{if(!n)return;const t=[...m],d=t.slice(0,a).reverse().find(p=>p.tenant===n.tenant);d?t[a].rent_owing=d.accountBalance:t[a].rent_owing=n.rent_owing,t[a].tenant=n.tenant,t[a].lease_id=n.lease_id,t[a].currency=n.Currency,t[a].opening_balance_date=n.opening_balance_date,t[a].accountBalance=t[a].rent_owing-(t[a].paymentAmount||0),t[a].color=n.color,f(t)};return e.jsx("div",{className:"container-xl p-5",children:e.jsxs("div",{className:" ",children:[e.jsx(V,{position:"top-right",duration:"4000"}),e.jsxs(j,{show:o,onHide:r,size:"xl",backdrop:"static",centered:!0,children:[e.jsx(j.Header,{closeButton:!0}),e.jsx(j.Body,{className:"p-4 d-flex w-100 flex-column justify-content-between align-items-center",children:e.jsxs("div",{className:"table-responsive  w-100 ",children:[e.jsx("div",{className:"flex justify-content-center align-items-center w-100",children:e.jsx("h5",{className:"text-center tf-color bg-info",children:"Rent Receipt"})}),e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",fontSize:"12px",width:"100%"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Customer"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Receipt No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Details"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Currency"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Amount Owing"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Received Amount"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid",borderBottom:"1px solid"},children:"Amount Balance"})]})}),e.jsx("tbody",{children:m.map((n,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{className:"form-control form-control-sm tf-borderRight tf-input",type:"date",name:"paymentDate",value:n.paymentDate,onChange:t=>w(t,a),style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx(W,{url:reverseUrl("get_all_active_leases"),onChange:t=>F(t,a),value:n.tenant?{label:n.tenant,value:n.lease_id}:null,defaultValue:null,isDisabled:!1})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px",maxWidth:"60px"},children:e.jsx("input",{onChange:t=>x(h(g({},l),{receiptNumber:t.target.value})),className:"form-control form-control-sm tf-borderRight tf-input",type:"text",name:"receiptNumber",id:"receiptNumber",value:l==null?void 0:l.receiptNumber,style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{className:"form-control form-control-sm tf-borderRight tf-input",type:"text",id:"details",name:"details",value:n.details,onChange:t=>w(t,a),style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:n.currency}),e.jsx("td",{className:`tf-borderRight bg-${n==null?void 0:n.color} text-white text-center`,style:{paddingRight:"1px",paddingLeft:"1px",backgroundColor:(n==null?void 0:n.color)==="light-red"?"rgb(248, 113, 113)":""},children:n.rent_owing}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{type:"text",name:"paymentAmount",value:n.paymentAmount,onChange:t=>w(t,a)})}),e.jsx("td",{className:"tf-borderRight text-end",style:{paddingRight:"1px",paddingLeft:"1px",borderBottom:"1px solid #e0e0e0"},children:e.jsx("input",{type:"text",name:"accountBalance",value:n.accountBalance,dissabled:!0})})]},n.id))})]}),e.jsx("div",{className:"d-flex flex-row-reverse",children:e.jsxs("button",{className:"btn btn-raised bg-success text-white",style:{backgroundColor:"#0d475c"},onClick:k,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Receipts"]})})]})}),e.jsx(j.Footer,{className:"p-4 d-flex justify-content-center",children:e.jsx("div",{className:"d-flex flex-row-reverse",children:e.jsx("button",{className:"btn btn-raised bg-info text-white",style:{backgroundColor:"#0d475c"},onClick:D,children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"Processing.."})]}):e.jsx(e.Fragment,{children:"Submit"})})})})]})]})})}export{te as R};
