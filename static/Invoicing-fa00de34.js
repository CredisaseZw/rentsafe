var U=Object.defineProperty,F=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var I=(a,d,l)=>d in a?U(a,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[d]=l,h=(a,d)=>{for(var l in d||(d={}))O.call(d,l)&&I(a,l,d[l]);if(R)for(var l of R(d))Z.call(d,l)&&I(a,l,d[l]);return a},x=(a,d)=>F(a,L(d));var M=(a,d,l)=>new Promise((c,N)=>{var g=n=>{try{i(l.next(n))}catch(u){N(u)}},_=n=>{try{i(l.throw(n))}catch(u){N(u)}},i=n=>n.done?c(n.value):Promise.resolve(n.value).then(g,_);i((l=l.apply(a,d)).next())});import{u as B,r as m,j as e,b as k}from"./main-159d3891.js";import{h as y}from"./moment-686b5dfa.js";import{f as w}from"./formatting-345d2430.js";import{L as G}from"./Layout-dcae7a62.js";import{I as P,_ as T}from"./index-fb59542d.js";const W=()=>{const{tenant_list:a}=B().props,{errors:d}=B().props,l=a!=null&&a.length?a.filter(t=>t.lease_currency_type.toUpperCase()==="USD"):[],c=a!=null&&a.length?a.filter(t=>t.lease_currency_type.toUpperCase()==="ZWG"):[],[N,g]=m.useState(l!=null&&l.length?l.reduce((t,r)=>t+Number(r.owing_amount),0):0),[_,i]=m.useState(c!=null&&c.length?c.reduce((t,r)=>t+Number(r.owing_amount),0):0),[n,u]=m.useReducer(D,l.map(t=>x(h({},t),{edited:!1,total:(t==null?void 0:t.owing_amount)||"",operationalCosts:""}))),[j,C]=m.useReducer(H,c.map(t=>x(h({},t),{edited:!1,total:(t==null?void 0:t.owing_amount)||"",operationalCosts:""}))),[A,Y]=m.useState(d),[z,S]=m.useState(!1);function D(t,r){switch(r.type){case"updateBaseRental":let o=t.map(s=>s.id===r.id?x(h({},s),{owing_amount:r.owing_amount,edited:!0,total:Number(s.operationalCosts)+Number(r.owing_amount)}):s);return g(o.reduce((s,p)=>s+Number(p.total),0)),o;case"updateOperatingCosts":let f=t.map(s=>s.id===r.id?x(h({},s),{edited:!0,operationalCosts:r.operationalCosts,total:Number(s.owing_amount)+Number(r.operationalCosts)}):s);return g(f.reduce((s,p)=>s+Number(p.total),0)),f;case"filterSubmittedInvoices":let b=t.filter(s=>!r.idsToFilter.includes(s.id));return g(b.reduce((s,p)=>s+Number(p.total),0)),b;default:return t}}function H(t,r){switch(r.type){case"updateBaseRental":let o=t.map(s=>s.id===r.id?x(h({},s),{owing_amount:r.owing_amount,edited:!0,total:Number(s.operationalCosts)+Number(r.owing_amount)}):s);return i(o.reduce((s,p)=>s+Number(p.total),0)),o;case"updateOperatingCosts":let f=t.map(s=>s.id===r.id?x(h({},s),{edited:!0,operationalCosts:r.operationalCosts,total:Number(s.owing_amount)+Number(r.operationalCosts)}):s);return i(f.reduce((s,p)=>s+Number(p.total),0)),f;case"filterSubmittedInvoices":let b=t.filter(s=>!r.idsToFilter.includes(s.id));return i(b.reduce((s,p)=>s+Number(p.total),0)),b;default:return t}}const E=()=>M(void 0,null,function*(){Y({});const t=[],r=[];if(S(!0),n.forEach(o=>{o.edited&&(t.push({leaseId:o.id,baseRental:o.owing_amount,operationCosts:o.operationalCosts}),r.push(o.id))}),j.forEach(o=>{o.edited&&(t.push({leaseId:o.id,baseRental:o.owing_amount,operationCosts:o.operationalCosts}),r.push(o.id))}),t.length===0){S(!1),T.error("No changes were made, please edit at least one invoice",{icon:"❌",duration:5e3});return}try{const o=yield k.post(reverseUrl("client_invoice"),t);u({type:"filterSubmittedInvoices",idsToFilter:r}),C({type:"filterSubmittedInvoices",idsToFilter:r}),T.success("Invoice created successfully",{icon:"✔"})}catch(o){T.error("Something went wrong! Please try again",{icon:"❌"}),Y(o.response.data.errors)}finally{S(!1)}});return e.jsxs("div",{className:"card card-raised mt-3 mb-5 mx-4",children:[e.jsxs("div",{className:"card-header px-4 bg-info",style:{height:"50px"},children:[e.jsx(P,{position:"top-right"}),e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"",children:e.jsxs("h2",{className:"display-6 text-white",children:["Rental Invoicing -"," ",y().date()>25?y().add(1,"months").format("MMMM YYYY"):y().format("MMMM YYYY")]})})})]}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",lineHeight:"15px",fontSize:"12px"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Inv. Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Lease No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Address"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Co. Reg. No. / ID No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Tenant Name"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Currency"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Base Rental"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Operating Costs"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Total"})]})}),e.jsxs("tbody",{children:[e.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:e.jsx("th",{scope:"row",children:"USD"})}),n!=null&&n.length?n.map(t=>e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsxs("th",{scope:"row",children:[t.payment_period_start,"-",y().format("MM-YYYY")," "]}),e.jsx("td",{children:t.id}),e.jsx("td",{children:t.address}),e.jsx("td",{children:t.reg_number}),e.jsx("td",{children:t.tenant_name}),e.jsx("td",{children:t.lease_currency_type}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.owing_amount,onChange:r=>u({type:"updateBaseRental",id:t.id,owing_amount:r.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.operationalCosts,onChange:r=>u({type:"updateOperatingCosts",id:t.id,operationalCosts:r.target.value})})}),e.jsx("td",{className:"text-end",children:w(t.total)})]},t.id)):"",e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsx("td",{colSpan:7}),e.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),e.jsx("td",{className:"text-end fw-bold",children:w(N)})]}),e.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:e.jsx("th",{scope:"row",children:"ZWG"})}),j!=null&&j.length?j.map(t=>e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsxs("th",{scope:"row",children:[t.payment_period_start,"-",y().format("MM-YYYY")," "]}),e.jsx("td",{children:t.id}),e.jsx("td",{children:t.address}),e.jsx("td",{children:t.reg_number}),e.jsx("td",{children:t.tenant_name}),e.jsx("td",{children:t.lease_currency_type}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.owing_amount,onChange:r=>C({type:"updateBaseRental",id:t.id,owing_amount:r.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.operationalCosts,onChange:r=>C({type:"updateOperatingCosts",id:t.id,operationalCosts:r.target.value})})}),e.jsx("td",{className:"text-end",children:w(t.total)})]},t.id)):"",e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsx("td",{colSpan:7}),e.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),e.jsx("td",{className:"text-end fw-bold",children:w(_)})]})]})]})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{onClick:E,className:"btn btn-info",children:z?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"processing.."})]}):e.jsx(e.Fragment,{children:"Submit"})})})]})]})};W.layout=a=>e.jsx(G,{children:a,title:"Tenant Invoicing"});export{W as default};
