import{j as e,r as n,u as Y,b as E,_ as q}from"./main-5c37eb2a.js";import{L as G}from"./Layout-779839f2.js";import{I as J}from"./InvoiceFormRow-3097044d.js";import{C as X}from"./ContentModal-bd5c0b74.js";import"./html2pdf-b7c8b9f4.js";import{N as Z}from"./NewPageHeader-c0cd0023.js";import"./lodash-9dd08774.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-bd16bbcb.js";import"./Modal-34f4a559.js";import"./index-5a5385bf.js";import"./formatting-fad57ba1.js";import"./MultipleUpload-041fb25a.js";import"./index-acacf113.js";import"./search-513e0541.js";function $({index:m,cashBooks:v,isLoading:i,itemsLength:f,paymentItem:d,paymentTypes:g,setPaymentItems:o,removePaymentItemRow:y}){return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{disabled:i||f===1,type:"button",onClick:()=>y(m),className:"btn btn-sm btn-danger p-0",children:e.jsx("i",{className:"material-icons",children:"close"})})}),e.jsx("td",{children:e.jsxs("select",{required:!0,disabled:i,defaultValue:d.paymentType,className:"form-select form-select-sm custom-w-2",children:[e.jsx("option",{disabled:!0,value:"",children:"Select type.."}),g.map((l,a)=>e.jsx("option",{value:l.id||l.type,children:l.type},a))]})}),e.jsx("td",{children:e.jsxs("select",{required:!0,disabled:i,defaultValue:d.cashBook,className:"form-select form-select-sm custom-w-2",children:[e.jsx("option",{disabled:!0,value:"",children:"Select cashbook.."}),v.map((l,a)=>e.jsx("option",{value:l.id||l.name,children:l.name},a))]})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm custom-w-1",disabled:i,value:d.detail,onChange:l=>o(a=>a.map((r,x)=>x===m?{...r,detail:l.target.value}:r))})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm custom-w-1",disabled:i,value:d.ref,onChange:l=>o(a=>a.map((r,x)=>x===m?{...r,ref:l.target.value}:r))})}),e.jsx("td",{children:e.jsx("input",{type:"number",required:!0,className:"form-control form-control-sm custom-w-1",disabled:i,value:d.amountReceived,onChange:l=>o(a=>a.map((r,x)=>x===m?{...r,amountReceived:l.target.value}:r))})}),e.jsx("td",{})]})}function ee(m,v){const[i,f]=n.useState(!1),[d,g]=n.useState("USD"),[o,y]=n.useState([]),[l,a]=n.useState([]),[r,x]=n.useState([]),[S,_]=n.useState([]),[F,R]=n.useState(0),[w,I]=n.useState(0),p=Y().props.Auth,[C,T]=n.useState(!1),k=n.useRef(),A=p?.user_profile?.first_name||p?.user_profile?.last_name||p?.user?.email||p?.company?.company_name||"N/A",[b,j]=n.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),[N,h]=n.useState([{paymentType:"",cashBook:"",detail:"",ref:"",amountReceived:0},{paymentType:"",cashBook:"",detail:"",ref:"",amountReceived:0}]);n.useEffect(()=>{D(),B()},[]);function D(){E.get("/accounting/items/").then(t=>{y(t.data)}).catch(t=>{console.log(t)})}function B(){E.get("/accounting/vat-settings/").then(t=>{a(t.data)}).catch(t=>{console.error(t)})}function M(){h(t=>[...t,{paymentType:"",cashBook:"",detail:"",ref:"",amountReceived:0}])}function O(t){h(s=>s.filter((u,c)=>t!==c))}function L(){j(t=>[...t,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function H(t){j(s=>s.filter((u,c)=>t!==c))}function z(t){if(t.preventDefault(),!b.length){q.error("Please add at least one item");return}const s=Object.fromEntries(new FormData(t.target).entries());s.items=b.map(u=>{const c={...u};return c.vat=(parseFloat(c.vat)||0)/100*(parseFloat(c.price)||0)*(parseFloat(c.qty)||0),delete c.static,c}),s.payment_items=N,Object.keys(P).forEach(u=>s[u]=P[u]),s.invoiceTotal+=Number(w),s.discount=Number(w),console.log(s),T(!0)}function K(t){j([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),g(t.target.value),R(s=>s+1)}const P=b?.reduce((t,s)=>{if(!s)return t;const u=parseFloat(s.qty)||0,c=(parseFloat(s.vat)||0)/100,V=parseFloat(s.price)||0;return t.totalExcludingVat+=V*u,t.vatTotal+=V*c*u,t.invoiceTotal+=parseFloat(s.total)||0,t},{totalExcludingVat:0,vatTotal:0,invoiceTotal:0});function Q(t){let s=parseFloat(t.target.value)||0;s>0?q.error("Discount should be input as a negative value"):I(s)}const U=()=>T(!1);function W(){}return{rep:A,key:F,items:b,totals:P,discount:w,currency:d,cashBooks:S,isLoading:i,salesItems:o,taxConfigs:l,contentRef:k,paymentItems:N,paymentTypes:r,selectedCurrency:null,shouldShowSuccessModal:C,addRow:L,setItems:j,onSubmit:z,removeRow:H,printInvoice:W,hideSuccessModal:U,changeCurrency:K,handleDiscount:Q,setPaymentItems:h,addPaymentItemRow:M,removePaymentItemRow:O}}function te(){const{rep:m,key:v,items:i,totals:f,discount:d,cashBooks:g,isLoading:o,salesItems:y,taxConfigs:l,contentRef:a,paymentItems:r,paymentTypes:x,selectedCurrency:S,shouldShowSuccessModal:_,addRow:F,setItems:R,onSubmit:w,removeRow:I,printInvoice:p,hideSuccessModal:C,changeCurrency:T,handleDiscount:k,setPaymentItems:A,addPaymentItemRow:b,removePaymentItemRow:j}=ee();return e.jsxs(e.Fragment,{children:[_&&e.jsx(X,{size:"md",title:"Invoice Saved",show:_,handleClose:C,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"my-4",children:"What action would you like to take?"}),e.jsxs("div",{className:"d-flex gap-3 justify-content-center align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-info text-white",onClick:p,children:"Print"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-danger",onClick:C,children:"No action"})]})]})}),e.jsx(Z,{title:"Fiscal Tax Invoice",noMargin:!0}),e.jsxs("form",{className:"py-3",onSubmit:w,children:[e.jsxs("div",{className:"p-4",ref:a,children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108"})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"bill_to",id:"bill_to",placeholder:"CASH SALE -",defaultValue:"CASH SALE - "})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"address",id:"address",placeholder:"Address..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"phone",id:"phone",placeholder:"Phone..."})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"email",id:"email",placeholder:"Email..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"vat_no",id:"vat_no",placeholder:"VAT No...."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"tin",id:"tin",placeholder:"TIN..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"rep",className:"form-label",children:"Rep:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"rep",id:"rep",value:m,readOnly:!0})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",value:new Date().toISOString().split("T")[0],id:"date",type:"date",readOnly:!0})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered bg-white table-responsive m-0",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:S?.id||"",name:"invoice_currency",id:"invoice_currency",onChange:T,children:e.jsx("option",{disabled:!0,value:"",children:"Select Currency"})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Price (Vat Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Vat Inc)"})]})]}),e.jsxs("tbody",{children:[i.map((N,h)=>e.jsx(J,{item:N,index:h,setItems:R,removeRow:I,salesItems:y,taxConfigs:l,selectedCurrency:S,itemsLength:i.length},h+"-"+v)),e.jsxs("tr",{className:"border-top-3",children:[e.jsx("th",{}),e.jsx("th",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:o,type:"button",className:"btn btn-sm btn-outline-info",onClick:F,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("th",{children:e.jsx("span",{children:f.totalExcludingVat.toFixed(2)})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{className:"text-end",colSpan:5,children:"Discount"}),e.jsx("th",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:d,max:0,step:.001,onChange:k,readOnly:o})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{className:"text-end",colSpan:5,children:"VAT Total"}),e.jsx("th",{children:f.vatTotal.toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsxs("th",{className:"text-end",colSpan:5,children:["Invoice Total ",S?.currency_code||""]}),e.jsx("th",{children:(f.invoiceTotal+d).toFixed(2)})]})]}),e.jsx("thead",{className:"text-center text-nowrap",children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Payment Type"}),e.jsx("th",{children:"Cash Book"}),e.jsx("th",{children:"Detail"}),e.jsx("th",{children:"Ref."}),e.jsx("th",{children:"Amount Received"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[r.map((N,h)=>e.jsx($,{index:h,cashBooks:g,isLoading:o,paymentItem:N,paymentTypes:x,itemsLength:r.length,setPaymentItems:A,removePaymentItemRow:j},h+"-"+v)),e.jsx("tr",{className:"border-top-3",children:e.jsx("td",{colSpan:7,children:e.jsxs("button",{disabled:o,type:"button",className:"btn btn-sm btn-outline-info",onClick:b,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]})})})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:o,className:"btn btn-info text-white",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})]})}te.layout=m=>e.jsx(G,{children:m,title:"Cash Sales"});export{te as default};
