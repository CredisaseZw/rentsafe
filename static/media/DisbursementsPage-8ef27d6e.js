import{r as w,a as y,b as v,_ as b,j as e}from"./main-5c244715.js";import{L as D}from"./Layout-b60b0d01.js";import{i as A,u as f}from"./index-f1738c83.js";import{D as S}from"./DisbursementsAsyncSelect-16423c80.js";import{N as O}from"./NewPageHeader-db234e2e.js";import"./lodash-8a516636.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-e1b110fd.js";import"./Modal-bb9e7ea7.js";import"./index-36250c36.js";import"./formatting-fad57ba1.js";import"./MultipleUpload-d000b528.js";import"./search-5302eb36.js";function R(){const[l,u]=w.useState(!1),{data:c,setData:m,reset:x}=y({rows:[{...N}]});function d(){const s={...N,id:c.rows.length+1};m(n=>({...n,rows:[...n.rows,s]}))}function j(s){m(n=>({...n,rows:n.rows.filter((t,i)=>i!==s)}))}const a=(s,n)=>{const{name:t,value:i}=s.target;t==="paidAmount"&&!A(i)&&i!==""||m(h=>({...h,rows:h.rows.map((p,g)=>g===n?{...p,[t]:i,netBalance:t==="paidAmount"?Number(p.amountOwing)-Number(i):p.netBalance}:p)}))};function o(s){s.preventDefault(),u(!0);const n={disbursements:c.rows.map(t=>({lease_id:t.leaseId,date:t.date,creditor:t.creditor,ref:t.ref,details:t.details,amount_paid:t.paidAmount,amount_owing:t.amountOwing,currency:t.currency}))};console.log({data:c,payload:n}),v.post(reverseUrl("create_disbursement"),n).then(t=>{console.log(t),(t.status===200||t.status===201)&&(b.success(f(t)),u(!1),x())}).catch(t=>{console.log(t),u(!1),b.error(f(t))})}function r(s,n){s&&(console.log(s,n),m(t=>({...t,rows:t.rows.map((i,h)=>h===n?{...i,leaseId:s.lease_id,creditor:s.landlord_id,amountOwing:s.amount,paidAmount:"",netBalance:s.amount}:i)})))}return{data:c,processing:l,addRow:d,removeRow:j,handleSubmit:o,handleInputChange:a,handleCreditorSelect:r}}const N={leaseId:void 0,id:1,date:new Date().toISOString().split("T")[0],creditor:"",ref:"",details:"",currency:"",amountOwing:"",paidAmount:"",netBalance:""};function _(){const{data:l,processing:u,addRow:c,removeRow:m,handleSubmit:x,handleInputChange:d,handleCreditorSelect:j}=R();return e.jsxs("div",{children:[e.jsx(O,{title:"Disbursements",noMargin:!0}),e.jsx("div",{children:e.jsxs("form",{onSubmit:x,children:[e.jsxs("table",{className:"bg-white table table-responsive table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-nowrap"}),e.jsx("th",{className:"text-nowrap",children:"Date"}),e.jsx("th",{className:"text-nowrap",children:"Creditor"}),e.jsx("th",{className:"text-nowrap",children:"Ref"}),e.jsx("th",{className:"text-nowrap",children:"Details"}),e.jsx("th",{className:"text-nowrap",children:"Currency"}),e.jsx("th",{className:"text-nowrap",children:"Amount Owing"}),e.jsx("th",{className:"text-nowrap",children:"Paid Amount"}),e.jsx("th",{className:"text-nowrap",children:"Net Balance"})]})}),e.jsx("tbody",{children:l.rows.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-1 py-0 border-end-0",children:l.rows.length>1&&e.jsx("button",{className:"btn btn-close btn-sm mt-3",onClick:()=>m(o)})}),e.jsx("td",{children:e.jsx("input",{className:"form-control custom-w-fit",type:"date",name:"date",value:a.date,onChange:r=>d(r,o),required:!0})}),e.jsx("td",{className:"custom-w-2",children:e.jsx(S,{handleCreditorSelect:j,index:o})}),e.jsx("td",{children:e.jsx("input",{onChange:r=>d(r,o),value:a.ref,className:"form-control",name:"ref",id:"ref"})}),e.jsx("td",{className:"custom-w-170",children:e.jsx("input",{className:"form-control",id:"details",name:"details",value:a.details,onChange:r=>d(r,o)})}),e.jsx("td",{className:"text-center",children:e.jsx("div",{className:"mt-2",children:a.currency||""})}),e.jsx("td",{className:"text-center",children:e.jsx("div",{className:"mt-2",children:a.amountOwing||""})}),e.jsx("td",{children:e.jsx("input",{required:!0,name:"paidAmount",value:a.paidAmount,onChange:r=>d(r,o),className:"form-control"})}),e.jsx("td",{children:e.jsx("input",{name:"netBalance",value:Number(a.netBalance).toFixed(2),readOnly:!0,className:"form-control custom-no-pointer-events"})})]},a.id))})]}),e.jsxs("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-success",onClick:c,children:e.jsx("i",{className:"material-icons",children:"add"})}),e.jsx("button",{type:"submit",className:"btn btn-info text-white gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{children:"Processing.."})]}):"Submit"})]})]})})]})}_.layout=l=>e.jsx(D,{children:l,title:"Disbursements"});export{_ as default};
