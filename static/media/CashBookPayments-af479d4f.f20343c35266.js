import{r as m,a as R,j as e}from"./main-5c37eb2a.js";import{L as T}from"./Layout-779839f2.js";import{D as P}from"./DisbursementsAsyncSelect-496b2e65.js";import{N as _}from"./NewPageHeader-c0cd0023.js";import"./lodash-9dd08774.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-bd16bbcb.js";import"./Modal-34f4a559.js";import"./index-5a5385bf.js";import"./formatting-fad57ba1.js";import"./MultipleUpload-041fb25a.js";import"./index-acacf113.js";import"./search-513e0541.js";const A={id:1,vat:!1,glAccount:"",type:"creditor",receiptNumber:"",opening_balance_date:"",paymentDate:new Date().toISOString().split("T")[0],leaseId:void 0,creditor:"",ref:"",details:"",currency:"",amountOwing:"",paidAmount:"",netBalance:""};function F(){const[r,b]=m.useState(0),[u,f]=m.useState([]),[g,y]=m.useState([]),[h,v]=m.useState(!1),[p,N]=m.useState(""),{data:x,setData:l,post:C,reset:S,processing:t}=R({myKey:"",rows:[A]}),j=!1;m.useEffect(()=>{},[]);function s(a){a.preventDefault();const o={...x,rate:r,selectedCashBookId:p};console.log(o)}function k(){l(a=>({...a,rows:[...a.rows,{...A,id:new Date().getTime()}]}))}function w(a){l(o=>({...o,rows:o.rows.filter(c=>c.id!==a)}))}function B(a,o){const{name:c,value:i}=a.target;l(d=>({...d,rows:d.rows.map(n=>n.id===o?{...n,[c]:i,netBalance:c==="paidAmount"?Number(n.amountOwing)-Number(i):n.netBalance}:n)}))}function I(a,o){let{name:c,value:i}=a.target;l(d=>({...d,rows:d.rows.map(n=>n.id===o?{...n,[c]:i,paymentAmount:c==="baseAmount"?Number(n.operatingCost)+Number(n.commission)+Number(i):c==="operatingCost"?Number(n.baseAmount)+Number(n.commission)+Number(i):c==="commission"?Number(n.baseAmount)+Number(n.operatingCost)+Number(i):Number(i)}:n)}))}function D(a,o){a&&(console.log(a,o),l(c=>({...c,rows:c.rows.map((i,d)=>d===o?{...i,leaseId:a.lease_id,creditor:a.landlord_id,amountOwing:a.amount,paidAmount:"",netBalance:a.amount}:i)})))}return{data:x,rate:r,cashBooks:u,glAccounts:g,processing:t,shouldInputRate:j,requestCloseFlag:h,selectedCashBookId:p,addRow:k,removeRow:w,setRate:b,handleSubmit:s,handleInputChange:B,handlePaymentAmount:I,handleCreditorSelect:D,setSelectedCashBookId:N}}function O(){const{data:r,rate:b,cashBooks:u,glAccounts:f,processing:g,shouldInputRate:y,selectedCashBookId:h,addRow:v,removeRow:p,setRate:N,handleSubmit:x,handleInputChange:l,handleCreditorSelect:C,setSelectedCashBookId:S}=F();return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Payments",color:"danger"}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 justify-content-center align-items-center",children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-center align-items-center gap-3 text-nowrap",children:[e.jsx("label",{htmlFor:"cash_book",className:"form-label",children:"Cash book:"}),e.jsxs("select",{className:"c-form-select",name:"cash_book",id:"cash_book",value:h,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select one"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"mb-3 d-flex justify-content-center align-items-center gap-3 text-nowrap",children:[e.jsx("label",{htmlFor:"currency",className:"form-label",children:"Currency:"}),e.jsx("div",{children:u.find(t=>t.id==h)?.currency})]})]}),e.jsxs("table",{className:"bg-white table table-responsive table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-nowrap",children:"Date"}),e.jsx("th",{className:"text-nowrap",children:"Pay Ref."}),e.jsx("th",{className:"text-nowrap",children:"Type (GL/C)"}),e.jsx("th",{className:"text-nowrap",children:"Account"}),e.jsx("th",{className:"text-nowrap",children:"Details"}),e.jsx("th",{className:"text-nowrap",children:"Total Pay (Inc. VAT)"}),e.jsx("th",{className:"text-nowrap",children:"VAT"}),e.jsx("th",{className:"text-nowrap",children:"Matching Invoice"}),e.jsx("th",{className:"text-nowrap",children:"Rate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:r.rows.map((t,j)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control custom-w-fit",name:"paymentDate",type:"date",required:!0,value:t.paymentDate,onChange:s=>l(s,t.id),max:new Date().toISOString().split("T")[0],min:t.type==="gl"?u.find(s=>s.id==h)?.opening_balance_date:t.minDate})}),e.jsx("td",{children:e.jsx("input",{readOnly:!0,value:t.receiptNumber,className:"form-control"})}),e.jsx("td",{children:e.jsxs("select",{className:"c-form-select py-2",name:"type",value:t.type,onChange:s=>l(s,t.id),children:[e.jsx("option",{value:"gl",children:"GL"}),e.jsx("option",{value:"creditor",children:"CR"})]})}),e.jsx("td",{className:"custom-w-2",children:t.type==="creditor"?e.jsx(P,{handleCreditorSelect:C,index:t.id}):t.type==="gl"?e.jsxs("select",{className:"c-form-select py-2 w-100",name:"glAccount",value:t.glAccount,onChange:s=>l(s,t.id),children:[e.jsx("option",{value:"",disabled:!0,children:"Select one"}),f.map(s=>e.jsx("option",{value:s.id,children:`${s.number} - ${s.name}`},s.id))]}):""}),e.jsx("td",{className:"custom-w-170",children:e.jsx("input",{placeholder:"...",className:"form-control",name:"details",value:t.details,onChange:s=>l(s,t.id)})}),e.jsx("td",{children:e.jsx("input",{required:!0,name:"paidAmount",placeholder:"0.00",type:"number",value:t.paidAmount,onChange:s=>l(s,t.id),className:"form-control custom-mn-w-1"})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{name:"vat",type:"checkbox",value:"yes",disabled:t.type==="gl",checked:t.vat,onChange:s=>l(s,t.id),className:"form-check"})}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"rate",className:"form-control custom-mn-w-07",value:b,onChange:s=>N(s.target.value),placeholder:"0",disabled:!y})}),e.jsx("td",{children:e.jsx("button",{disabled:r.rows.length===1,className:"btn btn-danger btn-sm",onClick:()=>p(t.id),children:e.jsx("i",{className:"material-icons",children:"close"})})})]},t.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"text-end fw-bold",children:"Batch Total:"}),e.jsx("td",{className:"text-end fw-bold",children:r.rows.reduce((t,j)=>t+Number(j.paymentAmount||0),0).toFixed(2)}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{})]})})]}),e.jsxs("div",{className:"px-2 d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-success",onClick:v,children:e.jsx("i",{className:"material-icons",children:"add"})}),e.jsx("button",{type:"submit",className:"btn btn-info text-white gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{children:"Processing.."})]}):"Submit"})]})]})]})}O.layout=r=>e.jsx(T,{children:r,title:"Cash Book Payments"});export{O as default};
