import{r as h,j as e,_ as w,b as T,R,u as X,d as H}from"./main-5c244715.js";import{L as W}from"./Layout-b60b0d01.js";import{S as Z}from"./SearchBar-10535d23.js";import{u as k,f as B}from"./index-f1738c83.js";import{C as ee}from"./ContentModal-8811285d.js";import{u as te}from"./useCurrencies-5401186f.js";import{U as se}from"./UserSelector-ca5a6970.js";import{I as ne}from"./InvoiceFormRow-b3b30ca2.js";import{u as ae,c as re}from"./Modal-bb9e7ea7.js";import"./lodash-8a516636.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-e1b110fd.js";import"./formatting-fad57ba1.js";import"./MultipleUpload-d000b528.js";import"./search-5302eb36.js";import"./index-36250c36.js";const $=h.forwardRef(({bsPrefix:t,variant:l,animation:a="border",size:d,as:u="div",className:c,...x},i)=>{t=ae(t,"spinner");const f=`${t}-${a}`;return e.jsx(u,{ref:i,...x,className:re(c,f,d&&`${f}-${d}`,l&&`text-${l}`)})});$.displayName="Spinner";const le=$;function ce(t,l,a){const[d,u]=h.useState(null),[c,x]=h.useState(!1),[i,f]=h.useState(!1),[p,N]=h.useState([]),[C,b]=h.useState([]),[m,o]=h.useState(0),[j,D]=h.useState(0),[L,F]=h.useState(null),{currencies:g,loading:A}=te(),[v,y]=h.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);h.useEffect(()=>{g.length>0&&!L&&F(g[0])},[g.length]),h.useEffect(()=>{if(t){const s={document_number:t.document_number,bill_to:t.bill_to,address:t.address,phone:t.phone,email:t.email,vat_no:t.vat_no,tin:t.tin,currency:t.currency,monthly_rental:t.monthly_rental};u(s);const n=g.find(r=>r.id==s.currency||String(r.currency_code).toLowerCase().includes(String(s.currency).toLowerCase()));n?F(n):w.error("could not auto-set invoice currency"),y([s.monthly_rental])}},[t]),h.useEffect(()=>{q(),E()},[]);function q(){T.get("/accounting/items/").then(s=>{N(s.data)}).catch(s=>{console.log(s)})}function E(){T.get("/accounting/vat-settings/").then(s=>{b(s.data)}).catch(s=>{console.error(s)})}function _(){y([...v,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function S(s){const n=v.filter((r,I)=>I!==s);y(n)}function Y(){f(!0)}function J(){f(!1)}function z(s){if(s.preventDefault(),!v.length){w.error("Please add at least one item");return}const n=Object.fromEntries(new FormData(s.target).entries());n.items=v.map(r=>({sales_item_id:p.find(V=>V.name=r.sales_item)?.id||"",quantity:r.qty||1,unit_price:r.price})),Object.keys(O).forEach(r=>n[r]=O[r]),n.invoiceTotal+=Number(j),n.discount=Number(j),n.invoice_type=l?"proforma":t?"recurring":"fiscal",n.is_individual=n.customer_type==="INDIVIDUAL",T.post("/accounting/invoices/",n).then(r=>{console.log(r),r.status===201?(w.success(k("Invoice created successfully")),y([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),D(0),o(I=>I+1),f(!1),a&&a()):w.error(k(r))}).catch(r=>{console.error(r),w.error(k(r))})}function G(s){y([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);const n=g.find(r=>r.id==s.target.value);n?(F(n),o(r=>r+1)):w.error("error selecting currency")}const O=v?.reduce((s,n)=>{if(!n)return s;const r=parseFloat(n.qty)||0,I=(parseFloat(n.vat)||0)/100,V=parseFloat(n.price)||0;return s.totalExcludingVat+=V*r,s.vatTotal+=V*I*r,s.invoiceTotal+=parseFloat(n.total)||0,s},{totalExcludingVat:0,vatTotal:0,invoiceTotal:0});function K(s){let n=parseFloat(s.target.value)||0;n>0?w.error("Discount should be input as a negative value"):D(n)}function Q(s){const n={address:s.address,phone:s.mobile,email:s.email,vat_no:s.VAT_number,tin:s.tin_number};u(n)}return{key:m,show:i,items:v,totals:O,discount:j,salesItems:p,currencies:g,taxConfigs:C,invoiceData:d,selectedCurrency:L,isLoading:c||A,addRow:_,setItems:y,onSubmit:z,removeRow:S,handleShow:Y,handleClose:J,changeCurrency:G,handleDiscount:K,handleUserSelected:Q}}function U({invoice:t,triggerClassname:l,triggerChildren:a,isProforma:d,onClose:u}){const{key:c,show:x,items:i,totals:f,discount:p,isLoading:N,salesItems:C,currencies:b,taxConfigs:m,invoiceData:o,selectedCurrency:j,addRow:D,setItems:L,onSubmit:F,removeRow:g,handleShow:A,handleClose:v,changeCurrency:y,handleDiscount:q,handleUserSelected:E}=ce(t,d,u);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:l||"btn btn-info text-white",onClick:A,children:a||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(ee,{size:"xl",show:x,handleClose:v,title:d?"PROFORMA":"FISCAL TAX INVOICE",children:e.jsxs("form",{className:"py-3 position-relative",onSubmit:F,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!o?.document_number,defaultValue:o?.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center justify-content-between",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),o?.bill_to?e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"customer_id",id:"customer_id",readOnly:!0,value:o?.bill_to}):e.jsx(se,{onChange:E})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:o?.address,readOnly:!!o?.address})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:o?.phone,readOnly:!!o?.phone})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:o?.email,readOnly:!!o?.email})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:o?.vat_no,readOnly:!!o?.vat_no})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:o?.tin,readOnly:!!o?.tin})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().setDate(1)).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!o})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"",children:e.jsx("div",{children:e.jsx("select",{className:"bg-danger text-white py-2 px-4 rounded-3",value:j?.id||"",name:"currency_id",id:"currency_id",onChange:y,children:o?.currency?e.jsx("option",{value:o.currency,children:o.currency}):e.jsxs(e.Fragment,{children:[e.jsx("option",{disabled:!0,value:"",children:"Select Currency"}),b?.map((_,S)=>e.jsxs("option",{value:_.id,children:[_.currency_code," (",_.currency_name,")"]},S))]})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Price (Vat Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Vat Inc)"})]})]}),e.jsx("tbody",{children:i.map((_,S)=>e.jsx(ne,{item:_,index:S,setItems:L,removeRow:g,salesItems:C,taxConfigs:m,selectedCurrency:j,itemsLength:i.length},S+"-"+c))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-info",onClick:D,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:f.totalExcludingVat.toFixed(2)})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:p,max:0,step:.001,onChange:q})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:f.vatTotal.toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Invoice Total ",j?.currency_code||""]}),e.jsx("td",{children:(f.invoiceTotal+p).toFixed(2)})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{className:"btn btn-info text-white",children:"Submit"})}),N&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center text-center bg-white bg-opacity-75",children:e.jsx(le,{className:"mb-5"})})]})})]})}function ie(t){const[l,a]=R.useState([]),[d,u]=R.useState(!1);function c(){u(!0);const x=t?"proforma-invoices/":"fiscal-invoices/";T.get("/accounting/invoices/"+x).then(i=>{a(i.data),u(!1)}).catch(i=>{console.log(i),u(!1)})}return R.useEffect(()=>{c()},[]),{loading:d,invoiceList:l,reloadInvoices:c}}function oe(t){const[l,a]=h.useState([]),{loading:d,invoiceList:u,reloadInvoices:c}=ie(t),{url:x}=X(),i=new URL(x).searchParams,f=i.get("year"),p=i.get("month"),N=i.get("invoice");h.useEffect(()=>{if(!u.length)return;const b=u.map(m=>({date:m.date_created?new Date(m.date_created):null,invoice:m})).filter(m=>N?`${m.invoice.customer_details?.full_name}###${m.invoice.id}###${m.invoice.currency?.currency_code}`.toLowerCase().includes(N.toLowerCase()):!0).filter(m=>m.date&&f?m.date.getFullYear()===Number(f):!0).filter(m=>m.date&&p?m.date.getMonth()+1===Number(p):!0).map(m=>m.invoice);a(b)},[f,p,N,u.length]);function C(b){b.preventDefault();const m=b.target.year.value,o=b.target.month.value,j=new URL(x);j.searchParams.set("year",m),j.searchParams.set("month",o),H.Inertia.replace(j.href,{preserveState:!0})}return{loading:d,invoiceList:l,applyFilters:C,reloadInvoices:c}}function M({isProforma:t=!1}){const{loading:l,invoiceList:a,applyFilters:d,reloadInvoices:u}=oe(t);return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:d,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((c,x)=>e.jsx("option",{value:new Date().getFullYear()-x,children:new Date().getFullYear()-x},x))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success text-nowrap",children:"Apply Filter"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(Z,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:[t?"Proforma":""," Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(U,{isProforma:t,onClose:u})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):a?.length?a?.map((c,x)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:c.id}),e.jsx("td",{className:"ps-3",children:c.date_created&&B(c.date_created)}),e.jsx("td",{className:"ps-3",children:c.customer_details.full_name}),e.jsx("td",{className:"ps-3",children:c.currency.currency_code}),e.jsx("td",{className:"ps-3 text-end",children:c.total_inclusive&&!Number.isNaN(Number(c.total_inclusive))?Number(c.total_inclusive).toFixed(2):""}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{disabled:!0,className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},x)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}function de(){const[t,l]=h.useState(!1),[a,d]=h.useState();function u(){l(!0),T.get("/accounting/invoices/recurring-invoices/").then(c=>{console.log(c);const x=c.data.map(i=>({id:i.id,date_created:B(new Date),customer_acc:"",customer:i.tenant_name,document_number:"",bill_to:i.tenant_name,address:i.address,phone:"",email:"",vat_no:"",tin:"",currency:i.lease_currency_type,monthly_rental:{static:!0,sales_code:"",sales_item:`"Rent - ${i.payment_period_start} ${new Date().getMonth()+1}`,price:i.owing_amount,qty:1,vat_id:"",total:i.owing_amount}}));d(x)}).catch(console.log).finally(()=>l(!1))}return h.useEffect(()=>{u()},[]),{loading:t,invoiceList:a}}function me(){const{loading:t,invoiceList:l}=de();return e.jsx("div",{children:e.jsx("div",{children:e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsxs("thead",{className:"position-sticky c-table-top shadow-sm bg-white c-z-5",children:[e.jsx("tr",{children:e.jsx("th",{colSpan:6,className:"p-0",children:e.jsx("div",{className:" bg-danger text-white text-center p-2",children:"Recurring Invoices"})})}),e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Invoice Date"}),e.jsx("th",{children:"Customer Acc"}),e.jsx("th",{children:"Customer Name"}),e.jsx("th",{}),e.jsx("th",{})]})]}),e.jsx("tbody",{children:t?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):l?.length?l?.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:a.id}),e.jsx("td",{className:"ps-3",children:a.date_created&&B(a.date_created)}),e.jsx("td",{className:"ps-3",children:a.customer_acc||""}),e.jsx("td",{className:"ps-3",children:a.customer}),e.jsx("td",{className:"p-0 ",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx(U,{invoice:a,triggerChildren:"Generate",triggerClassname:"btn btn-sm w-100  justify-content-center btn-danger"})})}),e.jsx("td",{className:"p-0",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-dark text-white",children:e.jsx("span",{children:"-"})})})})]},d)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})})})}function ue(){return e.jsx(M,{isProforma:!0})}const P=[{key:"Invoice",Content:M},{key:"Recurring",Content:me},{key:"Proforma",Content:ue}];function he(){const[t,l]=R.useState(P[0]);return{tabs:P,activeTab:t,setActiveTab:l}}function xe(){const{tabs:t,activeTab:l,setActiveTab:a}=he();return e.jsxs("div",{children:[e.jsx("div",{className:"d-flex gap-2 mb-3",children:t.map(d=>e.jsx("button",{onClick:()=>a(d),className:`btn ${l===d?"btn-info text-white":"border border-2"}`,children:d.key},d.key))}),e.jsx("div",{children:e.jsx(l.Content,{})})]})}xe.layout=t=>e.jsx(W,{children:t,title:"Sales Invoicing"});export{xe as default};
