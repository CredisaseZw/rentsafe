import{r as d,a as w,j as e}from"./main-5c244715.js";import{C as F,L as O}from"./Layout-b60b0d01.js";import{N as P}from"./NewPageHeader-db234e2e.js";import"./lodash-8a516636.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-e1b110fd.js";import"./Modal-bb9e7ea7.js";import"./index-36250c36.js";import"./formatting-fad57ba1.js";import"./MultipleUpload-d000b528.js";import"./index-f1738c83.js";import"./search-5302eb36.js";const _={id:1,color:"",tenant:"",details:"",currency:"",glAccount:"",rent_owing:"",type:"customer",paymentAmount:"",receiptNumber:"",isVariable:!1,accountBalance:"",opening_balance_date:"",paymentDate:new Date().toISOString().split("T")[0]};function V(){const[m,x]=d.useState(0),[p,y]=d.useState([]),[j,C]=d.useState([]),[h,v]=d.useState(!1),[b,g]=d.useState(""),{data:u,setData:o,post:A,reset:N,processing:f}=w({myKey:"",rows:[_]}),t=!1;d.useEffect(()=>{},[]);function S(n){n.preventDefault();const i={...u,rows:u.rows.map(a=>({...a,accountBalance:Number(a.accountBalance)-Number(a.paymentAmount)})),rate:m,selectedCashBookId:b};console.log(i)}function s(){o(n=>({...n,rows:[...n.rows,{..._,id:new Date().getTime()}]}))}function R(n){o(i=>({...i,rows:i.rows.filter(a=>a.id!==n)}))}function k(n,i){const{name:a,value:c}=n.target;o(r=>({...r,rows:r.rows.map(l=>l.id===i?{...l,[a]:c}:l)}))}function B(n,i){let{name:a,value:c}=n.target;o(r=>({...r,rows:r.rows.map(l=>l.id===i?{...l,[a]:c,paymentAmount:a==="baseAmount"?Number(l.operatingCost)+Number(l.commission)+Number(c):a==="operatingCost"?Number(l.baseAmount)+Number(l.commission)+Number(c):a==="commission"?Number(l.baseAmount)+Number(l.operatingCost)+Number(c):Number(c)}:l)}))}function I(n,i){if(!n)return;console.log(n);const a=new Date(n.opening_balance_date).toISOString().split("T")[0];o(c=>({...c,rows:c.rows.map(r=>r.id===i?{...r,minDate:a,tenant:n.tenant,lease_id:n.lease_id,currency:n.Currency,opening_balance_date:n.opening_balance_date,rent_owing:n.rent_owing,accountBalance:n.rent_owing-(r.paymentAmount||""),color:n.color,isVariable:n.is_variable,...n.is_variable?{baseAmount:"",commission:"",operatingCost:""}:{}}:r)}))}return{data:u,rate:m,cashBooks:p,glAccounts:j,processing:f,shouldInputRate:t,requestCloseFlag:h,selectedCashBookId:b,addRow:s,removeRow:R,setRate:x,handleSubmit:S,handleInputChange:k,handleTenantSelect:I,handlePaymentAmount:B,setSelectedCashBookId:g}}function q(){const{data:m,rate:x,cashBooks:p,glAccounts:y,processing:j,shouldInputRate:C,selectedCashBookId:h,addRow:v,removeRow:b,setRate:g,handleSubmit:u,handleInputChange:o,handleTenantSelect:A,handlePaymentAmount:N,setSelectedCashBookId:f}=V();return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Receipts",color:"dark"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 justify-content-center align-items-center",children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-center align-items-center gap-3 text-nowrap",children:[e.jsx("label",{htmlFor:"cash_book",className:"form-label",children:"Cash book:"}),e.jsxs("select",{className:"c-form-select",name:"cash_book",id:"cash_book",value:h,onChange:t=>f(t.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select one"}),p.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"mb-3 d-flex justify-content-center align-items-center gap-3 text-nowrap",children:[e.jsx("label",{htmlFor:"currency",className:"form-label",children:"Currency:"}),e.jsx("div",{children:p.find(t=>t.id==h)?.currency})]})]}),e.jsxs("table",{className:"bg-white table table-responsive table-bordered table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-nowrap",children:"Date"}),e.jsx("th",{className:"text-nowrap",children:"Receipt Number"}),e.jsx("th",{className:"text-nowrap",children:"Type (GL/C)"}),e.jsx("th",{className:"text-nowrap",children:"Account"}),e.jsx("th",{className:"text-nowrap",children:"Details"}),e.jsx("th",{className:"text-nowrap",children:"Amount"}),e.jsx("th",{className:"text-nowrap",children:"Matching Invoice"}),e.jsx("th",{className:"text-nowrap",children:"Rate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:m.rows.map((t,S)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control custom-w-fit",name:"paymentDate",type:"date",required:!0,value:t.paymentDate,onChange:s=>o(s,t.id),max:new Date().toISOString().split("T")[0],min:t.minDate})}),e.jsx("td",{children:e.jsx("input",{readOnly:!0,value:t.receiptNumber,className:"form-control"})}),e.jsx("td",{children:e.jsxs("select",{className:"c-form-select py-2",name:"type",value:t.type,onChange:s=>o(s,t.id),children:[e.jsx("option",{value:"gl",children:"GL"}),e.jsx("option",{value:"customer",children:"Customer"})]})}),e.jsx("td",{className:"custom-w-2",children:t.type==="customer"?e.jsx(F,{extraProps:{className:"w-100",required:!0},url:reverseUrl("get_all_active_leases"),onChange:s=>A(s,t.id),value:t.tenant?{label:t.tenant,value:t.lease_id}:null,defaultValue:null,isDisabled:!1}):t.type==="gl"?e.jsxs("select",{className:"c-form-select py-2 w-100",name:"glAccount",value:t.glAccount,onChange:s=>o(s,t.id),children:[e.jsx("option",{value:"",disabled:!0,children:"Select one"}),y.map(s=>e.jsx("option",{value:s.id,children:`${s.number} - ${s.name}`},s.id))]}):""}),e.jsx("td",{className:"custom-w-170",children:e.jsx("input",{placeholder:"...",className:"form-control",name:"details",value:t.details,onChange:s=>o(s,t.id)})}),e.jsxs("td",{children:[e.jsx("input",{required:!0,name:"paymentAmount",placeholder:"0.00",type:"number",value:t.paymentAmount,onChange:s=>o(s,t.id),className:t.isVariable?"form-control border-2 custom-no-pointer-events":"form-control custom-mn-w-1",readOnly:t.isVariable}),t.isVariable&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("label",{className:"small form-label",children:"Rent"}),e.jsx("input",{name:"baseAmount",type:"number",className:"form-control form-control-sm",value:t.baseAmount,onChange:s=>N(s,t.id)})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("label",{className:"small form-label",children:"OPC"}),e.jsx("input",{name:"operatingCost",type:"number",className:"form-control form-control-sm",value:t.operatingCost,onChange:s=>N(s,t.id)})]})]})]}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"rate",className:"form-control custom-mn-w-07",value:x,onChange:s=>g(s.target.value),placeholder:"0",disabled:!C})}),e.jsx("td",{children:e.jsx("button",{disabled:m.rows.length===1,className:"btn btn-danger btn-sm",onClick:()=>b(t.id),children:e.jsx("i",{className:"material-icons",children:"close"})})})]},t.id))})]}),e.jsxs("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-success",onClick:v,children:e.jsx("i",{className:"material-icons",children:"add"})}),e.jsx("button",{type:"submit",className:"btn btn-info text-white gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{children:"Processing.."})]}):"Submit"})]})]})]})}q.layout=m=>e.jsx(O,{children:m,title:"Cash Book Receipts"});export{q as default};
