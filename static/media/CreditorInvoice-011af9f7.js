import{r as i,u as k,b as C,d as B,j as e}from"./main-5c37eb2a.js";import{f as z}from"./index-acacf113.js";import{S as E}from"./SearchBar-e66e6ff5.js";import{L as G}from"./Layout-779839f2.js";import{C as P}from"./ContentModal-bd5c0b74.js";import{D as V}from"./DisbursementsAsyncSelect-496b2e65.js";import{N as Y}from"./NewPageHeader-c0cd0023.js";import"./formatting-fad57ba1.js";import"./lodash-9dd08774.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-bd16bbcb.js";import"./Modal-34f4a559.js";import"./index-5a5385bf.js";import"./MultipleUpload-041fb25a.js";import"./search-513e0541.js";function q(){const[h,w]=i.useState([]),[j,m]=i.useState([{date:new Date().toISOString().split("T")[0],creditor:"",details:"",inv_ref:"",gl_acc_number:"",currency:"",total_amount_inc:0,vat:0,net_amount_excl:0,rate:0}]),[g,p]=i.useState(!1),[b,u]=i.useState(!1),{url:v}=k(),[f,N]=i.useState([]),[c,y]=i.useState([]),[_,S]=i.useState(void 0);function n(){C.get(reverseUrl("rate_setup")).then(t=>{const l=t?.data?.currency_settings;l&&S(l.base_currency)}).catch(t=>{console.log(t)})}function a(){C.get("/accounting/ledger-accounts/").then(t=>{console.log("ledger-accounts",t),N(t.data),u(!1)}).catch(t=>{console.log(t),u(!1)})}function s(){C.get("/accounting/vat-settings/").then(t=>{console.log(t),y(t.data),u(!1)}).catch(t=>{console.log(t),u(!1)})}i.useEffect(()=>{a(),s(),n()},[v]);function x(t){t.preventDefault();const l=t.target.year.value,o=t.target.month.value,r=new URL(v);r.searchParams.set("year",l),r.searchParams.set("month",o),B.Inertia.replace(r.href,{preserveState:!0})}function R(t){t.preventDefault(),console.log({rows:j})}function O(){m(t=>[...t,{date:new Date().toISOString().split("T")[0],creditor:"",details:"",inv_ref:"",gl_acc_number:"",currency:"",total_amount_inc:0,vat:0,net_amount_excl:0,rate:0}])}const M=t=>m(l=>l.filter((o,r)=>r!==t));function F(t,l){const{name:o,value:r}=t.target;m(L=>{const d=[...L],A=d[l];let D=Number((o==="vat"?r:A.vat)||0)||0,I=Number((o==="total_amount_inc"?r:A.total_amount_inc)||0)||0,U=100*I/(100+D);return d[l]={...d[l],[o]:r},d[l].total_amount_inc=I,d[l].vat=D,d[l].net_amount_excl=U.toFixed(2),d})}function T(t,l){t&&m(o=>{const r=[...o];return r[l]={...r[l],creditor:t.landlord_id},r})}return{rows:j,loading:b,glAccounts:f,vatOptions:c,showAddModal:g,baseCurrency:_,creditorInvoices:h,handleCreditorSelect:T,handleFilters:x,handleSubmit:R,handleChange:F,openAddModal:()=>p(!0),handleClose:()=>p(!1),removeRow:M,addRow:O}}function J(){const{rows:h,loading:w,glAccounts:j,vatOptions:m,showAddModal:g,baseCurrency:p,creditorInvoices:b,handleCreditorSelect:u,handleFilters:v,openAddModal:f,handleSubmit:N,handleChange:c,handleClose:y,removeRow:_,addRow:S}=q();return e.jsxs("div",{children:[e.jsx(P,{size:"xl",titleOverideContent:e.jsx("div",{className:"bg-danger mb-4 text-white p-1 rounded-2 text-center",children:"Creditor Invoice"}),show:g,handleClose:y,centerTitle:!0,children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Date"}),e.jsx("th",{children:"Creditor "}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Inv Ref"}),e.jsx("th",{children:"GL Acc Number"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Total Amount (Inc)"}),e.jsx("th",{className:"text-end",children:"VAT"}),e.jsx("th",{className:"text-end",children:"Net Amount (Excl)"}),e.jsx("th",{className:"text-end",children:"Rate"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[h?.map((n,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"date",name:"date",value:n.date,max:new Date().toISOString().split("T")[0],onChange:s=>c(s,a),className:"form-control"})}),e.jsx("td",{children:e.jsx(V,{handleCreditorSelect:u,index:a})}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"details",value:n.details,onChange:s=>c(s,a),className:"form-control"})}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"inv_ref",value:n.inv_ref,onChange:s=>c(s,a),className:"form-control"})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",name:"gl_acc_number",id:"gl_acc_number",value:n.gl_acc_number,onChange:s=>c(s,a),children:[e.jsx("option",{value:"",children:"Select one"}),j.map((s,x)=>e.jsx("option",{value:s.id,children:s.name},x))]})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",name:"currency",id:"currency",value:n.currency,onChange:s=>c(s,a),children:[e.jsx("option",{value:"",disabled:!0,children:"Select one"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"zig",children:"ZIG"})]})}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"total_amount_inc",value:n.total_amount_inc,onChange:s=>c(s,a),className:"form-control"})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",name:"vat",id:"vat",value:n.vat,onChange:s=>c(s,a),children:[e.jsx("option",{value:"",children:"Select one"}),m.map((s,x)=>e.jsx("option",{value:s.id,children:s.rate},x))]})}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"net_amount_excl",value:n.net_amount_excl,readOnly:!0,className:"form-control"})}),e.jsx("td",{children:e.jsx("input",{type:"number",disabled:String(p).trim().toUpperCase()===String(n.currency).trim().toUpperCase(),name:"rate",value:n.rate,onChange:s=>c(s,a),className:"form-control"})}),e.jsx("td",{children:e.jsx("button",{disabled:h.length===1,type:"button",className:"btn btn-dark btn-sm",onClick:()=>_(a),children:e.jsx("i",{className:"material-icons",children:"close"})})})]},a)),e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:e.jsxs("button",{type:"button",className:"btn btn-outline-info btn-sm",onClick:S,children:[e.jsx("i",{className:"material-icons me-2",children:"add"}),"Add Row"]})})})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsx("button",{type:"submit",className:"btn btn-info text-white",children:"Submit"})})]})}),e.jsx(Y,{title:"Creditor Invoice",color:"danger"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:v,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,value:new Date().getFullYear(),onChange:n=>c(n,index),children:new Array(new Date().getFullYear()-2020).fill(0).map((n,a)=>e.jsx("option",{value:new Date().getFullYear()-a,children:new Date().getFullYear()-a},a))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,value:(new Date().getMonth()+1).toString(),onChange:n=>c(n,index),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(E,{placeholder:"Search...",searchBy:"q"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Creditor Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsxs("button",{className:"btn btn-danger",onClick:f,children:[e.jsx("i",{className:"material-icons me-2",children:"add"}),"New"]})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-danger shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. Date"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Inv. Number"}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Net Amount"}),e.jsx("th",{className:"text-end",children:"VAT"}),e.jsx("th",{className:"text-end",children:"Total Amount"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):b?.length?b?.map((n,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.date_created&&z(n.date_created)}),e.jsx("td",{className:"ps-3",children:n.supplier}),e.jsx("td",{className:"ps-3",children:n.invoice_number}),e.jsx("td",{className:"ps-3",children:n.details}),e.jsx("td",{className:"ps-3",children:n.currency}),e.jsx("td",{className:"ps-3 text-end",children:n.net_amount}),e.jsx("td",{className:"ps-3 text-end",children:n.vat}),e.jsx("td",{className:"ps-3 text-end",children:n.total_amount})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}J.layout=h=>e.jsx(G,{children:h,title:"Creditor Invoices"});export{J as default};
