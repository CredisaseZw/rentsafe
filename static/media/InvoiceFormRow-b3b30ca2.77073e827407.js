import{r as w,j as e}from"./main-5c244715.js";import{C as g}from"./ContentModal-8811285d.js";function N(t,c,d,u,h){const[m,p]=w.useState(null),[y,o]=w.useState(!1),[x,f]=w.useState(1);function v(r){const n=h.find(l=>l.item_id===r.target.value);if(n.currency_object.id!=u){o(!0),p(n);return}const a=n.tax_configuration_object,i=(a?.rate||0)/100*(n?.price||0),s=i*(t.qty||0),b=(n?.price||0)*(t.qty||0)+s;d(l=>l.map((j,C)=>C===c?{...j,sales_code:n?.item_id||"",sales_item:n?.name||"",price:(Number(n?.price||0)+i).toFixed(2)||"",vat:a?.rate||0,total:b.toFixed(2)}:j))}function _(){const r={...m};r.price=parseFloat(x)*(parseFloat(r.price)||0),r.unit_price_currency=u;const n=r.tax_configuration_object,a=n.rate/100*(r?.price||0),i=a*(t.qty||0),s=(r?.price||0)*(t.qty||0)+i;d(b=>b.map((l,j)=>j===c?{...l,sales_code:r?.item_id||"",sales_item:r?.name||"",price:(Number(r?.price||0)+a).toFixed(2)||"",vat:n?.rate||0,total:s.toFixed(2)}:l)),p(null),o(!1),f(1)}function S(r){d(n=>n.map((a,i)=>{if(i===c){const s=parseFloat(r.target.value)||0,l=(parseFloat(t.price)||0)*s,j=l*t.vat/100;return{...a,qty:r.target.value,total:l+j}}else return a}))}return{handleQtyChange:S,showCurrencyPrompt:y,propmtedCurrencyRate:x,preSelectedSalesItem:m,setPreSelectedSalesItem:p,setShowCurrencyPrompt:o,handleSalesItemSelect:v,setPromptedCurrencyRate:f,proceedToHandleSalesItemSelect:_}}function I({item:t,index:c,setItems:d,itemName:u,removeRow:h,salesItems:m,taxConfigs:p,itemsLength:y,selectedCurrency:o}){if(!o)return e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center text-danger p-3",children:["Please set a currency for this ",u||"invoice"]})});const{showCurrencyPrompt:x,propmtedCurrencyRate:f,preSelectedSalesItem:v,handleQtyChange:_,setShowCurrencyPrompt:S,handleSalesItemSelect:r,setPromptedCurrencyRate:n,setPreSelectedSalesItem:a,proceedToHandleSalesItemSelect:i}=N(t,c,d,o.id,m);return e.jsxs(e.Fragment,{children:[x&&e.jsx(F,{itemName:u,selectedCurrency:o,showCurrencyPrompt:x,propmtedCurrencyRate:f,preSelectedSalesItem:v,setShowCurrencyPrompt:S,setPromptedCurrencyRate:n,setPreSelectedSalesItem:a,proceedToHandleSalesItemSelect:i}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{disabled:t.static||y===1,type:"button",onClick:()=>h(c),className:"btn btn-sm btn-danger p-0",children:e.jsx("i",{className:"material-icons",children:"close"})})}),e.jsx("td",{children:t.static?t.sales_item:e.jsxs("select",{required:!0,value:t.sales_code,onChange:r,className:"form-select form-select-sm custom-w-2",children:[e.jsx("option",{disabled:!0,value:"",children:"Select item.."}),m.map(s=>e.jsx("option",{value:s.item_id,children:`${s.item_id} - ${s.name}`},s.id))]})}),e.jsx("td",{children:e.jsxs("div",{className:"text-center custom-mn-w-1 custom-mx-w-2",children:[t.sales_code," ",e.jsx("br",{})]})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:t.price||""})}),e.jsx("td",{children:t.static?t.qty:e.jsx("input",{type:"number",name:"quantity",id:"quantity",className:"form-control form-control-sm custom-w-1",value:t.qty,required:!0,onChange:_})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:t.vat?t.vat+"%":""})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:(parseFloat(t.total)||0).toFixed(2)})})]})]})}function F({itemName:t,selectedCurrency:c,showCurrencyPrompt:d,propmtedCurrencyRate:u,preSelectedSalesItem:h,setShowCurrencyPrompt:m,setPromptedCurrencyRate:p,setPreSelectedSalesItem:y,proceedToHandleSalesItemSelect:o}){return e.jsx(g,{title:"Currency Mismatch",show:d,handleClose:()=>{m(!1),y(null),p(1)},size:"md",children:e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-danger",children:["The item you have selected is listed in"," ",h.currency_object.currency_code," but your ",t||"invoice"," is to be in ",c.currency_code,", please input below the rate to be used"]}),e.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[e.jsx("label",{className:"form-label text-nowrap px-3",children:`${h.unit_price_currency} to ${c.currency_code}`}),e.jsx("input",{type:"number",className:"form-control",value:u,onChange:x=>p(x.target.value)})]}),e.jsx("div",{className:"mt-3 text-end",children:e.jsx("button",{onClick:o,type:"button",className:"btn btn-info text-white",children:"Proceed"})})]})})}export{I};
