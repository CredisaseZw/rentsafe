import{u as O,j as e,a as w,r as i,b as N,_ as v,H as E}from"./main-8dd08346.js";import{P as Z}from"./PageHeader-f9b97394.js";import{S as H}from"./search-2f6d648d.js";import{u as U}from"./index-8a232b92.js";import{f as _}from"./formatting-fad57ba1.js";import{M as A}from"./Modal-57d82f64.js";import"./lodash-1dd2ee01.js";import"./removeClass-3a685ef7.js";import"./index-4b5126cc.js";function R(){const{subscriptions:s,activeSubscriptions:r}=O().props;return e.jsxs("div",{className:"card card-raised mb-5",children:[e.jsx("div",{className:"card-header px-4 bg-info",style:{height:"50px"},children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"",children:e.jsxs("h2",{className:"display-6 text-white",children:["Active Subscriptions ",r]})})})}),e.jsx("div",{className:"card-body p-4",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",fontSize:"12px"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Trans No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Subscriber Name"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Product"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Sub Class"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Sub Period"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"No. of Subs"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Start Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"End Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Months Remaining"}),e.jsx("th",{scope:"col",className:"tf-borderRight"})]})}),e.jsx("tbody",{children:s?.map(({id:c,subscriptionName:b,product:d,subClass:x,period:u,number_of_subscriptions:h,startDate:p,endDate:l,monthsRemains:j},n)=>e.jsxs("tr",{style:{fontSize:"12px"},children:[e.jsx("th",{scope:"row",children:c}),e.jsx("td",{children:b}),e.jsx("td",{children:d}),e.jsx("td",{children:x}),e.jsx("td",{children:u}),e.jsx("td",{children:h}),e.jsx("td",{children:p}),e.jsx("td",{children:l}),e.jsx("td",{children:j}),e.jsx("td",{className:"bg-success text-white text-center tfRow",onClick:()=>window.location.href=`view-subscriptions/${c}/`,children:"View"})]},n+c))})]})})})]})}function M(){const{data:s,setData:r,reset:c}=w({subscriberName:"",subscriberRegNo:"",product:"",subPeriod:"",numberOfSubs:"",startDate:"",currency:"USD",monthlyPrice:"",monthlyPriceZWL:"",subsAmount:"",paymentMethod:""}),[b,d]=i.useState(""),[x,u]=i.useState(),[h,p]=i.useState(),[l,j]=i.useState("individual"),[n,f]=i.useState(""),[P,o]=i.useState(""),[m,S]=i.useState(""),[g,y]=i.useState(!1);function D(){if(y(!0),s.subscriberName=String(l==="individual"?m:P),s.subscriberRegNo=String(m),s.monthlyPrice=s.currency==="USD"?s.monthlyPrice.toString():s.monthlyPriceZWL.toString(),s.subscriberName===""){v.error("Subscriber Name is required",{id:"create-sub"}),y(!1);return}console.log([s]),N.post(reverseUrl("active_subcription"),[s]).then(t=>{if(console.log(t),t.data.status===400){d(t.data.errors[0]),v.error(U(t),{id:"create-sub"}),y(!1);return}c(),v.success("Subscription created successfully",{id:"create-sub"}),y(!1)}).catch(t=>{console.log(t),v.error(U(t?.data?.errors||t),{id:"create-sub"}),d(t),y(!1)})}function T(t){r({...s,[t.target.id]:t.target.value})}i.useEffect(()=>{Promise.all([N.post(reverseUrl("get_services")),N.post(reverseUrl("get_sub_period")),N.post(reverseUrl("subs_monthly_pricing"))]).then(t=>{console.log(t[2].data),u(t[0].data.services),p(t[1].data.sub_periods);let a=t[2].data;r(C=>({...C,monthlyPrice:a?.individual_monthly_price||a?.company_monthly_price||C.monthlyPrice,monthlyPriceZWL:a?.individual_zwl_monthly_price||a?.company_zwl_monthly_price||C.monthlyPrice}))})},[]),i.useEffect(()=>{if(s.numberOfSubs&&s.subPeriod){const t=h.find(a=>a.id===Number(s.subPeriod)).period_length;r(a=>({...a,subsAmount:s.currency==="USD"?(Math.round(Number(s.numberOfSubs)*Number(t)*Number(s.monthlyPrice)*100)/100).toString():(Math.round(Number(s.numberOfSubs)*Number(t)*Number(s.monthlyPriceZWL)*100)/100).toString()}))}},[s.subPeriod,s.numberOfSubs,s.monthlyPrice,s.monthlyPriceZWL,s.currency]);const W=l==="company"?reverseUrl("get_searched_companies"):l==="individual"?reverseUrl("get_searched_individuals"):"";return g&&v.loading("Creating subscription ...",{id:"create-sub"}),{data:s,errors:b,services:x,isLoading:g,searchUrl:W,sub_periods:h,subscriberType:l,subscriberName:n,setClientId:o,setRegNumber:S,changeHandler:T,handleSubmit:D,setSubscriberType:j,setSubscriberName:f}}function I(){const{data:s,errors:r,services:c,isLoading:b,searchUrl:d,sub_periods:x,subscriberType:u,subscriberName:h,setClientId:p,handleSubmit:l,setRegNumber:j,changeHandler:n,setSubscriberName:f,setSubscriberType:P}=M();return e.jsxs("div",{children:[e.jsx("h5",{className:"p-2 m-0 bg-info text-white text-center",children:"Subscription Origination"}),e.jsxs("table",{className:"table table-responsive table-sm table-bordered bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Client Type"}),e.jsx("th",{children:"Subscriber Name"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Sub Period"}),e.jsx("th",{children:"No. of Subs"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{children:"Monthly Price"}),e.jsx("th",{children:"Subs Amount"}),e.jsx("th",{children:"Payment Method"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{onChange:o=>P(o.target.value),className:"form-select form-select-sm",name:"subscriberType",value:u,required:!0,children:[e.jsx("option",{value:"individual",children:"I"}),e.jsx("option",{value:"company",children:"C"})]})}),e.jsxs("td",{className:"position-relative",children:[e.jsx(H,{value:h,setValue:f,url:d,placeholder:"Start typing",delay:300,type:u,setClientId:p,setRegNumber:j}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.subscriberName})]}),e.jsxs("td",{children:[e.jsxs("select",{onChange:n,required:!0,className:"form-select form-select-sm",name:"product",id:"product",value:s.product,children:[e.jsx("option",{disabled:!0,value:"",children:"Select"}),c?.map(({id:o,service_name:m},S)=>e.jsx("option",{value:o,children:m},S))]}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.product})]}),e.jsxs("td",{children:[e.jsxs("select",{onChange:n,className:"form-select form-select-sm",required:!0,name:"subPeriod",id:"subPeriod",value:s.subPeriod,children:[e.jsx("option",{disabled:!0,value:"",children:"Select"}),x?.map(({id:o,name:m,code:S},g)=>e.jsxs("option",{value:o,children:[m,"(",S,")"]},g))]}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.subPeriod})]}),e.jsxs("td",{children:[e.jsx("input",{value:s.numberOfSubs,required:!0,onChange:n,type:"number",name:"numberOfSubs",id:"numberOfSubs",className:"form-control form-control-sm"}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.numberOfSubs})]}),e.jsxs("td",{children:[e.jsx("input",{value:s.startDate,onChange:n,required:!0,type:"date",name:"startDate",id:"startDate",className:"form-control form-control-sm"}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.startDate})]}),e.jsxs("td",{children:[e.jsxs("select",{onChange:n,className:"form-select form-select-sm",name:"currency",required:!0,id:"currency",value:s.currency,children:[e.jsx("option",{disabled:!0,value:"",children:"Select"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"ZWG",children:"ZWG"})]}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.currency})]}),e.jsxs("td",{children:[s.currency==="USD"?_(s.monthlyPrice):_(s.monthlyPriceZWL),r&&e.jsx("div",{className:"text-danger mt-1",children:r.monthlyPrice})]}),e.jsxs("td",{children:[_(s.subsAmount),r&&e.jsx("div",{className:"text-danger mt-1",children:r.subsAmount})]}),e.jsxs("td",{children:[e.jsxs("select",{onChange:n,className:"form-select form-select-sm",required:!0,name:"paymentMethod",id:"paymentMethod",value:s.paymentMethod,children:[e.jsx("option",{disabled:!0,value:"",children:"Select"}),e.jsx("option",{value:"CASH USD",children:"CASH USD"}),e.jsx("option",{value:"SWIPE USD",children:"SWIPE USD"}),e.jsx("option",{value:"SWIPE ZWG",children:"SWIPE ZWG"}),e.jsx("option",{value:"BANK TRF USD",children:"BANK TRF USD"}),e.jsx("option",{value:"BANK TRF ZWG",children:"BANK TRF ZWG"}),e.jsx("option",{value:"ECOCASH USD",children:"ECOCASH USD"}),e.jsx("option",{value:"ECOCASH ZWG",children:"ECOCASH ZWG"})]}),r&&e.jsx("div",{className:"text-danger mt-1",children:r.paymentMethod})]})]})})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:l,children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"processing.."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Submit"]})})})]})}function $(){const[s,r]=i.useState(!1);return e.jsxs("main",{children:[e.jsx(E,{title:"Active Subscriptions"}),e.jsx(Z,{title:"Active Subscriptions"}),s&&e.jsxs(A,{show:s,onHide:()=>r(!1),size:"xl",backdrop:"static",centered:!0,children:[e.jsx(A.Header,{className:"p-0",children:e.jsx("div",{className:"w-100 p-3 text-end",children:e.jsx("button",{type:"button",onClick:()=>r(!1),className:"btn btn-danger btn-sm",children:e.jsx("i",{className:"material-icons fs-3",children:"close"})})})}),e.jsx(A.Body,{children:e.jsx("div",{className:"py-5",children:e.jsx(I,{})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-end",children:e.jsxs("button",{className:"btn btn-primary",onClick:()=>r(c=>!c),children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Subscription"]})}),e.jsx(R,{})]})]})}export{$ as default};
