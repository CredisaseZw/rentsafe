import{r as y,b as j,d as o,_,j as n}from"./main-5c244715.js";import{L as k}from"./Layout-b60b0d01.js";import{l as w}from"./lodash-8a516636.js";import{u as g,f as v}from"./index-f1738c83.js";import{W as D}from"./WorksAndMaintenance-53383cc5.js";import{f as N}from"./formatting-fad57ba1.js";import{N as O}from"./NewPageHeader-db234e2e.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-e1b110fd.js";import"./Modal-bb9e7ea7.js";import"./index-36250c36.js";import"./MultipleUpload-d000b528.js";import"./search-5302eb36.js";function C(r,d,u,a){const[m,l]=y.useState(void 0),c=`${a.user_profile.first_name} ${a.user_profile.last_name} - ${a.user_profile.individual_id}`,h=[...[...r||[],...u||[]].map(e=>{let t=`${e?.title?.toUpperCase()}: ${e.details}`;return{lease:{},date:e.scheduled_date,details:t,function:w.capitalize(e.function),balance_owing:e.current_balance,color:e.color,...e}}),...d?.map(e=>({lease:{},date:e.created_at,details:e.details,function:w.capitalize(e.function),balance_owing:e.current_balance,color:e.color,...e}))];function i(e){const t={tenant_landlord:e.tenant_landlord,property:e.property,title:e.title,details:e.details,tradesman:e.tradesman,contractor_name:e.contractor,required:e.required_materials,budget:e.budget,reason:e.reason,whose_account:e.responsible_person,date_schedule:e.scheduled_date||e.date,isWorks:!0,frequency:void 0,month_frequency:void 0,day_date:void 0};l(t)}function p(e){j.post(reverseUrl("resolve_task",e.id),{type:e.frequency?"maintenance":e.function==="works"?"works":"reminder"}).then(()=>{o.Inertia.reload({only:["works","reminders","maintenance"]})}).catch(t=>{_.error(g(t)),console.log(t)})}function f(e){j.post(reverseUrl("delete_work_schedule",e.id),{type:e.scheduled_day?"maintenance":e.function==="works"?"works":"reminder"}).then(()=>{o.Inertia.reload({only:["works","reminders","maintenance"]})}).catch(t=>{_.error(g(t)),console.log(t)})}function x(e){e.is_creditor?o.Inertia.visit(reverseUrl("creditor_statements"),{data:{open_view_for:e.lease_id}}):o.Inertia.visit(reverseUrl("client-leases"),{data:{open_view_for:e.lease_id}})}return{todos:h,username:c,viewDefaults:m,done:p,dismiss:f,goToOrigin:x,openScheduledWorks:i,closeWorks:()=>l(void 0)}}function E({status:r,message:d,works:u,reminders:a,maintenance:m,Auth:l}){const{todos:c,username:h,viewDefaults:i,done:p,dismiss:f,closeWorks:x,goToOrigin:e,openScheduledWorks:t}=C(u,a,m,l);return r==="error"?n.jsx("div",{className:"alert alert-danger d-flex gap-2 align-items-center",role:"alert",children:w.truncate(d,{length:200})}):n.jsxs(n.Fragment,{children:[!!i&&n.jsx(D,{isOpen:!!i,close:x,lease:{},viewDefaults:i}),n.jsx(O,{title:"To Do List",color:"danger"}),n.jsxs("div",{className:"p-2 fw-bold d-flex justify-content-between align-items-center",children:[n.jsx("div",{children:v(new Date)}),n.jsx("div",{children:h})]}),n.jsxs("table",{className:"table table-responsive table-bordered table-sm bg-white",children:[n.jsx("thead",{className:"position-sticky bg-white shadow-sm c-table-top text-nowrap",children:n.jsxs("tr",{children:[n.jsx("th",{children:"#"}),n.jsx("th",{children:"Date"}),n.jsx("th",{children:"Function"}),n.jsx("th",{className:"custom-mn-w-5",children:"Details"}),n.jsx("th",{children:"Balance Owing"}),n.jsx("th",{className:"custom-mn-w-06"})]})}),n.jsxs("tbody",{children:[c.map((s,b)=>n.jsxs("tr",{className:s.status==="DONE"?"c-done-block":"",children:[n.jsx("th",{className:"text-nowrap ps-3",children:b+1}),n.jsx("td",{className:"ps-3 text-nowrap",children:s.date?new Date(s.date).toISOString().split("T")[0]:"N/A"}),s.function.toLowerCase()==="works"?n.jsx("td",{onClick:()=>t(s),className:`text-white bg-primary text-center ${s.function==="works"?"c-pointer":""}`,children:s.function}):n.jsx("th",{className:"text-nowrap text-center bg-light",children:s.function}),n.jsx("th",{className:"custom-mn-w-4  px-2",children:n.jsxs("p",{className:"m-0 c-line-clamp-1"+(s.status==="DONE"?"c-done":""),children:[n.jsx("span",{className:"text-capitalize",children:s?.title}),s?.title&&s?.details?" - ":"",n.jsxs("span",{className:"text-capitalize",children:[" ",s?.details]})]})}),n.jsx("td",{children:n.jsx("div",{className:"text-center btn btn-sm w-100 d-block",style:{cursor:"default",backgroundColor:s.color?s.color:"inherit",color:s.color?"white":"inherit"},children:s.balance_owing?s.balance_owing<0?`(${N(s.balance_owing*-1)})`:N(s.balance_owing):"_"})}),n.jsx("td",{children:n.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-2",children:[n.jsx("button",{onClick:()=>e(s),className:"btn btn-sm flex-fill justify-content-center btn-info text-white",children:"View"}),n.jsx("button",{disabled:s.status==="DONE",className:"btn btn-sm btn-success flex-fill justify-content-center ",onClick:()=>p(s),children:"Done"}),n.jsx("button",{className:"btn btn-sm btn-danger flex-fill justify-content-center",onClick:()=>f(s),children:"Dismiss"})]})})]},b)),!c.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"p-5 text-center",children:"Nothing to show"})})]})]})]})}E.layout=r=>n.jsx(k,{children:r,title:"Todo List"});export{E as default};
