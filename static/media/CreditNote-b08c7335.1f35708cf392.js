import{r,u as R,d as U,b as q,_ as O,j as e}from"./main-5c37eb2a.js";import{f as k}from"./index-acacf113.js";import{S as Y}from"./SearchBar-e66e6ff5.js";import{L as M}from"./Layout-779839f2.js";import{C as J}from"./ContentModal-bd5c0b74.js";import{U as z}from"./UserSelector-bb62bd40.js";import{I as H}from"./InvoiceFormRow-3097044d.js";import{N as K}from"./NewPageHeader-c0cd0023.js";import"./formatting-fad57ba1.js";import"./lodash-9dd08774.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-bd16bbcb.js";import"./Modal-34f4a559.js";import"./index-5a5385bf.js";import"./MultipleUpload-041fb25a.js";import"./search-513e0541.js";function Q(){const[n,x]=r.useState([]),[m,l]=r.useState(!1),{url:o}=R();r.useEffect(()=>{},[o]);function p(i){i.preventDefault();const f=i.target.year.value,d=i.target.month.value,j=new URL(o);j.searchParams.set("year",f),j.searchParams.set("month",d),U.Inertia.replace(j.href,{preserveState:!0})}return{loading:m,creditNotes:n,handleFilters:p}}function G(n){const[x,m]=r.useState(null),[l,o]=r.useState(!1),[p,i]=r.useState(!1),[f,d]=r.useState("USD"),[j,w]=r.useState([]),[s,g]=r.useState([]),[S,_]=r.useState(0),[N,v]=r.useState(0),[u,b]=r.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);r.useEffect(()=>{if(n){const t={document_number:n.document_number,credit_to:n.bill_to,address:n.address,phone:n.phone,email:n.email,vat_no:n.vat_no,tin:n.tin,currency:n.currency,monthly_rental:n.monthly_rental};m(t),d(t.currency),b([t.monthly_rental])}},[n]),r.useEffect(()=>{C(),F()},[]);function C(){q.get("/accounting/items/").then(t=>{w(t.data)}).catch(t=>{console.log(t)})}function F(){q.get("/accounting/vat-settings/").then(t=>{g(t.data)}).catch(t=>{console.error(t)})}function D(){b([...u,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function T(t){const a=u.filter((h,c)=>c!==t);b(a)}function y(){i(!0)}function A(){i(!1)}function E(t){if(t.preventDefault(),!u.length){O.error("Please add at least one item");return}const a=Object.fromEntries(new FormData(t.target).entries());a.items=u.map(h=>{const c={...h};return c.vat=(parseFloat(c.vat)||0)/100*(parseFloat(c.price)||0)*(parseFloat(c.qty)||0),delete c.static,c}),Object.keys(V).forEach(h=>a[h]=V[h]),a.invoiceTotal+=Number(N),a.discount=Number(N),console.log(a)}function B(t){b([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),d(t.target.value),_(a=>a+1)}const V=u?.reduce((t,a)=>{if(!a)return t;const h=parseFloat(a.qty)||0,c=(parseFloat(a.vat)||0)/100,I=parseFloat(a.price)||0;return t.totalExcludingVat+=I*h,t.vatTotal+=I*c*h,t.creditNoteTotal+=parseFloat(a.total)||0,t},{totalExcludingVat:0,vatTotal:0,creditNoteTotal:0});function L(t){let a=parseFloat(t.target.value)||0;a>0?O.error("Discount should be input as a negative value"):v(a)}function P(t){const a={address:t.address,phone:t.mobile,email:t.email,vat_no:t.VAT_number,tin:t.tin_number};m(a)}return{key:S,show:p,items:u,totals:V,discount:N,currency:f,isLoading:l,salesItems:j,taxConfigs:s,creditNoteData:x,selectedCurrency:null,addRow:D,setItems:b,onSubmit:E,removeRow:T,handleShow:y,handleClose:A,setDiscount:v,changeCurrency:B,handleDiscount:L,handleUserSelected:P}}function W({creditNote:n,triggerClassname:x,triggerChildren:m}){const{key:l,show:o,items:p,totals:i,discount:f,isLoading:d,salesItems:j,taxConfigs:w,creditNoteData:s,selectedCurrency:g,addRow:S,setItems:_,onSubmit:N,removeRow:v,handleShow:u,handleClose:b,changeCurrency:C,handleDiscount:F,handleUserSelected:D}=G(n);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:x||"btn btn-info text-white",onClick:u,children:m||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(J,{size:"xl",show:o,handleClose:b,title:"Credit Note",children:e.jsxs("form",{className:"py-3",onSubmit:N,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!s?.document_number,defaultValue:s?.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center justify-content-between",children:[e.jsx("label",{htmlFor:"credit_to",className:"form-label",children:"Credit To:"}),s?.credit_to?e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"customer_id",id:"customer_id",readOnly:!0,value:s?.credit_to}):e.jsx(z,{onChange:D})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:s?.address,readOnly:!!s?.address})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:s?.phone,readOnly:!!s?.phone})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:s?.email,readOnly:!!s?.email})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:s?.vat_no,readOnly:!!s?.vat_no})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:s?.tin,readOnly:!!s?.tin})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().getFullYear(),new Date().getMonth()-1,new Date().getDate()>27?27:new Date().getDate()).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!s})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:g?.id||"",name:"invoice_currency",id:"invoice_currency",onChange:C,children:s?.currency?e.jsx("option",{value:s.currency,children:s.currency}):e.jsx(e.Fragment,{children:e.jsx("option",{disabled:!0,value:"",children:"Select Currency"})})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Price (Vat Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Vat Inc)"})]})]}),e.jsx("tbody",{children:p.map((T,y)=>e.jsx(H,{item:T,index:y,setItems:_,removeRow:v,salesItems:j,taxConfigs:w,selectedCurrency:g,itemName:"credit note",itemsLength:p.length},y+"-"+l))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:d,type:"button",className:"btn btn-sm btn-outline-info",onClick:S,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:i.totalExcludingVat.toFixed(2)})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:f,max:0,step:.001,onChange:F,readOnly:d})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:i.vatTotal.toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Credit Note Total ",g?.currency_code||""]}),e.jsx("td",{children:(i.creditNoteTotal+f).toFixed(2)})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:d,className:"btn btn-info text-white",children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function X(){const{loading:n,creditNotes:x,handleFilters:m}=Q();return e.jsxs("div",{children:[e.jsx(K,{title:"Credit Note",color:"danger"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:m,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((l,o)=>e.jsx("option",{value:new Date().getFullYear()-o,children:new Date().getFullYear()-o},o))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(Y,{placeholder:"Search...",searchBy:"q"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Credit Note List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(W,{triggerClassname:"btn btn-danger"})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-danger shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Cr Note. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Amount"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):x?.length?x?.map((l,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:l.id}),e.jsx("td",{className:"ps-3",children:l.date_created&&k(l.date_created)}),e.jsx("td",{className:"ps-3",children:l.customer}),e.jsx("td",{className:"ps-3",children:l.currency}),e.jsx("td",{className:"ps-3 text-end",children:l.amount.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-danger",children:"View"})})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}X.layout=n=>e.jsx(M,{children:n,title:"Credit Note"});export{X as default};
