var C=(g,y,m)=>new Promise((R,i)=>{var f=l=>{try{u(m.next(l))}catch(p){i(p)}},N=l=>{try{u(m.throw(l))}catch(p){i(p)}},u=l=>l.done?R(l.value):Promise.resolve(l.value).then(f,N);u((m=m.apply(g,y)).next())});import{r as x,j as e,b as I}from"./main-773842c3.js";import{L as _}from"./Layout-7e87a7d6.js";import L from"./SearchCustomer-7bc5a3f2.js";import{f as w}from"./formatting-345d2430.js";import{I as E,_ as b}from"./index-dffc6c30.js";import"./lodash-52129a8b.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-3d960475.js";import"./Modal-fc586ea6.js";import"./index-8bd7aac5.js";function O(){const[g,y]=x.useState(""),[m,R]=x.useState(""),[i,f]=x.useState([]),N=()=>{const t=new Date().toISOString().split("T")[0],s=c.map(a=>{const n={};return a.date>t&&(n.date=`Row ${a.id}: Date must be earlier than today.`),a.date<new Date(a.endDate).toISOString().split("T")[0]&&(n.date=`Row ${a.id}: Date must be later than opening balance date.`),a.customerType||(n.customerType="Customer Type is required."),a.customerName||(n.customerName="Customer Name is required."),a.accountBalance||(n.accountBalance="Account Balance is required."),a.creditAmount||(n.creditAmount="Credit Amount is required."),n});return f(s),s.every(a=>Object.keys(a).length===0)},[u,l]=x.useState(!1),p=m?new Date(m).toISOString().split("T")[0]:"";console.log("endDate",p),console.log("currentDate",new Date().toISOString().split("T")[0]);const v=[{id:1,date:new Date().toISOString().split("T")[0],customerType:"",customerName:"",details:"",accountBalance:"",creditAmount:"",endBalance:"",leaseId:"",accountBalance:"",endDate:""}],[c,d]=x.useState(v),S=()=>{const t={id:c.length+1,date:new Date().toISOString().split("T")[0],customerType:"",customerName:"",details:"",accountBalance:"",endBalance:""};d([...c,t])},j=(t,s)=>{const{name:a,value:n}=t.target,h=[...c];h[s][a]=n,d(h)},D=t=>t==="individual"?reverseUrl("get_client_individual_journals"):t==="company"?reverseUrl("get_client_company_journals"):reverseUrl("get_client_individual_journals"),A=()=>C(this,null,function*(){if(!N()){b.error("Please fix the errors before submitting.");return}try{const t=yield I.post(reverseUrl("credit_journal"),{rows:c});if(t.data.status==="failed"){y([t.data.error]),b.error(t.data.error),l(!1);return}d(v),f([]),b.success("Journal entry(s) created successfully")}catch(t){console.error("Error submitting data:",t),b.error("Failed to submit data")}}),B=t=>{const s=c.filter((a,n)=>n!==t);d(s)};return e.jsxs("div",{className:"card card-raised",style:{height:"60vh",width:"100%"},children:[e.jsx(E,{}),e.jsx("div",{className:"p-1 bg-danger",children:e.jsx("h5",{className:"text-white text-center",children:"Credit Journal"})}),e.jsx("div",{className:"card-body p-4 ",style:{height:"60vh"},children:e.jsxs("div",{className:"table-responsive",style:{overflowY:"visible",height:"100%"},children:[e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",fontSize:"12px"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Customer Type"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Customer"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Details"}),e.jsx("th",{scope:"col",className:"text-end",style:{borderTop:"1px solid #e0e0e0"},children:"Account Balance"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Credit Amount"}),e.jsx("th",{scope:"col",className:"text-end",style:{borderTop:"1px solid #e0e0e0"},children:"End Balance"}),e.jsx("th",{scope:"col",className:"text-end",style:{borderTop:"1px solid #e0e0e0"},children:"Action"})]})}),e.jsx("tbody",{children:c.map((t,s)=>{var a,n,h,T;return e.jsxs("tr",{children:[e.jsxs("td",{className:"tf-borderRight tf-borderLeft",children:[e.jsx("input",{className:"form-control form-control-sm tf-borderRight tf-input",type:"date",name:"date",value:t.date,onChange:r=>j(r,s)}),((a=i[s])==null?void 0:a.date)&&e.jsx("div",{className:"text-danger mt-1",children:i[s].date})]}),e.jsxs("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:[e.jsxs("select",{className:"form-select form-select-sm tf-borderRight tf-input",name:"customerType",value:t.customerType,onChange:r=>j(r,s),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"individual",children:"I"}),e.jsx("option",{value:"company",children:"C"})]}),((n=i[s])==null?void 0:n.customerType)&&e.jsx("div",{className:"text-danger mt-1",children:i[s].customerType})]}),e.jsxs("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px",position:"relative",maxWidth:"100px"},children:[e.jsx(L,{value:t.customerName,setValue:r=>{const o=[...c];o[s].customerName=r,d(o)},url:D(t.customerType),placeholder:"Start typing",delay:500,type:t.customerType,setCustomerName:r=>{const o=[...c];o[s].customerName=r,d(o)},setLeaseId:r=>{const o=[...c];o[s].leaseId=r,d(o)},setOpeningBalance:r=>{const o=[...c];o[s].accountBalance=r,d(o)},setEndDate:r=>{const o=[...c];o[s].endDate=r,d(o)}}),((h=i[s])==null?void 0:h.customerName)&&e.jsx("div",{className:"text-danger mt-1",children:i[s].customerName})]}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px",minWidth:"200px"},children:e.jsx("textarea",{name:"details",className:"form-control form-control-sm tf-input",rows:2,id:"details",value:t.details,onChange:r=>j(r,s)})}),e.jsx("td",{className:"tf-borderRight text-end",style:{paddingRight:"1px",paddingLeft:"1px"},children:t.accountBalance?w(t.accountBalance):""}),e.jsxs("td",{className:"tf-borderRight",style:{maxWidth:"40px",paddingRight:"1px",paddingLeft:"1px"},children:[e.jsx("input",{onChange:r=>j(r,s),className:"form-control form-control-sm tf-borderRight tf-input",type:"text",id:"creditAmount",name:"creditAmount",value:t.creditAmount}),((T=i[s])==null?void 0:T.creditAmount)&&e.jsx("div",{className:"text-danger mt-1",children:i[s].creditAmount})]}),e.jsx("td",{className:"tf-borderRight text-end",style:{paddingRight:"1px",paddingLeft:"1px"},children:t.creditAmount?w(Number(t.accountBalance)-Number(t.creditAmount)):""}),e.jsx("td",{className:"tf-borderRight text-end",children:e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:()=>B(s),disabled:c.length===1,children:"Remove"})})]},t.id)})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsxs("button",{className:"btn btn-success btn-raised text-white",onClick:S,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("button",{className:"btn btn-info btn-raised text-white",onClick:A,children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"processing.."})]}):e.jsx(e.Fragment,{children:"Submit"})})})]})})]})}O.layout=g=>e.jsx(_,{children:g,title:"Customer Credit Adjustment - Credit Journal"});export{O as default};
