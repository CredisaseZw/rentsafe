var $=Object.defineProperty,O=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var L=(s,a,l)=>a in s?$(s,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[a]=l,D=(s,a)=>{for(var l in a||(a={}))Y.call(a,l)&&L(s,l,a[l]);if(P)for(var l of P(a))z.call(a,l)&&L(s,l,a[l]);return s},V=(s,a)=>O(s,M(a));import{j as e,r as o,u as B,d as J,b as k}from"./main-92093c4c.js";import"./lodash-a15548bd.js";import{f as Z}from"./index-ea250f19.js";import{S as G}from"./SearchBar-fd5a454d.js";import{C as R}from"./ContentModal-53fee559.js";import{a as H,L as K}from"./Layout-767d347c.js";import"./formatting-9de8c923.js";import"./Modal-9de466f6.js";import"./removeClass-dd64b22a.js";import"./index-0c7d6a02.js";import"./assertThisInitialized-3be3daa4.js";import"./MultipleUpload-09b1dc47.js";import"./search-691d1d66.js";function Q(){return e.jsx("div",{children:e.jsx("p",{className:"text-center",children:"In development"})})}function X(){return e.jsx("div",{children:e.jsx("p",{className:"text-center",children:"In development"})})}function W(){const[s,a]=o.useState([]),[l,r]=o.useState(!1),{url:i}=B();function m(){r(!0),a([]),r(!1)}o.useEffect(()=>{m()},[i]);function v(x){x.preventDefault();const N=x.target.year.value,j=x.target.month.value,p=new URL(i);p.searchParams.set("year",N),p.searchParams.set("month",j),J.Inertia.replace(p.href,{preserveState:!0})}return{loading:l,invoiceList:s,handleFilters:v}}function ee(){const[s,a]=o.useState(!1),[l,r]=o.useState(!0),[i,m]=o.useState("USD"),[v,x]=o.useState([]),[N,j]=o.useState([]),[p,y]=o.useState(0),[u,d]=o.useState([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);function I(){k.get("/accounting/items/").then(t=>{x(t.data)}).catch(t=>{console.log(t)})}function _(){k.get("/accounting/vat-settings/").then(t=>{j(t.data)}).catch(t=>{console.error(t)})}o.useEffect(()=>{I(),_()},[]);function S(){d([...u,{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function w(t){const c=u.filter((g,b)=>b!==t);d(c)}function F(){r(!0)}function q(){r(!1)}function C(t){t.preventDefault();const c=Object.fromEntries(new FormData(t.target).entries());c.items=u,console.log(c)}const A=u.reduce((t,c)=>{const g=parseFloat(c.qty)||0,b=(parseFloat(c.vat)||0)/100,f=parseFloat(c.price)||0;return t.totalExcludingVat+=f*g,t.discount+=0,t.vatTotal+=f*b*g,t.invoiceTotal+=parseFloat(c.total)||0,t},{totalExcludingVat:0,discount:0,vatTotal:0,invoiceTotal:0});function n(t){d([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),m(t.target.value),y(c=>c+1)}return{key:p,show:l,items:u,totals:A,currency:i,isLoading:s,salesCodes:v,taxConfigs:N,addRow:S,setItems:d,onSubmit:C,removeRow:w,handleShow:F,setCurrency:m,handleClose:q,changeCurrency:n}}function te(){const[s,a]=o.useState("INDIVIDUAL");return e.jsxs("div",{className:"d-flex",children:[e.jsxs("select",{className:"me-1 px-1 border fw-light rounded-2",value:s,name:"customer_type",id:"customer_type",onChange:l=>a(l.target.value),children:[e.jsx("option",{value:"INDIVIDUAL",children:"Individual"}),e.jsx("option",{value:"COMPANY",children:"Company"})]}),e.jsx("div",{className:"custom-w-3",children:e.jsx(H,{extraProps:{placeholder:"Customer Name...",required:!0,id:"bill_to",name:"bill_to",className:"w-100"},defaultValue:null,isDisabled:s==="",useAlternateFetchOptions:{type:s.toLowerCase()}},s)})]})}function se({item:s,index:a,setItems:l,currency:r,isLoading:i,removeRow:m,salesCodes:v,itemsLength:x,taxConfigs:N}){const[j,p]=o.useState(null),[y,u]=o.useState(null),[d,I]=o.useState(null),[_,S]=o.useState(!1),[w,F]=o.useState(1);function q(n){const t=v.find(h=>h.item_id===n.target.value);if(t.unit_price_currency!==r){S(!0),u(t);return}const c=N.find(h=>h.id===t.tax_configuration),b=((c==null?void 0:c.rate)||0)/100*((t==null?void 0:t.price)||0)*(s.qty||0),f=((t==null?void 0:t.price)||0)*(s.qty||0)+b;l(h=>h.map((T,U)=>U===a?V(D({},T),{sales_code:(t==null?void 0:t.item_id)||"",sales_item:(t==null?void 0:t.name)||"",price:(t==null?void 0:t.price)||"",vat:(c==null?void 0:c.rate)||0,total:f}):T)),p(t),I(c)}function C(){const n=D({},y);n.price=parseFloat(w)*(parseFloat(n.price)||0),n.unit_price_currency=r;const t=N.find(f=>f.id===n.tax_configuration),g=((t==null?void 0:t.rate)||0)/100*((n==null?void 0:n.price)||0)*(s.qty||0),b=((n==null?void 0:n.price)||0)*(s.qty||0)+g;l(f=>f.map((h,T)=>T===a?V(D({},h),{sales_code:(n==null?void 0:n.item_id)||"",sales_item:(n==null?void 0:n.name)||"",price:(n==null?void 0:n.price)||"",vat:(t==null?void 0:t.rate)||0,total:b}):h)),p(n),I(t),u(null),S(!1),F(1)}const A=d!=null&&d.rate?`${((d==null?void 0:d.rate)||0)/100*((j==null?void 0:j.price)||0)*parseFloat(s.qty||0)} (${d.rate}%)`:"";return e.jsxs(e.Fragment,{children:[_&&e.jsx(R,{title:"Currency Mismatch",show:_,handleClose:()=>{S(!1),u(null),F(1)},size:"md",children:e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-danger",children:["The item you have selected is listed in ",y.unit_price_currency," but your invoice is to be in ",r,", please input below the rate to be used"]}),e.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[e.jsx("label",{className:"form-label text-nowrap px-3",children:`${y.unit_price_currency} to ${r}`}),e.jsx("input",{type:"number",className:"form-control",value:w,onChange:n=>F(n.target.value)})]}),e.jsx("div",{className:"mt-3 text-end",children:e.jsx("button",{onClick:C,type:"button",className:"btn btn-info text-white",children:"Proceed"})})]})}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{disabled:i||x===1,type:"button",onClick:()=>m(a),className:"btn btn-danger btn-sm p-1",children:e.jsx("i",{className:"material-icons",children:"close"})})}),e.jsx("td",{children:e.jsxs("select",{disabled:i,value:s.sales_code,onChange:q,className:"form-select custom-w-2",children:[e.jsx("option",{value:"",children:"Select code.."}),v.map(n=>e.jsx("option",{value:n.item_id,children:`${n.item_id} - ${n.name}`},n.id))]})}),e.jsx("td",{children:e.jsx("div",{className:"text-center custom-mn-w-1 custom-mx-w-2",children:s.sales_item})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:` ${s.price||""}`})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control custom-w-1",disabled:i,value:s.qty,onChange:n=>l(t=>t.map((c,g)=>{if(g===a){const b=parseFloat(n.target.value)||0,h=(parseFloat(s.price)||0)*b,T=h*s.vat/100;return V(D({},c),{qty:n.target.value,total:h+T})}else return c}))})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:A})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:s.total})})]})]})}function ne(){const{key:s,show:a,items:l,totals:r,currency:i,isLoading:m,salesCodes:v,taxConfigs:x,addRow:N,setItems:j,onSubmit:p,removeRow:y,handleShow:u,setCurrency:d,handleClose:I,changeCurrency:_}=ee();return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-info text-white",onClick:u,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]}),e.jsx(R,{size:"xl",show:a,handleClose:I,title:"FISCAL TAX INVOICE",children:e.jsxs("form",{className:"p-3",onSubmit:p,children:[e.jsxs("div",{className:"p-4 mb-4",children:[e.jsxs("div",{className:"pb-5",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108"})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),e.jsx(te,{})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"address",id:"address",placeholder:"Address..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"phone",id:"phone",placeholder:"Phone..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"email",id:"email",placeholder:"Email..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No...."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"tin",id:"tin",placeholder:"TIN..."})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().setDate(1)).toISOString().split("T")[0],id:"date",type:"date"})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsxs("select",{value:i,name:"currency",id:"currency",onChange:_,children:[e.jsx("option",{value:"USD",children:"United States Dollar (USD)"}),e.jsx("option",{value:"ZIG",children:"Zimbabwean Dollar (ZIG)"})]})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Price(Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Inc)"})]})]}),e.jsx("tbody",{children:l.map((S,w)=>e.jsx(se,{item:S,index:w,currency:i,setItems:j,removeRow:y,isLoading:m,salesCodes:v,taxConfigs:x,itemsLength:l.length},w+"-"+s))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:m,type:"button",className:"btn btn-outline-info",onClick:N,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:r.totalExcludingVat})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:r.discount})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:r.vatTotal})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Invoice Total ",i]}),e.jsx("td",{children:r.invoiceTotal})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:m,className:"btn btn-info text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function ae(){const{loading:s,invoiceList:a,handleFilters:l}=W();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:l,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((r,i)=>e.jsx("option",{value:new Date().getFullYear()-i,children:new Date().getFullYear()-i},i))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(G,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(ne,{})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):a==null?void 0:a.map((r,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:r.id}),e.jsx("td",{className:"ps-3",children:r.date_created&&Z(r.date_created)}),e.jsx("td",{className:"ps-3",children:r.customer}),e.jsx("td",{className:"ps-3",children:r.currency}),e.jsx("td",{className:"ps-3 text-end",children:r.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},i))})]})]})]})}const E=[{key:"Invoice",content:e.jsx(ae,{})},{key:"Recurring",content:e.jsx(X,{})},{key:"Proforma",content:e.jsx(Q,{})}];function le(){const[s,a]=o.useState(E[0]);return e.jsxs("div",{children:[e.jsx("div",{className:"d-flex gap-2 mb-3",children:E.map(l=>e.jsx("button",{onClick:()=>a(l),className:`btn ${s===l?"btn-info text-white":"border border-2"}`,children:l.key},l.key))}),e.jsx("div",{className:"p-3",children:s.content})]})}le.layout=s=>e.jsx(K,{children:s,title:"Sales Categories"});export{le as default};
