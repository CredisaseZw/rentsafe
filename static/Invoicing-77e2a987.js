var E=Object.defineProperty,U=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var Y=(a,l,o)=>l in a?E(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,c=(a,l)=>{for(var o in l||(l={}))O.call(l,o)&&Y(a,o,l[o]);if(T)for(var o of T(l))Z.call(l,o)&&Y(a,o,l[o]);return a},x=(a,l)=>U(a,L(l));var R=(a,l,o)=>new Promise((d,f)=>{var b=n=>{try{h(o.next(n))}catch(m){f(m)}},w=n=>{try{h(o.throw(n))}catch(m){f(m)}},h=n=>n.done?d(n.value):Promise.resolve(n.value).then(b,w);h((o=o.apply(a,l)).next())});import{u as M,r as i,j as e,b as k}from"./main-5ef5aaa0.js";import{h as y}from"./moment-686b5dfa.js";import{f as N}from"./formatting-345d2430.js";import{L as F}from"./Layout-be807b80.js";import{I as G,_ as B}from"./index-5741d9bf.js";const P=()=>{const{tenant_list:a}=M().props,{errors:l}=M().props,o=a!=null&&a.length?a.filter(t=>t.lease_currency_type.toUpperCase()==="USD"):[],d=a!=null&&a.length?a.filter(t=>t.lease_currency_type.toUpperCase()==="ZWG"):[],[f,b]=i.useState(o!=null&&o.length?o.reduce((t,s)=>t+Number(s.owing_amount),0):0),[w,h]=i.useState(d!=null&&d.length?d.reduce((t,s)=>t+Number(s.owing_amount),0):0),[n,m]=i.useReducer(z,o.map(t=>x(c({},t),{total:(t==null?void 0:t.owing_amount)||"",operationalCosts:""}))),[u,_]=i.useReducer(D,d.map(t=>x(c({},t),{total:(t==null?void 0:t.owing_amount)||"",operationalCosts:""}))),[W,C]=i.useState(l),[I,S]=i.useState(!1);function z(t,s){switch(s.type){case"updateBaseRental":let j=t.map(r=>r.id===s.id?x(c({},r),{owing_amount:s.owing_amount,total:Number(r.operationalCosts)+Number(s.owing_amount)}):r);return b(j.reduce((r,p)=>r+Number(p.total),0)),j;case"updateOperatingCosts":let g=t.map(r=>r.id===s.id?x(c({},r),{operationalCosts:s.operationalCosts,total:Number(r.owing_amount)+Number(s.operationalCosts)}):r);return b(g.reduce((r,p)=>r+Number(p.total),0)),g;default:return t}}function D(t,s){switch(s.type){case"updateBaseRental":let j=t.map(r=>r.id===s.id?x(c({},r),{owing_amount:s.owing_amount,total:Number(r.operationalCosts)+Number(s.owing_amount)}):r);return h(j.reduce((r,p)=>r+Number(p.total),0)),j;case"updateOperatingCosts":let g=t.map(r=>r.id===s.id?x(c({},r),{operationalCosts:s.operationalCosts,total:Number(r.owing_amount)+Number(s.operationalCosts)}):r);return h(g.reduce((r,p)=>r+Number(p.total),0)),g;default:return t}}const H=()=>R(void 0,null,function*(){C({});const t=[];S(!0),n.forEach(s=>{t.push({leaseId:s.id,baseRental:s.owing_amount,operationCosts:s.operationalCosts})}),u.forEach(s=>{t.push({leaseId:s.id,baseRental:s.owing_amount,operationCosts:s.operationalCosts})});try{const s=yield k.post(reverseUrl("client_invoice"),t);B.success("Invoice created successfully",{icon:"✔"})}catch(s){B.error("Something went wrong! Please try again",{icon:"❌"}),C(s.response.data.errors)}finally{S(!1)}});return e.jsxs("div",{className:"card card-raised mt-3 mb-5 mx-4",children:[e.jsxs("div",{className:"card-header px-4 bg-info",style:{height:"50px"},children:[e.jsx(G,{position:"top-right"}),e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"",children:e.jsxs("h2",{className:"display-6 text-white",children:["Rental Invoicing -"," ",y().date()>25?y().add(1,"months").format("MMMM YYYY"):y().format("MMMM YYYY")]})})})]}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",lineHeight:"15px",fontSize:"12px"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Inv. Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Lease No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Address"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Co. Reg. No. / ID No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Tenant Name"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Currency"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Base Rental"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Operating Costs"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Total"})]})}),e.jsxs("tbody",{children:[e.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:e.jsx("th",{scope:"row",children:"USD"})}),n!=null&&n.length?n.map(t=>e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsxs("th",{scope:"row",children:[t.payment_period_start,"-",y().format("MM-YYYY")," "]}),e.jsx("td",{children:t.id}),e.jsx("td",{children:t.address}),e.jsx("td",{children:t.reg_number}),e.jsx("td",{children:t.tenant_name}),e.jsx("td",{children:t.lease_currency_type}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.owing_amount,onChange:s=>m({type:"updateBaseRental",id:t.id,owing_amount:s.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.operationalCosts,onChange:s=>m({type:"updateOperatingCosts",id:t.id,operationalCosts:s.target.value})})}),e.jsx("td",{className:"text-end",children:N(t.total)})]},t.id)):"",e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsx("td",{colSpan:7}),e.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),e.jsx("td",{className:"text-end fw-bold",children:N(f)})]}),e.jsx("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:e.jsx("th",{scope:"row",children:"ZWG"})}),u!=null&&u.length?u.map(t=>e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsxs("th",{scope:"row",children:[t.payment_period_start,"-",y().format("MM-YYYY")," "]}),e.jsx("td",{children:t.id}),e.jsx("td",{children:t.address}),e.jsx("td",{children:t.reg_number}),e.jsx("td",{children:t.tenant_name}),e.jsx("td",{children:t.lease_currency_type}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.owing_amount,onChange:s=>_({type:"updateBaseRental",id:t.id,owing_amount:s.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:t.operationalCosts,onChange:s=>_({type:"updateOperatingCosts",id:t.id,operationalCosts:s.target.value})})}),e.jsx("td",{className:"text-end",children:N(t.total)})]},t.id)):"",e.jsxs("tr",{style:{lineHeight:"15px",fontSize:"12px"},children:[e.jsx("td",{colSpan:7}),e.jsx("td",{className:"text-end fw-bold",children:"Batch Total"}),e.jsx("td",{className:"text-end fw-bold",children:N(w)})]})]})]})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{onClick:H,className:"btn btn-info",children:I?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"processing.."})]}):e.jsx(e.Fragment,{children:"Submit"})})})]})]})};P.layout=a=>e.jsx(F,{children:a,title:"Tenant Invoicing"});export{P as default};
