var R=Object.defineProperty,L=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var P=(t,s,a)=>s in t?R(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,k=(t,s)=>{for(var a in s||(s={}))W.call(s,a)&&P(t,a,s[a]);if(F)for(var a of F(s))B.call(s,a)&&P(t,a,s[a]);return t},T=(t,s)=>L(t,M(s));import{j as e,r as u,u as U,b as _,_ as E,R as $}from"./main-a6dda5c9.js";import{l as S}from"./lodash-d3c3e9f3.js";import{u as w,d as D,f as I}from"./index-cdca6ff0.js";import{W as z}from"./Layout-b4321159.js";import{r as q}from"./index-c8db368f.js";import{h as A}from"./html2pdf-b22cf485.js";import{M as C}from"./Modal-c2655e25.js";function g({title:t,children:s,noBoundary:a,noOuterStyles:l}){const n=l?"":a?"bg-white mb-3":"bg-white rounded-2 border overflow-hidden border-dark shadow-sm mb-3";return e.jsxs("div",{className:n,children:[e.jsx("div",{className:"rounded-top-2 custom-bg-grey text-white text-center p-1",children:S.capitalize(t)}),s]})}function me({data:t,isCreditorView:s}){let a=0;return Object.keys(t).forEach(l=>a+=t[l]),e.jsx(g,{title:s?"ageing":"aged analysis",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"90+ Days"}),e.jsx("th",{children:"90 Days"}),e.jsx("th",{children:"60 Days"}),e.jsx("th",{children:"30 Days"}),e.jsx("th",{children:"Current"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:t.oneTwentyDays}),e.jsx("td",{children:t.ninetyDays}),e.jsx("td",{children:t.sixtyDays}),e.jsx("td",{children:t.thirtyDays}),e.jsx("td",{children:t.current}),e.jsxs("td",{children:["$",a.toFixed(2)]})]})})]})})}function H(t,s,a){const[l,n]=u.useState(!t),[h,c]=u.useState(t),[d,m]=u.useState(""),[o,r]=u.useState(!1),{Auth:x}=U().props,y=`${x.user_profile.first_name} ${x.user_profile.last_name}`;function f(p){p.preventDefault(),r(!0),m("");const b=Object.fromEntries(new FormData(p.target).entries());a?b.creditor_id=s.toString():b.client_id=s.toString(),_.put(reverseUrl("debtor_intelligence"),b).then(N=>{const i={text:N.data.note,user:N.data.user_name,timestamp:N.data.updated_at||N.data.created_at};c(i),m(""),r(!1),n(!1)}).catch(N=>{m(w(N)),r(!1),n(!h)})}return{data:h,isEditMode:l,handleSave:f,loggedInUser:y,setIsEditMode:n,error:d,setError:m,isLoading:o}}function he({data:t,clientId:s,isCreditorView:a}){const{data:l,isEditMode:n,handleSave:h,loggedInUser:c,setIsEditMode:d,error:m,setError:o,isLoading:r}=H(t,s,a);return e.jsx(g,{title:a?"creditor intelligence":"customer intelligence",children:e.jsxs("div",{className:"px-3 py-2",children:[m&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>o(""),className:"btn-close btn-sm"}),S.truncate(m,{length:150})]}),n?e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"note",className:"form-label",children:l&&l.text?"Edit note":"No note found, create new note"}),e.jsx("textarea",{className:"form-control",name:"note",id:"note",rows:"2",defaultValue:l&&l.text?l.text:"",placeholder:"type here...",disabled:r})]}),e.jsx("b",{className:"d-block my-1",children:c}),e.jsx("div",{className:"small text-success",children:"today"}),e.jsx("button",{disabled:r,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:r?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsx("small",{children:l.text}),e.jsx("b",{className:"d-block my-1",children:l.user}),e.jsx("div",{className:"small text-success",children:D(l.timestamp)}),e.jsx("button",{onClick:()=>d(!0),type:"button",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Edit"})]})]})})}function V(t,s,a,l){const[n,h]=u.useState(!t),[c,d]=u.useState(t),[m,o]=u.useState(""),[r,x]=u.useState(!1);function y(f){f.preventDefault(),x(!0),o("");const p=Object.fromEntries(new FormData(f.target).entries());a?p.creditor_id=s.toString():(p.client_id=s.toString(),p.lease_id=l),p.other_numbers=p.other_numbers.split(",").filter(Boolean).map(b=>b.trim()),console.log(p),_.put(reverseUrl("update_client_contact_details"),p).then(b=>{const N={contactPerson:`${b.data.firstname} ${b.data.surname}`,smsNumber:b.data.sms_number,otherNumbers:b.data.other_numbers?b.data.other_numbers.join(", "):"",emailAddress:b.data.email_address,address:b.data.address};console.log({res:b,newData:N}),d(N),o(""),x(!1),h(!1)}).catch(b=>{o(w(b)),x(!1),h(!c)})}return{data:c,isEditMode:n,handleSave:y,setIsEditMode:h,error:m,setError:o,isLoading:r}}function be({data:t,clientId:s,isCreditorView:a,leaseId:l}){const{data:n,isEditMode:h,handleSave:c,setIsEditMode:d,error:m,setError:o,isLoading:r}=V(t,s,a,l);return e.jsx(g,{title:"contact details",children:e.jsxs("div",{className:"py-2",children:[m&&e.jsxs("p",{className:"d-flex align-items-start px-2 gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>o(""),className:"btn-close btn-sm"}),S.truncate(m,{length:150})]}),h?e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"firstname",className:"form-label small",children:"First Name"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"firstname",id:"firstname",disabled:r,defaultValue:n&&n.contactPerson?n.contactPerson.trim().split(" ")[0]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"surname",className:"form-label small",children:"Surname"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"surname",id:"surname",disabled:r,defaultValue:n&&n.contactPerson?n.contactPerson.trim().split(" ")[1]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"sms_number",className:"form-label small",children:"SMS Number"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"sms_number",id:"sms_number",disabled:r,defaultValue:n&&n.smsNumber?n.smsNumber:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"other_numbers",className:"form-label small",children:"Other Numbers"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"other_numbers",id:"other_numbers",disabled:r,defaultValue:n&&n.otherNumbers?n.otherNumbers:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"email_address",className:"form-label small",children:"Email Address"}),e.jsx("input",{type:"email",className:"form-control form-control-sm w-50 rounded-2",name:"email_address",id:"email_address",disabled:r,defaultValue:n&&n.emailAddress?n.emailAddress:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"address",className:"form-label small",children:"Address"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"address",id:"address",disabled:r,defaultValue:n&&n.address?n.address:""})]}),e.jsx("button",{disabled:r,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:r?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{style:{width:"40%"},children:"Contact Person: "}),e.jsx("div",{style:{width:"60%"},children:n.contactPerson})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{style:{width:"40%"},children:"SMS Number: "}),e.jsx("div",{style:{width:"60%"},children:n.smsNumber})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{style:{width:"40%"},children:"Other Numbers: "}),e.jsx("div",{style:{width:"60%"},children:n.otherNumbers})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{style:{width:"40%"},children:"Email Address: "}),e.jsx("div",{style:{width:"60%"},children:n.emailAddress})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{style:{width:"40%"},children:"Address: "}),e.jsx("div",{style:{width:"60%"},children:n.address})]}),e.jsx("div",{className:"mt-4 px-2",children:e.jsx("button",{onClick:()=>d(!0),type:"button",className:"d-block btn btn-info w-100 text-white",children:"Edit"})})]})]})})}function ue({data:t,isCreditorView:s}){return e.jsx(g,{title:s?"forecast outflows":"forecast inflows",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"0-7 Days"}),e.jsx("th",{children:"8-14 Days"}),e.jsx("th",{children:"15-21 Days"}),e.jsx("th",{children:"21+ Days"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:t.zeroToSevenDays}),e.jsx("td",{children:t.eightToFourteenDays}),e.jsx("td",{children:t.fourteenToTwentyOneDays}),e.jsx("td",{children:t.twentyOnePlusDays}),e.jsxs("td",{children:["$",Number.isNaN(Number(t.total))?t.total:Number(t.total).toFixed(2)]})]})})]})})}function G(t,s,a){const[l,n]=u.useState(t),[h,c]=u.useState(""),[d,m]=u.useState(!1),[o,r]=u.useState("note"),[x,y]=u.useState(void 0);function f(i){i.preventDefault(),m(!0),c("");const j=Object.fromEntries(new FormData(i.target).entries());a?j.creditor_id=String(s):j.client_id=String(s),j.reminder_type=o.toUpperCase(),o==="note"&&(j.action_date=new Date().toISOString().split("T")[0]),_.post(reverseUrl("communication_history"),j).then(v=>{n(O=>[...O,{text:v.data.message,actionDone:v.data.action_done,user:v.data.user_name,communicationType:v.data.reminder_type.toLowerCase(),timestamp:v.data.created_at}]),c(""),m(!1)}).catch(v=>{c(w(v)),m(!1)}),i.target.reset()}function p(i){y(k({isWorks:i.communicationType==="works"},i)),r("works")}function b(){r("note"),y(void 0)}const N=l.toSorted().sort((i,j)=>new Date(j.timestamp).getTime()-new Date(i.timestamp).getTime());return{error:h,messages:l,worksData:x,isLoading:d,messagesToMap:N,remainderType:o,setError:c,closeWorks:b,handleSubmit:f,setRemainderType:r,openWorksOrMaintenance:p}}function K(){const[t,s]=u.useState(!1),[a,l]=u.useState(!1),[n,h]=u.useState("residential"),c=u.useRef();function d(){const o=c.current;A().from(o).set({margin:1,filename:"modal-content.pdf",html2canvas:{scale:2},jsPDF:{orientation:"portrait"}}).save()}function m(o){o.preventDefault(),l(!1),s(!0),A().from(c.current).set({margin:1,filename:"modal-content.pdf",html2canvas:{scale:2},jsPDF:{orientation:"portrait"}}).outputPdf("blob").then(r=>{const x=new FormData;return x.append("inspection_pdf",r,"residential_inspection.pdf"),console.log(x),_.post(reverseUrl("save_inspection_document"),x,{headers:{"Content-Type":"multipart/form-data"}})}).then(r=>{E.success(w(r)),l(!0),s(!1)}).catch(r=>{E.error(w(r)),l(!1),s(!1)})}return{activeTab:n,isLoading:t,wasSuccessful:a,printContentRef:c,printForm:d,setWasSuccessful:l,handleResidentialSubmission:m,showCommercial:()=>h("commercial"),showResidential:()=>h("residential")}}function Y({category:t}){return e.jsx("div",{style:{gridColumn:t.subCategories?"span 2":"span 1",gridRow:"auto"},className:"p-3",children:e.jsxs("div",{className:"border shadow-sm",children:[e.jsxs("table",{className:"table bg-white mb-0 table-sm table-responsive table-bordered",children:[e.jsx("thead",{className:"text-center text-info text-capitalize",children:t.subCategories?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"c-bg-light text-body text-start",children:t.category}),t.subCategories.map(s=>e.jsx("th",{colSpan:3,children:s},s))]}),e.jsxs("tr",{children:[e.jsx("th",{}),t.subCategories.map(s=>e.jsxs($.Fragment,{children:[e.jsx("th",{style:{width:"3.5rem"},children:"Good"}),e.jsx("th",{style:{width:"3.5rem"},children:"Ok"}),e.jsx("th",{style:{width:"3.5rem"},children:"Bad"})]},s))]})]}):e.jsxs("tr",{children:[e.jsx("th",{className:"c-bg-light text-body text-start",children:t.category}),e.jsx("th",{style:{width:"3.5rem"},children:"Good"}),e.jsx("th",{style:{width:"3.5rem"},children:"Ok"}),e.jsx("th",{style:{width:"3.5rem"},children:"Bad"})]})}),e.jsx("tbody",{className:"text-capitalize",children:t.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s}),t.subCategories?t.subCategories.map(a=>e.jsxs($.Fragment,{children:[e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"good",name:`${t.category}-${s}-${a}`})})}),e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"ok",name:`${t.category}-${s}-${a}`})})}),e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"bad",name:`${t.category}-${s}-${a}`})})})]},a)):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"good",name:`${t.category}-${s}`})})}),e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"ok",name:`${t.category}-${s}`})})}),e.jsx("td",{children:e.jsx("div",{className:"form-check d-flex align-items-center justify-content-center",children:e.jsx("input",{className:"form-check-input p-2",type:"radio",value:"bad",name:`${t.category}-${s}`})})})]})]},s))})]}),e.jsx("div",{className:"c-bg-light p-2 rounded-bottom rounded-bottom-5",children:t.description}),e.jsx("div",{children:e.jsx("textarea",{className:"form-control border-0 rounded rounded-5",name:t.category+"_notes",id:t.category+"_notes",placeholder:"Notes...",rows:3})})]})})}function J({isOpen:t,close:s}){const{activeTab:a,isLoading:l,wasSuccessful:n,printContentRef:h,printForm:c,showCommercial:d,showResidential:m,setWasSuccessful:o,handleResidentialSubmission:r}=K();return e.jsx(e.Fragment,{children:e.jsxs(C,{show:t,onHide:()=>{o(!1),s()},size:"xl",contentClassName:"custom-bg-whitesmoke",backdrop:"static",centered:!0,children:[e.jsx(C.Header,{className:"p-0",children:e.jsx("div",{className:"w-100 p-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[!(l||n)&&e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",onClick:m,className:a==="residential"?"btn btn-info text-white":"btn btn-outline-info",children:"Residential"}),e.jsx("button",{disabled:!0,type:"button",onClick:d,className:a==="maintenance"?"btn btn-info text-white":"btn btn-outline-info",children:"Commercial"})]}),e.jsx("div",{className:"ms-auto d-flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>{o(!1),s()},className:"btn btn-danger btn-sm",children:e.jsx("i",{className:"material-icons fs-3",children:"close"})})})]})})}),e.jsx(C.Body,{children:e.jsxs("div",{className:"custom-mn-h-5 position-relative p-3 pb-0",children:[l&&e.jsxs("div",{className:"text-center position-absolute top-50 start-50 translate-middle",children:[e.jsx("div",{className:"spinner-border text-info spinner-border-md",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Submitting..."})}),e.jsx("p",{children:"Submitting...please wait"})]}),n&&e.jsxs("div",{className:"position-absolute text-center top-50 start-50 translate-middle",children:[e.jsx("div",{children:e.jsx("i",{className:"material-icons fs-1 text-success",children:"check_circle"})}),e.jsxs("p",{children:["Done! ",e.jsx("br",{}),e.jsx("button",{type:"button",className:"btn btn-info text-white mt-2",onClick:()=>{o(!1),s()},children:"Close"})]})]}),e.jsx("div",{className:l||n?"d-none":"d-block",children:a==="residential"?e.jsx(Q,{printContentRef:h,printForm:c,handleSubmit:r}):e.jsx(X,{})})]})})]})})}function Q({printContentRef:t,printForm:s,handleSubmit:a}){return e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{ref:t,className:"p-4",children:[e.jsx("h5",{className:"mb-5",children:"PROPERTY INSPECTION CHECKLIST - RESIDENTIAL"}),e.jsxs("div",{className:"mb-3 flex align-items-center ",children:[e.jsx("label",{htmlFor:"address",className:"form-label me-3",children:"Address"}),e.jsx("input",{className:"custom-form-control bg-transparent col-6 border-0 border-bottom border-bottom-3 border-dark",name:"address",id:"address"})]}),e.jsxs("div",{className:"flex align-items-center ",children:[e.jsx("label",{htmlFor:"date",className:"form-label me-3",children:"Date"}),e.jsx("input",{className:"custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"date",type:"date",id:"date"})]}),e.jsx("p",{className:"my-5 px-3",children:"M - missing, S - scratched, D - damaged, B - broken, R - repair/replace, W - Water Damage, L - Leaking"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},className:"align-items-start mb-4",children:q.map(l=>e.jsx(Y,{category:l},l.category))}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"additional_notes",className:"form-label d-block mb-2",children:"Additional Notes:"}),e.jsx("textarea",{className:"form-control w-50",rows:4,placeholder:"Additional Notes:",name:"additional_notes",id:"additional_notes"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"action_items",className:"form-label d-block mb-2",children:"Action Items:"}),e.jsx("textarea",{className:"form-control w-50",rows:4,placeholder:"Action Items:",name:"action_items",id:"action_items"})]}),e.jsxs("fieldset",{className:"rounded p-3 rounded-5 mb-5",children:[e.jsx("legend",{children:"Inspector"}),e.jsxs("div",{className:"d-flex mb-3 align-items-center",children:[e.jsx("label",{htmlFor:"inspector_name",className:"form-label me-3",children:"Name"}),e.jsx("input",{className:"col-4 custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"inspector_name",id:"inspector_name"}),e.jsx("label",{htmlFor:"inspector_signature",className:"form-label mx-3",children:"Signature"}),e.jsx("input",{className:"col-4 custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"inspector_signature",id:"inspector_signature"})]}),e.jsxs("div",{className:"flex align-items-center",children:[e.jsx("label",{htmlFor:"inspector_date",className:"form-label me-3",children:"Date:"}),e.jsx("input",{className:"custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"inspector_date",id:"inspector_date",type:"date"})]})]}),e.jsxs("fieldset",{className:"rounded p-3 rounded-5 mb-5",children:[e.jsx("legend",{children:"Manager Review"}),e.jsxs("div",{className:"d-flex mb-3 align-items-center",children:[e.jsx("label",{htmlFor:"manager_name",className:"form-label me-3",children:"Name:"}),e.jsx("input",{className:"col-4 custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"manager_name",id:"manager_name"}),e.jsx("label",{htmlFor:"manager_signature",className:"form-label mx-3",children:"Signature:"}),e.jsx("input",{className:"col-4 custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"manager_signature",id:"manager_signature"})]}),e.jsxs("div",{className:"flex align-items-center ",children:[e.jsx("label",{htmlFor:"manager_date",className:"form-label me-3",children:"Date:"}),e.jsx("input",{className:"custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"manager_date",id:"manager_date",type:"date"})]})]}),e.jsxs("div",{className:"mb-5 flex align-items-center px-3",children:[e.jsx("label",{htmlFor:"score",className:"form-label me-3",children:"Score (%):"}),e.jsx("input",{className:"custom-form-control bg-transparent border-0 border-bottom border-bottom-3 border-dark",name:"score",id:"score",type:"number"})]})]}),e.jsxs("div",{className:"d-flex justify-content-end align-items-center pb-5",children:[e.jsx("button",{onClick:s,className:"btn btn-dark me-4",type:"button",children:"Print"}),e.jsx("button",{className:"btn btn-success",type:"submit",children:"Submit"})]})]})}function X(){return e.jsx("form",{children:"commercial"})}function xe({disabled:t,lease:s,messages:a,clientId:l,isCreditorView:n,creditorId:h,refresh:c}){const{error:d,worksData:m,isLoading:o,remainderType:r,messagesToMap:x,setError:y,closeWorks:f,handleSubmit:p,setRemainderType:b,openWorksOrMaintenance:N}=G(a,l,n);return e.jsxs(e.Fragment,{children:[r==="works"&&e.jsx(z,{isOpen:r==="works",close:f,viewDefaults:m,lease:s,creditorId:h,refresh:c}),r==="inspection"&&e.jsx(J,{isOpen:r==="inspection",close:()=>b("note")}),e.jsx(g,{noBoundary:!0,title:"communication history",children:e.jsxs("div",{className:"custom-bg-whitesmoke px-5 py-3",children:[e.jsxs("div",{className:"custom-vh-50 custom-overflow-y-auto",children:[x.map((i,j)=>i.communicationType==="works"||i.communicationType==="maintenance"?e.jsxs("div",{className:"custom-message py-2 px-3 border shadow-sm mb-3",children:[e.jsxs("small",{children:[e.jsx("b",{className:"text-capitalize",children:`${i.communicationType} Schedule - ${i.data.title}`}),e.jsx("br",{}),i.data.details||""," ",e.jsx("a",{onClick:()=>N(k({communicationType:i.communicationType},i.data)),role:"button",className:"btn-link fw-bold ps-1 text-success ",children:"view"})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end align-items-center text-end gap-2",children:[e.jsx("small",{className:"smallest",children:e.jsxs("b",{children:[i.user||"n/a",i.communicationType&&" | "+i.communicationType.toLowerCase()]})}),e.jsx("small",{className:"text-success smallest",children:D(i.timestamp)})]})]},j):e.jsxs("div",{className:"custom-message py-2 px-3 border shadow-sm mb-3",children:[e.jsx("small",{children:i.text+(i.communicationType.toLowerCase().trim()!=="note"&&i.actionDone?` (action date: ${D(i.actionDone)})`:"")}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end align-items-center text-end gap-2",children:[e.jsx("small",{className:"smallest",children:e.jsxs("b",{children:[i.user||"n/a",i.communicationType&&" | "+i.communicationType.toLowerCase()]})}),e.jsx("small",{className:"text-success smallest",children:D(i.timestamp)})]})]},j)),x.length===0&&e.jsxs("small",{className:"h-100 text-grey d-flex justify-content-center align-items-center text-center",children:["No communication ",e.jsx("br",{})," history"]})]}),e.jsxs("form",{onSubmit:p,className:"border-top border-4 w-100 pt-3",children:[d&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>y(""),className:"btn-close btn-sm"}),S.truncate(d,{length:150})]}),e.jsx("textarea",{rows:2,name:"message",id:"message",placeholder:"Type message here...",className:"d-block w-100 p-2 custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0,disabled:o}),e.jsxs("div",{className:"d-flex flex-wrap justify-content-center pt-2 gap-2 align-items-center",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"note",id:"reminder_type-note",checked:r==="note",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-note",children:"Note"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"sms",id:"reminder_type-sms",checked:r==="sms",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-sms",children:"SMS"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"email",id:"reminder_type-email",checked:r==="email",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-email",children:"Email"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"reminder",id:"reminder_type-reminder",checked:r==="reminder",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-reminder",children:"Reminder"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"works",id:"reminder_type-works",checked:r==="works",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-works",children:"Works"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"inspection",id:"reminder_type-inspection",checked:r==="inspection",onChange:i=>b(i.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-inspection",children:"Inspection"})]})]}),r!=="note"&&r!=="works"&&e.jsxs("div",{className:"d-flex my-2 gap-2 align-items-center justify-content-center",children:[e.jsx("label",{htmlFor:"action_date",className:"small d-block text-nowrap form-label",children:`${r==="reminder"?"Show":"Send"} ${r} on:`}),e.jsx("input",{min:new Date().toISOString().split("T")[0],type:"date",className:"form-control form-control-sm rounded-4",name:"action_date",id:"action_date",required:!0})]}),e.jsx("button",{disabled:o||t,type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:o?"Submiting...":"Submit"})]})]})})]})}function Z(t,s,a,l,n,h){const[c,d]=u.useState(t),[m,o]=u.useState(""),[r,x]=u.useState(!1),[y,f]=u.useState([]);function p(){x(!0),o("");const i={plans:y.map(j=>T(k(k({},j),l?{creditor_id:s.toString()}:{client_id:s.toString()}),{spoke_with:l?n:j.spoke_with,lease_id:h}))};_.post(reverseUrl("payment_plans"),i).then(j=>{f([]),o(""),x(!1),a()}).catch(j=>{o(w(j)),f([]),x(!1)})}function b(i){f(j=>[...j,i])}function N(){f([])}return{paymentPlans:c,newPaymentPlans:y,addNewPaymentPlan:b,confirmNewPaymentPlans:p,clearNewPaymentPlans:N,error:m,setError:o,isLoading:r}}function ee({addNewPaymentPlan:t,isCreditorView:s}){const[a,l]=u.useState("");function n(c){let d=c.target.value;if(d.includes(".")){const[m,o]=d.split(".");o.length>2&&(d=`${m}.${o.substring(0,2)}`)}l(d)}function h(c){c.preventDefault();const d=Object.fromEntries(new FormData(c.target).entries());t(d)}return e.jsx(g,{title:"payment plans",children:e.jsxs("form",{onSubmit:h,className:"p-3",children:[!s&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"spoke_with",className:"text-nowrap",children:"Person spoken with:"}),e.jsx("input",{type:"text",name:"spoke_with",id:"spoke_with",placeholder:"Person spoken with here",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"expected_pay_date",className:"text-nowrap",children:"Expected Pay Date:"}),e.jsx("input",{type:"date",name:"expected_pay_date",id:"expected_pay_date",className:"custom-form-control border-0 custom-pointer border-bottom border-bottom-3 border-dark",required:!0,defaultValue:new Date().toISOString().split("T")[0],min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-nowrap",children:"Amount ($):"}),e.jsx("input",{min:0,type:"number",step:"0.01",name:"amount",id:"amount",value:a,onChange:n,placeholder:"Amount in $",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsx("button",{type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Add to payment plan"})]})})}function te({paymentPlans:t,isCreditorView:s}){return e.jsx(g,{title:s?"active payment plans":"payment plans",children:e.jsx("div",{className:"custom-mx-h-15 overflow-auto",children:e.jsxs("table",{className:"table table-sm table-responsive position-relative table-bordered mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white position-sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan ID"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Date"})]})}),e.jsxs("tbody",{children:[t.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.id||l}),e.jsx("td",{children:a.amount}),e.jsx("td",{children:I(a.date)})]},a.id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center small text-grey py-3",children:"No payment plans"})})]})]})})})}function se({newPaymentPlans:t,confirmNewPaymentPlans:s,clearNewPaymentPlans:a,error:l,setError:n,isLoading:h,currency:c}){return e.jsx(g,{title:"plan details",children:e.jsxs("div",{className:"p-3 pb-2",children:[e.jsxs("div",{className:"custom-h-07 overflow-auto",children:[t.map((d,m)=>e.jsx("div",{className:"p-1 small border-bottom",children:`${d.spoke_with||""} promised to pay ${String(c||"").toUpperCase()} ${d.amount} on ${I(d.expected_pay_date)}`},m)),t.length===0&&e.jsx("div",{className:"text-center small text-grey py-3",children:"No new payment plans"})]}),e.jsxs("div",{className:"pt-2 bg-white",children:[l&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>n(""),className:"btn-close btn-sm"}),S.truncate(l,{length:150})]}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"d-block btn btn-info w-100 text-white",disabled:h||!t.length,children:h?"Saving...":"Save plan"}),e.jsx("button",{type:"button",onClick:a,className:"d-block btn btn-dark w-100 text-white",disabled:h||!t.length,children:"Clear All"})]})]})]})})}function pe({isCreditorView:t,paymentPlans:s,clientId:a,refreshClientViewData:l,creditorName:n,leaseId:h,currency:c}){const{paymentPlans:d,newPaymentPlans:m,addNewPaymentPlan:o,confirmNewPaymentPlans:r,clearNewPaymentPlans:x,error:y,setError:f,isLoading:p}=Z(s,a,l,t,n,h);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{isCreditorView:t,addNewPaymentPlan:o,clientId:a}),e.jsx(se,{isCreditorView:t,newPaymentPlans:m,confirmNewPaymentPlans:r,clearNewPaymentPlans:x,error:y,setError:f,isLoading:p,currency:c}),e.jsx(te,{isCreditorView:t,paymentPlans:d})]})}export{me as A,be as C,he as D,ue as F,pe as P,xe as a};
