var O=Object.defineProperty,P=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var w=(a,o,s)=>o in a?O(a,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[o]=s,h=(a,o)=>{for(var s in o||(o={}))D.call(o,s)&&w(a,s,o[s]);if(_)for(var s of _(o))H.call(o,s)&&w(a,s,o[s]);return a},x=(a,o)=>P(a,z(o));var v=(a,o,s)=>new Promise((l,b)=>{var j=i=>{try{p(s.next(i))}catch(g){b(g)}},R=i=>{try{p(s.throw(i))}catch(g){b(g)}},p=i=>i.done?l(i.value):Promise.resolve(i.value).then(j,R);p((s=s.apply(a,o)).next())});import{r as c,a as M,j as e,i as U}from"./main-40f04849.js";import{I as V,_ as S}from"./index-21c89b93.js";import{C as W}from"./Layout-af21419b.js";import{M as y}from"./Modal-ed071cf6.js";function ee({myKey:a,show:o,handleClose:s,leaseDetails:l}){const[b,j]=c.useState(""),[R,p]=c.useState(!1);c.useState(0);const[i,g]=c.useState({});c.useReducer(B,[]);const[$,A]=c.useState(null),{data:q,setData:G,post:J,reset:C}=M([]);c.useEffect(()=>{a&&A(a)},[a]),console.log("leaseDetails",l);function B(n,r){switch(r.type){case"initialize":return[...n,...r.payload];case"updatePaymentAmount":return n.map(t=>t.lease_id===r.payload.lease_id?x(h({},t),{paymentAmount:r.payload.paymentAmount}):t);case"updatePaymentDate":return n.map(t=>t.lease_id===r.payload.lease_id?x(h({},t),{paymentDate:r.payload.paymentDate}):t);case"updateReceiptNumber":return n.map(t=>t.lease_id===r.payload.lease_id?x(h({},t),{receiptNumber:r.payload.receiptNumber}):t);case"updateDetails":return n.map(t=>t.lease_id===r.payload.lease_id?x(h({},t),{details:r.payload.details}):t);default:return n}}const L=n=>v(this,null,function*(){n.preventDefault(),p(!0),U.Inertia.post(reverseUrl("create_receipt_and_payment"),{rows:u,myKey:a},{onSuccess:r=>{var t,d;if(((t=r.props)==null?void 0:t.result)==="error"){S.error((d=r.props)==null?void 0:d.result);return}s("Receipts created successfully").then(()=>{C()})},onError:r=>{j(r),S.error("Something went wrong! Please try again")},onFinish:()=>{p(!1)}})}),T=[{id:1,paymentDate:new Date().toISOString().split("T")[0],tenant:"",receiptNumber:"",details:"",currency:"",rent_owing:"",color:"",paymentAmount:"",accountBalance:""}];c.useEffect(()=>{l&&l.owing_amount&&f([{id:1,lease_id:l.lease_id,paymentDate:new Date().toISOString().split("T")[0],tenant:l.name,receiptNumber:"",details:"",currency:l.currency,rent_owing:l.owing_amount,color:l.color,paymentAmount:"",accountBalance:l.owing_amount}])},[l]);const[u,f]=c.useState(T),I=()=>{const n={id:u.length+1,date:new Date().toISOString().split("T")[0],customerType:"",customerName:"",details:"",accountBalance:"",endBalance:""};f([...u,n])},N=(n,r)=>{const{name:t,value:d}=n.target,m=[...u];if(m[r][t]=d,t==="paymentAmount"){const k=parseFloat(m[r].rent_owing)||0,E=parseFloat(d)||0;m[r].accountBalance=k-E}f(m)},F=(n,r)=>{if(!n)return;const t=[...u],d=t.slice(0,r).reverse().find(m=>m.tenant===n.tenant);d?t[r].rent_owing=d.accountBalance:t[r].rent_owing=n.rent_owing,t[r].tenant=n.tenant,t[r].lease_id=n.lease_id,t[r].currency=n.Currency,t[r].accountBalance=t[r].rent_owing-(t[r].paymentAmount||0),t[r].color=n.color,f(t)};return e.jsx("div",{className:"container-xl p-5",children:e.jsxs("div",{className:" ",children:[e.jsx(V,{position:"top-right",duration:"4000"}),e.jsxs(y,{show:o,onHide:s,size:"xl",backdrop:"static",centered:!0,children:[e.jsx(y.Header,{closeButton:!0}),e.jsx(y.Body,{className:"p-4 d-flex w-100 flex-column justify-content-between align-items-center",children:e.jsxs("div",{className:"table-responsive  w-100 ",children:[e.jsx("div",{className:"flex justify-content-center align-items-center w-100",children:e.jsx("h5",{className:"text-center tf-color bg-info",children:"Rent Receipt"})}),e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderTop:"0px",fontSize:"12px",width:"100%"},children:[e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Date"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Customer"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Receipt No."}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Details"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Currency"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Amount Owing"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid #e0e0e0"},children:"Received Amount"}),e.jsx("th",{scope:"col",style:{borderTop:"1px solid",borderBottom:"1px solid"},children:"Amount Balance"})]})}),e.jsx("tbody",{children:u.map((n,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{className:"form-control form-control-sm tf-borderRight tf-input",type:"date",name:"paymentDate",value:n.paymentDate,onChange:t=>N(t,r),style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx(W,{url:reverseUrl("get_all_active_leases"),onChange:t=>F(t,r),value:n.tenant?{label:n.tenant,value:n.lease_id}:null,defaultValue:null,isDisabled:!1})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px",maxWidth:"60px"},children:e.jsx("input",{onChange:t=>g(x(h({},i),{receiptNumber:t.target.value})),className:"form-control form-control-sm tf-borderRight tf-input",type:"text",name:"receiptNumber",id:"receiptNumber",value:i==null?void 0:i.receiptNumber,style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{className:"form-control form-control-sm tf-borderRight tf-input",type:"text",id:"details",name:"details",value:n.details,onChange:t=>N(t,r),style:{width:"100%",border:"1px solid #111"}})}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:n.currency}),e.jsx("td",{className:`tf-borderRight bg-${n==null?void 0:n.color} text-white text-center`,style:{paddingRight:"1px",paddingLeft:"1px",backgroundColor:(n==null?void 0:n.color)==="light-red"?"rgb(248, 113, 113)":""},children:n.rent_owing}),e.jsx("td",{className:"tf-borderRight",style:{paddingRight:"1px",paddingLeft:"1px"},children:e.jsx("input",{type:"text",name:"paymentAmount",value:n.paymentAmount,onChange:t=>N(t,r)})}),e.jsx("td",{className:"tf-borderRight text-end",style:{paddingRight:"1px",paddingLeft:"1px",borderBottom:"1px solid #e0e0e0"},children:e.jsx("input",{type:"text",name:"accountBalance",value:n.accountBalance,dissabled:!0})})]},n.id))})]}),e.jsx("div",{className:"d-flex flex-row-reverse",children:e.jsxs("button",{className:"btn btn-raised bg-success text-white",style:{backgroundColor:"#0d475c"},onClick:I,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Receipts"]})})]})}),e.jsx(y.Footer,{className:"p-4 d-flex justify-content-center",children:e.jsx("div",{className:"d-flex flex-row-reverse",children:e.jsx("button",{className:"btn btn-raised bg-info text-white",style:{backgroundColor:"#0d475c"},onClick:L,children:R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ml-2",children:"Processing.."})]}):e.jsx(e.Fragment,{children:"Submit"})})})})]})]})})}export{ee as R};
