import{r as l,u as R,d as P,b as q,_ as O,j as e}from"./media/main-c80d2cda.js";import{f as k}from"./index-739ec490.js";import{S as Y}from"./SearchBar-9dd8336e.js";import{C as M,I as J,L as Z}from"./Layout-2e654d99.js";import{U as z}from"./UserSelector-970475ab.js";import{d as G}from"./index-b312c35d.js";import"./formatting-fad57ba1.js";import"./lodash-1ae05641.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-760bb04d.js";import"./Modal-31d2f2ff.js";import"./index-e9289761.js";import"./MultipleUpload-8e064d3c.js";import"./search-f7ce433a.js";function K(){const[n,j]=l.useState([]),[m,r]=l.useState(!1),{url:o}=R();l.useEffect(()=>{},[o]);function p(c){c.preventDefault();const f=c.target.year.value,u=c.target.month.value,i=new URL(o);i.searchParams.set("year",f),i.searchParams.set("month",u),P.Inertia.replace(i.href,{preserveState:!0})}return{loading:m,creditNotes:n,handleFilters:p}}function Q(n){const[j,m]=l.useState(null),[r,o]=l.useState(!1),[p,c]=l.useState(!1),[f,u]=l.useState("USD"),[i,y]=l.useState([]),[w,s]=l.useState([]),[S,_]=l.useState(0),[g,N]=l.useState(0),[h,b]=l.useState(new Array(G).fill({static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}));l.useEffect(()=>{if(n){const t={document_number:n.document_number,credit_to:n.bill_to,address:n.address,phone:n.phone,email:n.email,vat_no:n.vat_no,tin:n.tin,currency:n.currency,monthly_rental:n.monthly_rental};m(t),u(t.currency),b([t.monthly_rental])}},[n]),l.useEffect(()=>{C(),D()},[]);function C(){q.get("/accounting/items/").then(t=>{y(t.data)}).catch(t=>{console.log(t)})}function D(){q.get("/accounting/vat-settings/").then(t=>{s(t.data)}).catch(t=>{console.error(t)})}function F(){b([...h,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function T(t){const a=h.filter((x,d)=>d!==t);b(a)}function v(){c(!0)}function A(){c(!1)}function E(t){if(t.preventDefault(),!h.length){O.error("Please add at least one item");return}const a=Object.fromEntries(new FormData(t.target).entries());a.items=h.map(x=>{const d={...x};return d.vat=(parseFloat(d.vat)||0)/100*(parseFloat(d.price)||0)*(parseFloat(d.qty)||0),delete d.static,d}),Object.keys(I).forEach(x=>a[x]=I[x]),a.invoiceTotal+=Number(g),a.discount=Number(g),console.log(a)}function B(t){b([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),u(t.target.value),_(a=>a+1)}const I=h?.reduce((t,a)=>{if(!a)return t;const x=parseFloat(a.qty)||0,d=(parseFloat(a.vat)||0)/100,V=parseFloat(a.price)||0;return t.totalExcludingVat+=V*x,t.vatTotal+=V*d*x,t.creditNoteTotal+=parseFloat(a.total)||0,t},{totalExcludingVat:0,vatTotal:0,creditNoteTotal:0});function L(t){let a=parseFloat(t.target.value)||0;a>0?O.error("Discount should be input as a negative value"):N(a)}function U(t){const a={address:t.address,phone:t.mobile,email:t.email,vat_no:t.VAT_number,tin:t.tin_number};m(a)}return{key:S,show:p,items:h,totals:I,discount:g,currency:f,isLoading:r,salesItems:i,taxConfigs:w,creditNoteData:j,addRow:F,setItems:b,onSubmit:E,removeRow:T,handleShow:v,handleClose:A,setDiscount:N,changeCurrency:B,handleDiscount:L,handleUserSelected:U}}function H({creditNote:n,triggerClassname:j,triggerChildren:m}){const{key:r,show:o,items:p,totals:c,discount:f,currency:u,isLoading:i,salesItems:y,taxConfigs:w,creditNoteData:s,addRow:S,setItems:_,onSubmit:g,removeRow:N,handleShow:h,handleClose:b,changeCurrency:C,handleDiscount:D,handleUserSelected:F}=Q(n);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:j||"btn btn-info text-white",onClick:h,children:m||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(M,{size:"xl",show:o,handleClose:b,title:"Credit Note",children:e.jsxs("form",{className:"py-3",onSubmit:g,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!s?.document_number,defaultValue:s?.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center justify-content-between",children:[e.jsx("label",{htmlFor:"credit_to",className:"form-label",children:"Credit To:"}),s?.credit_to?e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"customer_id",id:"customer_id",readOnly:!0,value:s?.credit_to}):e.jsx(z,{onChange:F})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:s?.address,readOnly:!!s?.address})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:s?.phone,readOnly:!!s?.phone})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:s?.email,readOnly:!!s?.email})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:s?.vat_no,readOnly:!!s?.vat_no})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:s?.tin,readOnly:!!s?.tin})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().getFullYear(),new Date().getMonth()-1,new Date().getDate()>27?27:new Date().getDate()).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!s})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:u,name:"invoice_currency",id:"invoice_currency",onChange:C,children:s?.currency?e.jsx("option",{value:s.currency,children:s.currency}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"United States Dollar (USD)"}),e.jsx("option",{value:"ZIG",children:"Zimbabwean Dollar (ZIG)"})]})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Price (Vat Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Vat Inc)"})]})]}),e.jsx("tbody",{children:p.map((T,v)=>e.jsx(J,{item:T,index:v,itemName:"credit note",currency:u,setItems:_,removeRow:N,isLoading:i,salesItems:y,taxConfigs:w,itemsLength:p.length},v+"-"+r))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:i,type:"button",className:"btn btn-sm btn-outline-info",onClick:S,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:c.totalExcludingVat.toFixed(2)})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:f,max:0,step:.001,onChange:D,readOnly:i})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:c.vatTotal.toFixed(2)})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Credit Note Total ",u]}),e.jsx("td",{children:(c.creditNoteTotal+f).toFixed(2)})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:i,className:"btn btn-info text-white",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function W(){const{loading:n,creditNotes:j,handleFilters:m}=K();return e.jsxs("div",{children:[e.jsx("h5",{className:"mb-4 bg-danger text-center p-2 rounded-2 text-white",children:"Credit Note"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:m,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((r,o)=>e.jsx("option",{value:new Date().getFullYear()-o,children:new Date().getFullYear()-o},o))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(Y,{placeholder:"Search...",searchBy:"q"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Credit Note List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(H,{triggerClassname:"btn btn-danger"})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-danger shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Cr Note. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Amount"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):j?.length?j?.map((r,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:r.id}),e.jsx("td",{className:"ps-3",children:r.date_created&&k(r.date_created)}),e.jsx("td",{className:"ps-3",children:r.customer}),e.jsx("td",{className:"ps-3",children:r.currency}),e.jsx("td",{className:"ps-3 text-end",children:r.amount.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-danger",children:"View"})})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}W.layout=n=>e.jsx(Z,{children:n,title:"Credit Note"});export{W as default};
