var J=Object.defineProperty,Z=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var U=(s,n,l)=>n in s?J(s,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[n]=l,q=(s,n)=>{for(var l in n||(n={}))K.call(n,l)&&U(s,l,n[l]);if(D)for(var l of D(n))Q.call(n,l)&&U(s,l,n[l]);return s},k=(s,n)=>Z(s,H(n));import{r as o,b as $,_ as M,j as e,u as X,d as W}from"./main-8b5daa16.js";import{f as z}from"./index-fedd7536.js";import{b as ee,C as G,L as te}from"./Layout-1500afa4.js";import{S as se}from"./SearchBar-cc840f4a.js";import"./formatting-9de8c923.js";import"./lodash-a1556254.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-e2b727fe.js";import"./Modal-e9148396.js";import"./index-aaac8bfd.js";import"./MultipleUpload-b8fc9f1f.js";import"./search-1d0357fd.js";import"./index-66c3a614.js";function ne(){const[s,n]=o.useState([]),[l,i]=o.useState(!1);function m(){i(!0),n([]),i(!1)}return o.useEffect(()=>{m()},[]),{loading:l,invoiceList:s}}function le(s,n){const[l,i]=o.useState(null),[m,I]=o.useState(!1),[g,j]=o.useState(!1),[N,b]=o.useState("USD"),[h,F]=o.useState([]),[T,t]=o.useState([]),[A,O]=o.useState(0),[v,V]=o.useState(0),[x,y]=o.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);o.useEffect(()=>{if(s){const c=k(q({},s),{document_number:13652,bill_to:"ASSETSAFE",address:"2 Clip Road, Deven",phone:"+2637856123",email:"assetsafe@gmail.com",vat_no:"124523",tin:"65895",currency:"USD",monthly_rental:{static:!0,sales_code:"REN001",sales_item:"Rent - Mar25",price:500,qty:1,vat_id:"",total:500}});i(c),b(c.currency),y([c.monthly_rental])}},[s]);function R(){$.get("/accounting/items/").then(c=>{F(c.data)}).catch(c=>{console.log(c)})}function E(){$.get("/accounting/vat-settings/").then(c=>{t(c.data)}).catch(c=>{console.error(c)})}o.useEffect(()=>{R(),E()},[]);function r(){y([...x,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function a(c){const d=x.filter((_,f)=>f!==c);y(d)}function p(){j(!0)}function P(){j(!1)}function C(c){if(c.preventDefault(),!x.length){M.error("Please add at least one item");return}const d=Object.fromEntries(new FormData(c.target).entries());d.items=x.map(_=>{const f=q({},_);return f.vat=(parseFloat(f.vat)||0)/100*(parseFloat(f.price)||0)*(parseFloat(f.qty)||0),delete f.static,f}),Object.keys(u).forEach(_=>d[_]=u[_]),d.invoiceTotal+=Number(v),d.discount=Number(v),n?console.log("Proforma Invoice Data: ",d):console.log(d)}function w(c){y([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),b(c.target.value),O(d=>d+1)}const u=x==null?void 0:x.reduce((c,d)=>{if(!d)return c;const _=parseFloat(d.qty)||0,f=(parseFloat(d.vat)||0)/100,B=parseFloat(d.price)||0;return c.totalExcludingVat+=B*_,c.vatTotal+=B*f*_,c.invoiceTotal+=parseFloat(d.total)||0,c},{totalExcludingVat:0,vatTotal:0,invoiceTotal:0});function S(c){let d=parseFloat(c.target.value)||0;d>0?M.error("Discount should be input as a negative value"):V(d)}return{key:A,show:g,items:x,totals:u,discount:v,currency:N,isLoading:m,salesCodes:h,taxConfigs:T,invoiceData:l,addRow:r,setItems:y,onSubmit:C,removeRow:a,handleShow:p,handleClose:P,setDiscount:V,changeCurrency:w,handleDiscount:S}}function re(){const[s,n]=o.useState("INDIVIDUAL");return e.jsxs("div",{className:"d-flex",children:[e.jsxs("select",{className:"me-1 px-1 border fw-light rounded-2",value:s,name:"customer_type",id:"customer_type",onChange:l=>n(l.target.value),children:[e.jsx("option",{value:"INDIVIDUAL",children:"Individual"}),e.jsx("option",{value:"COMPANY",children:"Company"})]}),e.jsx("div",{className:"custom-w-3",children:e.jsx(ee,{extraProps:{placeholder:"Customer Name...",required:!0,id:"bill_to",name:"bill_to",className:"w-100"},defaultValue:null,isDisabled:s==="",useAlternateFetchOptions:{type:s.toLowerCase()}},s)})]})}function ae({item:s,index:n,setItems:l,currency:i,isLoading:m,removeRow:I,salesCodes:g,itemsLength:j,taxConfigs:N}){const[b,h]=o.useState(null),[F,T]=o.useState(null),[t,A]=o.useState(null),[O,v]=o.useState(!1),[V,x]=o.useState(1);function y(r){const a=g.find(u=>u.item_id===r.target.value);if(a.unit_price_currency!==i){v(!0),T(a);return}const p=N.find(u=>u.id===a.tax_configuration),C=((p==null?void 0:p.rate)||0)/100*((a==null?void 0:a.price)||0)*(s.qty||0),w=((a==null?void 0:a.price)||0)*(s.qty||0)+C;l(u=>u.map((S,c)=>c===n?k(q({},S),{sales_code:(a==null?void 0:a.item_id)||"",sales_item:(a==null?void 0:a.name)||"",price:(a==null?void 0:a.price)||"",vat:(p==null?void 0:p.rate)||0,total:w}):S)),h(a),A(p)}function R(){const r=q({},F);r.price=parseFloat(V)*(parseFloat(r.price)||0),r.unit_price_currency=i;const a=N.find(w=>w.id===r.tax_configuration),P=((a==null?void 0:a.rate)||0)/100*((r==null?void 0:r.price)||0)*(s.qty||0),C=((r==null?void 0:r.price)||0)*(s.qty||0)+P;l(w=>w.map((u,S)=>S===n?k(q({},u),{sales_code:(r==null?void 0:r.item_id)||"",sales_item:(r==null?void 0:r.name)||"",price:(r==null?void 0:r.price)||"",vat:(a==null?void 0:a.rate)||0,total:C}):u)),h(r),A(a),T(null),v(!1),x(1)}const E=t!=null&&t.rate?`${((t==null?void 0:t.rate)||0)/100*((b==null?void 0:b.price)||0)*parseFloat(s.qty||0)} (${t.rate}%)`:"";return e.jsxs(e.Fragment,{children:[O&&e.jsx(G,{title:"Currency Mismatch",show:O,handleClose:()=>{v(!1),T(null),x(1)},size:"md",children:e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-danger",children:["The item you have selected is listed in ",F.unit_price_currency," but your invoice is to be in ",i,", please input below the rate to be used"]}),e.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[e.jsx("label",{className:"form-label text-nowrap px-3",children:`${F.unit_price_currency} to ${i}`}),e.jsx("input",{type:"number",className:"form-control",value:V,onChange:r=>x(r.target.value)})]}),e.jsx("div",{className:"mt-3 text-end",children:e.jsx("button",{onClick:R,type:"button",className:"btn btn-info text-white",children:"Proceed"})})]})}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{disabled:s.static||m||j===1,type:"button",onClick:()=>I(n),className:"btn btn-danger btn-sm p-1",children:e.jsx("i",{className:"material-icons",children:"close"})})}),e.jsx("td",{children:s.static?s.sales_code:e.jsxs("select",{required:!0,disabled:m,value:s.sales_code,onChange:y,className:"form-select custom-w-2",children:[e.jsx("option",{disabled:!0,value:"",children:"Select code.."}),g.map(r=>e.jsx("option",{value:r.item_id,children:`${r.item_id} - ${r.name}`},r.id))]})}),e.jsx("td",{children:e.jsx("div",{className:"text-center custom-mn-w-1 custom-mx-w-2",children:s.sales_item})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:` ${s.price||""}`})}),e.jsx("td",{children:s.static?s.qty:e.jsx("input",{type:"number",className:"form-control custom-w-1",disabled:m,value:s.qty,required:!0,onChange:r=>l(a=>a.map((p,P)=>{if(P===n){const C=parseFloat(r.target.value)||0,u=(parseFloat(s.price)||0)*C,S=u*s.vat/100;return k(q({},p),{qty:r.target.value,total:u+S})}else return p}))})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:E})}),e.jsx("td",{children:e.jsx("div",{className:"text-center text-nowrap custom-mn-w-1",children:s.total})})]})]})}function L({invoice:s,triggerClassname:n,triggerChildren:l,isProforma:i}){const{key:m,show:I,items:g,totals:j,discount:N,currency:b,isLoading:h,salesCodes:F,taxConfigs:T,invoiceData:t,addRow:A,setItems:O,onSubmit:v,removeRow:V,handleShow:x,handleClose:y,changeCurrency:R,handleDiscount:E}=le(s,i);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:n||"btn btn-info text-white",onClick:x,children:l||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(G,{size:"xl",show:I,handleClose:y,title:i?"PROFORMA":"FISCAL TAX INVOICE",children:e.jsxs("form",{className:"p-3",onSubmit:v,children:[e.jsxs("div",{className:"p-4 mb-4",children:[e.jsxs("div",{className:"pb-5",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!(t!=null&&t.document_number),defaultValue:t==null?void 0:t.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),t!=null&&t.bill_to?e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",name:"bill_to",id:"bill_to",readOnly:!0,value:t==null?void 0:t.bill_to}):e.jsx(re,{})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:t==null?void 0:t.address,readOnly:!!(t!=null&&t.address)})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:t==null?void 0:t.phone,readOnly:!!(t!=null&&t.phone)})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:t==null?void 0:t.email,readOnly:!!(t!=null&&t.email)})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:t==null?void 0:t.vat_no,readOnly:!!(t!=null&&t.vat_no)})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:t==null?void 0:t.tin,readOnly:!!(t!=null&&t.tin)})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control border-0 border-bottom flex-fill border-3 custom-mx-w-4",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().setDate(1)).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!t})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:b,name:"invoice_currency",id:"invoice_currency",onChange:R,children:t!=null&&t.currency?e.jsx("option",{value:t.currency,children:t.currency}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"United States Dollar (USD)"}),e.jsx("option",{value:"ZIG",children:"Zimbabwean Dollar (ZIG)"})]})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Price(Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Inc)"})]})]}),e.jsx("tbody",{children:g.map((r,a)=>e.jsx(ae,{item:r,index:a,currency:b,setItems:O,removeRow:V,isLoading:h,salesCodes:F,taxConfigs:T,itemsLength:g.length},a+"-"+m))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:h,type:"button",className:"btn btn-outline-info",onClick:A,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:j.totalExcludingVat})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:N,max:0,step:.001,onChange:E,readOnly:h})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:j.vatTotal})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Invoice Total ",b]}),e.jsx("td",{children:j.invoiceTotal+N})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:h,className:"btn btn-info text-white",children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function ce(){const{loading:s,invoiceList:n}=ne();return e.jsx("div",{children:e.jsx("div",{children:e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsxs("thead",{className:"position-sticky c-table-top shadow-sm c-z-5",children:[e.jsx("tr",{children:e.jsx("th",{colSpan:6,className:"p-0",children:e.jsx("div",{className:" bg-danger text-white text-center p-2",children:"Recurring Invoices"})})}),e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Invoice Date"}),e.jsx("th",{children:"Customer Acc"}),e.jsx("th",{children:"Customer Name"}),e.jsx("th",{}),e.jsx("th",{})]})]}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):n!=null&&n.length?n==null?void 0:n.map((l,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:l.id}),e.jsx("td",{className:"ps-3",children:l.date_created&&z(l.date_created)}),e.jsx("td",{className:"ps-3",children:l.customer_acc||""}),e.jsx("td",{className:"ps-3",children:l.customer}),e.jsx("td",{className:"p-0 ",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx(L,{invoice:l,triggerChildren:"Generate",triggerClassname:"btn btn-sm w-100  justify-content-center btn-danger"})})}),e.jsx("td",{className:"p-0",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-dark text-white",children:e.jsx("span",{children:"-"})})})})]},i)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})})})}function ie(){const[s,n]=o.useState([]),[l,i]=o.useState(!1),{url:m}=X();function I(){i(!0),n([]),i(!1)}o.useEffect(()=>{I()},[m]);function g(j){j.preventDefault();const N=j.target.year.value,b=j.target.month.value,h=new URL(m);h.searchParams.set("year",N),h.searchParams.set("month",b),W.Inertia.replace(h.href,{preserveState:!0})}return{loading:l,invoiceList:s,handleFilters:g}}function oe(){const{loading:s,invoiceList:n,handleFilters:l}=ie();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:l,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((i,m)=>e.jsx("option",{value:new Date().getFullYear()-m,children:new Date().getFullYear()-m},m))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(se,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(L,{})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):n!=null&&n.length?n==null?void 0:n.map((i,m)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:i.id}),e.jsx("td",{className:"ps-3",children:i.date_created&&z(i.date_created)}),e.jsx("td",{className:"ps-3",children:i.customer}),e.jsx("td",{className:"ps-3",children:i.currency}),e.jsx("td",{className:"ps-3 text-end",children:i.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},m)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}const Y=[{key:"Invoice",content:e.jsx(oe,{})},{key:"Recurring",content:e.jsx(ce,{})}];function de(){const[s,n]=o.useState(Y[0]);return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 mb-3",children:[Y.map(l=>e.jsx("button",{onClick:()=>n(l),className:`btn ${s===l?"btn-info text-white":"border border-2"}`,children:l.key},l.key)),e.jsx(L,{isProforma:!0,triggerChildren:"Proforma",triggerClassname:"btn border border-2"})]}),e.jsx("div",{className:"p-3",children:s.content})]})}de.layout=s=>e.jsx(te,{children:s,title:"Sales Categories"});export{de as default};
