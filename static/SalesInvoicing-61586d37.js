import{r as o,u as E,b as S,d as P,_ as w,j as e}from"./media/main-9b13349a.js";import{u as A,f as D}from"./index-128beda7.js";import{S as B}from"./SearchBar-d38362a1.js";import{C as G,I as Z,L as $}from"./Layout-4dbbc259.js";import{U as K}from"./UserSelector-63867e28.js";import"./formatting-fad57ba1.js";import"./lodash-c68d99f1.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-076133b3.js";import"./Modal-dae17af9.js";import"./index-548a2c78.js";import"./MultipleUpload-62b8fca2.js";import"./search-a9081f74.js";function Q(){const[s,r]=o.useState([]),[d,t]=o.useState(!1),{url:a}=E();function h(){t(!0),S.get("/accounting/proforma-invoices/").then(l=>{console.log(l),r(l.data)}).catch(l=>{console.log(l)}).finally(()=>t(!1))}o.useEffect(()=>{h()},[a]);function p(l){l.preventDefault();const b=l.target.year.value,j=l.target.month.value,u=new URL(a);u.searchParams.set("year",b),u.searchParams.set("month",j),P.Inertia.replace(u.href,{preserveState:!0})}return{loading:d,invoiceList:s,handleFilters:p}}function X(s,r){const[d,t]=o.useState(null),[a,h]=o.useState(!1),[p,l]=o.useState(!1),[b,j]=o.useState("USD"),[u,F]=o.useState([]),[C,c]=o.useState([]),[T,_]=o.useState(0),[v,N]=o.useState(0),[f,g]=o.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);o.useEffect(()=>{if(s){const n={document_number:s.document_number,bill_to:s.bill_to,address:s.address,phone:s.phone,email:s.email,vat_no:s.vat_no,tin:s.tin,currency:s.currency,monthly_rental:s.monthly_rental};t(n),j(n.currency),g([n.monthly_rental])}},[s]),o.useEffect(()=>{L(),V()},[]);function L(){S.get("/accounting/items/").then(n=>{F(n.data)}).catch(n=>{console.log(n)})}function V(){S.get("/accounting/vat-settings/").then(n=>{c(n.data)}).catch(n=>{console.error(n)})}function O(){g([...f,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function I(n){const i=f.filter((y,m)=>m!==n);g(i)}function U(){l(!0)}function M(){l(!1)}function Y(n){if(n.preventDefault(),!f.length){w.error("Please add at least one item");return}const i=Object.fromEntries(new FormData(n.target).entries());i.items=f.map(m=>{const x={...m};return x.vat=(parseFloat(x.vat)||0)/100*(parseFloat(x.price)||0)*(parseFloat(x.qty)||0),delete x.static,x}),Object.keys(q).forEach(m=>i[m]=q[m]),i.invoiceTotal+=Number(v),i.discount=Number(v),r?console.log("Proforma Invoice Data: ",i):console.log(i);const y=r?"/accounting/proforma-invoices/":"/accounting/invoices/";S.post(y,i).then(m=>{console.log(m),m.status===201?(w.success(A(m)),g([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),N(0),_(x=>x+1)):w.error(A(m))}).catch(m=>{console.error(m),w.error(A(m))})}function J(n){g([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),j(n.target.value),_(i=>i+1)}const q=f?.reduce((n,i)=>{if(!i)return n;const y=parseFloat(i.qty)||0,m=(parseFloat(i.vat)||0)/100,x=parseFloat(i.price)||0;return n.totalExcludingVat+=x*y,n.vatTotal+=x*m*y,n.invoiceTotal+=parseFloat(i.total)||0,n},{totalExcludingVat:0,vatTotal:0,invoiceTotal:0});function z(n){let i=parseFloat(n.target.value)||0;i>0?w.error("Discount should be input as a negative value"):N(i)}return{key:T,show:p,items:f,totals:q,discount:v,currency:b,isLoading:a,salesCodes:u,taxConfigs:C,invoiceData:d,addRow:O,setItems:g,onSubmit:Y,removeRow:I,handleShow:U,handleClose:M,setDiscount:N,changeCurrency:J,handleDiscount:z}}function R({invoice:s,triggerClassname:r,triggerChildren:d,isProforma:t}){const{key:a,show:h,items:p,totals:l,discount:b,currency:j,isLoading:u,salesCodes:F,taxConfigs:C,invoiceData:c,addRow:T,setItems:_,onSubmit:v,removeRow:N,handleShow:f,handleClose:g,changeCurrency:L,handleDiscount:V}=X(s,t);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:r||"btn btn-info text-white",onClick:f,children:d||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(G,{size:"xl",show:h,handleClose:g,title:t?"PROFORMA":"FISCAL TAX INVOICE",children:e.jsxs("form",{className:"py-3",onSubmit:v,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!c?.document_number,defaultValue:c?.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center justify-content-between",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),c?.bill_to?e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"customer_id",id:"customer_id",readOnly:!0,value:c?.bill_to}):e.jsx(K,{})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:c?.address,readOnly:!!c?.address})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:c?.phone,readOnly:!!c?.phone})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:c?.email,readOnly:!!c?.email})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:c?.vat_no,readOnly:!!c?.vat_no})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:c?.tin,readOnly:!!c?.tin})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().setDate(1)).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!c})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:j,name:"invoice_currency",id:"invoice_currency",onChange:L,children:c?.currency?e.jsx("option",{value:c.currency,children:c.currency}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"United States Dollar (USD)"}),e.jsx("option",{value:"ZIG",children:"Zimbabwean Dollar (ZIG)"})]})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Price(Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Inc)"})]})]}),e.jsx("tbody",{children:p.map((O,I)=>e.jsx(Z,{item:O,index:I,currency:j,setItems:_,removeRow:N,isLoading:u,salesCodes:F,taxConfigs:C,itemsLength:p.length},I+"-"+a))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:u,type:"button",className:"btn btn-sm btn-outline-info",onClick:T,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:l.totalExcludingVat})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:b,max:0,step:.001,onChange:V,readOnly:u})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:l.vatTotal})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Invoice Total ",j]}),e.jsx("td",{children:l.invoiceTotal+b})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:u,className:"btn btn-info text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function H(){const{loading:s,invoiceList:r,handleFilters:d}=Q();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:d,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((t,a)=>e.jsx("option",{value:new Date().getFullYear()-a,children:new Date().getFullYear()-a},a))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(B,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Proforma Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(R,{isProforma:!0})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):r?.length?r?.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"ps-3",children:t.currency}),e.jsx("td",{className:"ps-3 text-end",children:t.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}function W(s){const[r,d]=o.useState(!1),[t,a]=o.useState(s?.map(h=>({id:h.id,date_created:D(new Date),customer_acc:"",customer:h.tenant_name,document_number:"",bill_to:h.tenant_name,address:h.address,phone:"",email:"",vat_no:"",tin:"",currency:h.lease_currency_type,monthly_rental:{static:!0,sales_code:"",sales_item:`"Rent - ${h.payment_period_start} ${new Date().getMonth()+1}`,price:h.owing_amount,qty:1,vat_id:"",total:h.owing_amount}})));return{loading:r,invoiceList:t}}function ee({recurringInvoices:s}){const{loading:r,invoiceList:d}=W(s);return e.jsx("div",{children:e.jsx("div",{children:e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsxs("thead",{className:"position-sticky c-table-top shadow-sm bg-white c-z-5",children:[e.jsx("tr",{children:e.jsx("th",{colSpan:6,className:"p-0",children:e.jsx("div",{className:" bg-danger text-white text-center p-2",children:"Recurring Invoices"})})}),e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Invoice Date"}),e.jsx("th",{children:"Customer Acc"}),e.jsx("th",{children:"Customer Name"}),e.jsx("th",{}),e.jsx("th",{})]})]}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):d?.length?d?.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer_acc||""}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"p-0 ",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx(R,{invoice:t,triggerChildren:"Generate",triggerClassname:"btn btn-sm w-100  justify-content-center btn-danger"})})}),e.jsx("td",{className:"p-0",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-dark text-white",children:e.jsx("span",{children:"-"})})})})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})})})}function te(){const[s,r]=o.useState([]),[d,t]=o.useState(!1),{url:a}=E();function h(){t(!0),S.get("/accounting/invoices/").then(l=>{console.log(l),r(l.data),t(!1)}).catch(l=>{console.log(l),t(!1)})}o.useEffect(()=>{h()},[a]);function p(l){l.preventDefault();const b=l.target.year.value,j=l.target.month.value,u=new URL(a);u.searchParams.set("year",b),u.searchParams.set("month",j),P.Inertia.replace(u.href,{preserveState:!0})}return{loading:d,invoiceList:s,handleFilters:p}}function se(){const{loading:s,invoiceList:r,handleFilters:d}=te();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:d,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((t,a)=>e.jsx("option",{value:new Date().getFullYear()-a,children:new Date().getFullYear()-a},a))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(B,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(R,{})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):r?.length?r?.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"ps-3",children:t.currency}),e.jsx("td",{className:"ps-3 text-end",children:t.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}const k=[{key:"Invoice",Content:se},{key:"Recurring",Content:ee},{key:"Proforma",Content:H}];function ne({invoice_list:s}){const[r,d]=o.useState(k[0]);return e.jsxs("div",{children:[e.jsx("div",{className:"d-flex gap-2 mb-3",children:k.map(t=>e.jsx("button",{onClick:()=>d(t),className:`btn ${r===t?"btn-info text-white":"border border-2"}`,children:t.key},t.key))}),e.jsx("div",{className:"p-3",children:e.jsx(r.Content,{...r.key==="Recurring"?{recurringInvoices:s}:{}})})]})}ne.layout=s=>e.jsx($,{children:s,title:"Sales Categories"});export{ne as default};
