import{j as e,r as x,b as y,d as N}from"./main-5b40e739.js";import{S as D,P as C}from"./PaginationControls-5a0bd18c.js";import{L as v}from"./Layout-e3187c6c.js";import{f as p}from"./formatting-345d2430.js";import{A as S,D as V,C as T,a as P,F as O,P as A}from"./Payments-8a953466.js";import{l as I}from"./lodash-7ed354f0.js";import{M as _}from"./Modal-b566b2dd.js";import{A as f}from"./index-18a0ccb1.js";import"./Button-29eb3641.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-ffc5027a.js";import"./index-6f7cd0f9.js";import"./index-ab81bb2e.js";import"./index-c570846a.js";function B({creditorViewProps:{showModal:l,hideCreditorView:u,data:n,error:d,isLoading:c,clientId:s,refreshCreditorViewData:i,lease:r}}){const h=!n;return e.jsx(e.Fragment,{children:e.jsxs(_,{show:l,onHide:u,fullscreen:!0,contentClassName:"custom-bg-whitesmoke",children:[e.jsx(_.Header,{className:"p-0",children:e.jsxs("div",{className:"w-100 p-2 text-center bg-secondary position-relative",children:[e.jsx("h4",{className:"text-white",children:c||d||h?"Creditor View":n.tenantName||"Creditor View"}),e.jsx("button",{type:"button",onClick:u,className:"btn position-absolute top-0 end-0 h-100 d-flex align-items-center text-white",children:e.jsx("i",{className:"material-icons fs-3 px-4",children:"close"})})]})}),e.jsx(_.Body,{children:e.jsxs("div",{className:"position-relative custom-mn-h-5",children:[c&&e.jsxs("div",{className:"text-center position-absolute top-50 start-50 translate-middle",children:[e.jsx("div",{className:"spinner-border text-info spinner-border-md",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{children:"Loading...please wait"})]}),d&&e.jsxs("div",{className:"text-center text-danger position-absolute top-50 start-50 translate-middle",children:[e.jsx("p",{children:e.jsx("i",{className:"material-icons fs-1",children:"warning"})}),e.jsxs("p",{children:["Error: ",I.truncate(d,{length:500})]})]}),!(c||d||h)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row row-cols-3 align-items-stretch",children:[e.jsxs("div",{className:"col p-1",children:[e.jsx(S,{isCreditorView:!0,data:n.agedAnalysis}),e.jsx(V,{isCreditorView:!0,data:n.debtorIntelligence,clientId:s}),e.jsx(T,{isCreditorView:!0,data:n.contactDetails,clientId:s})]}),e.jsx("div",{className:"col p-1",children:e.jsx(P,{isCreditorView:!0,messages:n.communicationHistory,clientId:s,lease:r})}),e.jsxs("div",{className:"col p-1",children:[e.jsx(O,{isCreditorView:!0,data:n.forecastInflows}),e.jsx(A,{isCreditorView:!0,clientId:s,paymentPlans:n.paymentPlans,refreshCreditorViewData:i})]})]})})]})})]})})}function E(){const[l,u]=x.useState(!1),[n,d]=x.useState(null),[c,s]=x.useState(""),[i,r]=x.useState(!1),[h,b]=x.useState(null);function j(t){b(t),u(!0),r(!0),s(""),y(reverseUrl("client_details"),{params:{lease_id:t.lease_id}}).then(a=>{const o={isCreditorView:!0,tenantName:t.creditor_name,agedAnalysis:{oneTwentyDays:a.data.aged_analysis["120_days_plus"],ninetyDays:a.data.aged_analysis["90_days"],sixtyDays:a.data.aged_analysis["60_days"],thirtyDays:a.data.aged_analysis["30_days"],current:a.data.aged_analysis.current},contactDetails:{contactPerson:`${a.data.client.firstname} ${a.data.client.surname}`,smsNumber:a.data.client.sms_number,otherNumbers:a.data.other_numbers?a.data.client.other_numbers.join(", "):"",emailAddress:a.data.client.email,address:a.data.client.address},paymentPlans:a.data.payment_plans.map(m=>({id:m.id,person:m.spoke_with,date:m.expected_pay_date,amount:m.amount})),communicationHistory:a.data.communication_history.map(m=>({text:m.message,timestamp:m.created_at,user:m.user_name,actionDone:m.action_done?m.action_done:null,communicationType:m.type})),debtorIntelligence:Object.values(a.data.debtor_intelligence).length&&Object.values(a.data.debtor_intelligence).every(Boolean)?{text:a.data.debtor_intelligence.note,timestamp:a.data.debtor_intelligence.updated_at,user:a.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:a.data.forecast_inflows["0-7"],eightToFourteenDays:a.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:a.data.forecast_inflows["14-21"],twentyOnePlusDays:a.data.forecast_inflows["21+"],total:a.data.forecast_inflows.total}};console.log({res:a,resData:o}),d(o),s(""),r(!1)}).catch(a=>{a instanceof f?s(a.response.status===500?`Error: ${a.response.statusText}`:JSON.stringify(a.response.data)):s(a),d(null),r(!1)})}function g(){console.log("refreshing.."),r(!0),s(""),y(reverseUrl("client_details"),{params:{lease_id:h.lease_id}}).then(t=>{const a={isCreditorView:!0,tenantName:h.creditor_name,agedAnalysis:{oneTwentyDays:t.data.aged_analysis["120_days_plus"],ninetyDays:t.data.aged_analysis["90_days"],sixtyDays:t.data.aged_analysis["60_days"],thirtyDays:t.data.aged_analysis["30_days"],current:t.data.aged_analysis.current},contactDetails:{contactPerson:`${t.data.client.firstname} ${t.data.client.surname}`,smsNumber:t.data.client.sms_number,otherNumbers:t.data.other_numbers?t.data.client.other_numbers.join(", "):"",emailAddress:t.data.client.email,address:t.data.client.address},paymentPlans:t.data.payment_plans.map(o=>({id:o.id,person:o.spoke_with,date:o.expected_pay_date,amount:o.amount})),communicationHistory:t.data.communication_history.map(o=>({text:o.message,timestamp:o.created_at,user:o.user_name,actionDone:o.action_done?o.action_done:null,communicationType:o.type})),debtorIntelligence:Object.values(t.data.debtor_intelligence).length&&Object.values(t.data.debtor_intelligence).every(Boolean)?{text:t.data.debtor_intelligence.note,timestamp:t.data.debtor_intelligence.updated_at,user:t.data.debtor_intelligence.user_name}:null,forecastInflows:{zeroToSevenDays:t.data.forecast_inflows["0-7"],eightToFourteenDays:t.data.forecast_inflows["8-14"],fourteenToTwentyOneDays:t.data.forecast_inflows["14-21"],twentyOnePlusDays:t.data.forecast_inflows["21+"],total:t.data.forecast_inflows.total}};d(a),s(""),r(!1)}).catch(t=>{t instanceof f?s(t.response.status===500?`Error: ${t.response.statusText}`:JSON.stringify(t.response.data)):s(t),d(null),r(!1)})}function w(){u(!1)}return console.log(h),{data:n,error:c,isLoading:i,showModal:l,lease:h,clientId:h?h.creditor_id:null,refreshCreditorViewData:g,openCreditorView:j,hideCreditorView:w}}function $(l,u,n,d){const c=E(),s=l.reduce((i,r)=>i+r.balance_owed,0);return console.log({allState:{creditors:l,current_page:u,total_pages:n,total_items:d,balanceTotal:s}}),{balanceTotal:s,creditorViewProps:c}}function k({creditors:l,current_page:u,total_pages:n,total_items:d}){const{balanceTotal:c,creditorViewProps:s}=$(l,u,n,d);return e.jsxs("div",{children:[e.jsx(B,{creditorViewProps:s}),e.jsx("div",{className:"col-4 pb-3",children:e.jsx(D,{searchBy:"search",placeholder:"Search..."})}),e.jsx("h5",{className:"bg-danger text-center text-white p-2 mb-4 rounded-2",children:"CREDITOR SUMMARY"}),e.jsxs("table",{className:"table table-bordered table-responsive table-sm c-fs-small",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"c-thead-bg rounded-2",children:[e.jsx("th",{children:"Creditor ID"}),e.jsx("td",{children:"Creditor Name "}),e.jsx("td",{className:"text-end",children:"Balance Owed"}),e.jsx("td",{className:"text-end bg-white"})]})}),!!l.length&&e.jsxs(e.Fragment,{children:[e.jsx("tbody",{children:l.map((i,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.creditor_id}),e.jsx("td",{children:e.jsx("button",{type:"button",title:"double click to view creditor",className:"custom-btn text-decoration-underline",onDoubleClick:()=>s.openCreditorView(i),children:i.creditor_name})}),e.jsx("td",{className:"text-end px-3",children:Number(i.balance_owed)>=0?p(Number(i.balance_owed)):`(${p(Number(i.balance_owed)*-1)})`}),e.jsx("td",{className:"bg-info text-center",style:{fontWeight:"500",fontSize:"16px",color:"white",cursor:"pointer"},onClick:()=>N.Inertia.visit(reverseUrl("detailed_creditor_statement",i.creditor_id),{data:{lease_id:i.lease_id}}),children:"View"})]},i.creditor_id+" - "+r))}),e.jsx("tfoot",{className:"fw-bold c-fs-18",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Total"}),e.jsx("td",{}),e.jsx("td",{className:"text-end",children:c>=0?p(c):`(${p(c*-1)})`}),e.jsx("td",{})]})})]})]}),!l.length&&e.jsx("div",{className:"custom-h-4 d-flex justify-content-center align-items-center border border-2",children:"Nothing to show"}),e.jsx("div",{className:"px-3",children:e.jsx(C,{currentPage:u||1,totalPages:n||1})})]})}k.layout=l=>e.jsx(v,{children:l,title:"Creditor Statements"});export{k as default};
