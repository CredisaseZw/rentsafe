var J=Object.defineProperty,W=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var z=(l,n,u)=>n in l?J(l,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[n]=u,p=(l,n)=>{for(var u in n||(n={}))q.call(n,u)&&z(l,u,n[u]);if(E)for(var u of E(n))H.call(n,u)&&z(l,u,n[u]);return l},h=(l,n)=>W(l,$(n));var U=(l,n,u)=>new Promise((w,_)=>{var j=i=>{try{x(u.next(i))}catch(m){_(m)}},b=i=>{try{x(u.throw(i))}catch(m){_(m)}},x=i=>i.done?w(i.value):Promise.resolve(i.value).then(j,b);x((u=u.apply(l,n)).next())});import{r as N,b as K,j as e}from"./main-4a381f5d.js";import{L as P}from"./Layout-b5ad945b.js";import{h as O}from"./moment-686b5dfa.js";import{A as Q}from"./index-b919a5bf.js";import{_ as D,I as V}from"./index-c43108c2.js";import{f as B}from"./formatting-345d2430.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-a5cfacea.js";import"./lodash-d38e7526.js";import"./index-4b8db17e.js";import"./Modal-10c8c26e.js";import"./index-a4b15175.js";function X({tenant_list:l,errors:n,result:u,status:w,message:_}){const[j,b]=N.useState(!1),x=new Date,i=(l==null?void 0:l.filter(a=>a.lease_currency_type.toUpperCase()==="USD"))||[],m=(l==null?void 0:l.filter(a=>a.lease_currency_type.toUpperCase()==="ZWG"))||[],[g,f]=N.useState((i==null?void 0:i.reduce((a,r)=>a+Number(r.owing_amount),0))||0),[s,d]=N.useState((m==null?void 0:m.reduce((a,r)=>a+Number(r.owing_amount),0))||0),[R,Y]=N.useReducer(k,i.map(a=>h(p({},a),{invoice_date:x.toISOString().split("T")[0],edited:!1,total:(a==null?void 0:a.owing_amount)||0,operationalCosts:0,tenant_acc_no:"",invoice_no:""}))),[M,A]=N.useReducer(L,m.map(a=>h(p({},a),{invoice_date:x.toISOString().split("T")[0],edited:!1,total:(a==null?void 0:a.owing_amount)||"",operationalCosts:0,tenant_acc_no:"",invoice_no:""})));function k(a,r){switch(r.type){case"updateBaseRental":let o=a.map(t=>t.id===r.id?h(p({},t),{owing_amount:r.owing_amount,edited:!0,total:Number(t.operationalCosts)+Number(r.owing_amount)}):t);return f(o.reduce((t,c)=>t+Number(c.total),0)),o;case"updateInvDate":let S=a.map(t=>t.id===r.id?h(p({},t),{invoice_date:r.invoice_date,edited:!0}):t);return f(S.reduce((t,c)=>t+Number(c.total),0)),S;case"updateInvNumber":let y=a.map(t=>t.id===r.id?h(p({},t),{invoice_no:r.invoice_no,edited:!0}):t);return f(y.reduce((t,c)=>t+Number(c.total),0)),y;case"updateTenantAccNumber":let C=a.map(t=>t.id===r.id?h(p({},t),{tenant_acc_no:r.tenant_acc_no,edited:!0}):t);return f(C.reduce((t,c)=>t+Number(c.total),0)),C;case"updateOperatingCosts":let I=a.map(t=>t.id===r.id?h(p({},t),{edited:!0,operationalCosts:r.operationalCosts,total:Number(t.owing_amount)+Number(r.operationalCosts)}):t);return f(I.reduce((t,c)=>t+Number(c.total),0)),I;case"filterSubmittedInvoices":let T=a.filter(t=>!r.idsToFilter.includes(t.id));return f(T.reduce((t,c)=>t+Number(c.total),0)),T;default:return a}}function L(a,r){switch(r.type){case"updateBaseRental":let o=a.map(t=>t.id===r.id?h(p({},t),{owing_amount:r.owing_amount,edited:!0,total:Number(t.operationalCosts)+Number(r.owing_amount)}):t);return d(o.reduce((t,c)=>t+Number(c.total),0)),o;case"updateInvDate":let S=a.map(t=>t.id===r.id?h(p({},t),{invoice_date:r.invoice_date,edited:!0}):t);return d(S.reduce((t,c)=>t+Number(c.total),0)),S;case"updateInvNumber":let y=a.map(t=>t.id===r.id?h(p({},t),{invoice_no:r.invoice_no,edited:!0}):t);return d(y.reduce((t,c)=>t+Number(c.total),0)),y;case"updateTenantAccNumber":let C=a.map(t=>t.id===r.id?h(p({},t),{tenant_acc_no:r.tenant_acc_no,edited:!0}):t);return d(C.reduce((t,c)=>t+Number(c.total),0)),C;case"updateOperatingCosts":let I=a.map(t=>t.id===r.id?h(p({},t),{edited:!0,operationalCosts:r.operationalCosts,total:Number(t.owing_amount)+Number(r.operationalCosts)}):t);return d(I.reduce((t,c)=>t+Number(c.total),0)),I;case"filterSubmittedInvoices":let T=a.filter(t=>!r.idsToFilter.includes(t.id));return d(T.reduce((t,c)=>t+Number(c.total),0)),T;default:return a}}function Z(){return U(this,null,function*(){b(!0);const a=[],r=[];if(R.forEach(o=>{o.edited&&(a.push({leaseId:o.id,invoiceDate:o.invoice_date,baseRental:o.owing_amount,operationCosts:o.operationalCosts,invoiceNumber:o.invoice_no,tenantAccNumber:o.tenant_acc_no}),r.push(o.id))}),M.forEach(o=>{o.edited&&(a.push({leaseId:o.id,invoiceDate:o.invoice_date,baseRental:o.owing_amount,operationCosts:o.operationalCosts,invoiceNumber:o.invoice_no,tenantAccNumber:o.tenant_acc_no}),r.push(o.id))}),a.length===0){b(!1),D.error("No changes detected, please fill in at least one invoice",{icon:"❌",duration:5e3});return}try{console.log({data:a}),yield K.post(reverseUrl("client_invoice"),a),Y({type:"filterSubmittedInvoices",idsToFilter:r}),A({type:"filterSubmittedInvoices",idsToFilter:r})}catch(o){console.log(o),o instanceof Q?D.error(`An error occurred! ${o.response.statusText}`):D.error(`An error occurred! ${JSON.stringify(o)}`,{icon:"❌"})}b(!1)})}N.useEffect(()=>{n?(console.log(n),D.error("Error: "+JSON.stringify(n),{duration:5e3,icon:"❌"})):u==="success"&&_&&D.success(_,{duration:5e3,icon:"✔"})},[n,u,_]);const F=O().date()>8&&O().date()<25?O().subtract(1,"months").format("MMMM YYYY"):O().format("MMMM YYYY");console.log({allState:{invoices:l,errors:n,result:u,status:w,message:_,usdBatchTotal:g,zwlBatchTotal:s,usdState:R,zwlState:M,isLoading:j,headerDate:F}});const G=l==null?void 0:l.some(a=>x.getDate()<a.payment_period_start&&x.getDate()>8);return{today:x,pastDue:G,usdBatchTotal:g,zwlBatchTotal:s,usdState:R,zwlState:M,isLoading:j,headerDate:F,usdDispatch:Y,zwlDispatch:A,submitData:Z}}function v(l){const{today:n,pastDue:u,usdBatchTotal:w,zwlBatchTotal:_,usdState:j,zwlState:b,isLoading:x,headerDate:i,usdDispatch:m,zwlDispatch:g,submitData:f}=X(l);return e.jsxs("div",{className:"card card-raised",children:[e.jsx(V,{position:"top-right"}),e.jsxs("div",{className:"h5 m-0 p-3 bg-info text-center text-white",children:["Rental Invoicing - ",i]}),e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("table",{className:"table table-sm table-responsive table-bordered custom-fs-normal",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[u&&e.jsx("th",{}),e.jsx("th",{children:"Inv. Date"}),e.jsx("th",{children:"Tenant Name"}),e.jsx("th",{children:"Tenant Acc. No."}),e.jsx("th",{children:"Inv. No."}),e.jsx("th",{children:"Currency"}),e.jsx("th",{children:"Base Rental"}),e.jsx("th",{children:"Operating Costs"}),e.jsx("th",{children:"Total"})]})}),e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("th",{className:"border-0 py-3",children:"USD"})}),j.map(s=>e.jsxs("tr",{children:[u&&e.jsx("td",{className:"text-center px-0",children:e.jsx("i",{title:"invoice is past payment period",className:"material-icons custom-cursor-pointer custom-icon-small text-danger d-block p-0 m-0",children:"timer"})}),e.jsx("td",{children:e.jsx("input",{type:"date",max:n.toISOString().split("T")[0],min:n.getDate()>=s.payment_period_start?n.toISOString().split("T")[0]:n.getMonth()===0?new Date(n.getFullYear()-1,11,26).toISOString().split("T")[0]:new Date(n.getFullYear(),n.getMonth()-1,26).toISOString().split("T")[0],className:"form-control form-control-sm",value:s.invoice_date,onChange:d=>m({type:"updateInvDate",id:s.id,invoice_date:d.target.value})})}),e.jsx("td",{children:s.tenant_name}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:s.tenant_acc_no,onChange:d=>m({type:"updateTenantAccNumber",id:s.id,tenant_acc_no:d.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:s.invoice_no,onChange:d=>m({type:"updateInvNumber",id:s.id,invoice_no:d.target.value})})}),e.jsx("td",{children:s.lease_currency_type}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:s.owing_amount,onChange:d=>m({type:"updateBaseRental",id:s.id,owing_amount:d.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:s.operationalCosts,onChange:d=>m({type:"updateOperatingCosts",id:s.id,operationalCosts:d.target.value})})}),e.jsx("td",{className:"text-end",children:B(s.total)})]},s.id)),e.jsxs("tr",{className:"text-end fw-bold",children:[e.jsx("td",{colSpan:6}),e.jsx("td",{children:"Batch Total"}),e.jsx("td",{children:B(w)})]}),e.jsx("tr",{children:e.jsx("th",{className:"border-0 py-3",children:"ZWG"})}),b.map(s=>e.jsxs("tr",{children:[u&&e.jsx("td",{title:"invoice is past payment period",className:"text-center px-0",children:e.jsx("i",{className:"material-icons custom-icon-small text-danger d-block p-0 m-0",children:"timer"})}),e.jsx("td",{children:e.jsx("input",{type:"date",max:n.toISOString().split("T")[0],min:n.getDate()>=s.payment_period_start?n.toISOString().split("T")[0]:n.getMonth()===0?new Date(n.getFullYear()-1,11,26).toISOString().split("T")[0]:new Date(n.getFullYear(),n.getMonth()-1,26).toISOString().split("T")[0],className:"form-control form-control-sm",value:s.invoice_date,onChange:d=>g({type:"updateInvDate",id:s.id,invoice_date:d.target.value})})}),e.jsx("td",{children:s.tenant_name}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:s.tenant_acc_no,onChange:d=>g({type:"updateTenantAccNumber",id:s.id,tenant_acc_no:d.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:s.invoice_no,onChange:d=>g({type:"updateInvNumber",id:s.id,invoice_no:d.target.value})})}),e.jsx("td",{children:s.lease_currency_type}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:s.owing_amount,onChange:d=>g({type:"updateBaseRental",id:s.id,owing_amount:d.target.value})})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control form-control-sm",value:s.operationalCosts,onChange:d=>g({type:"updateOperatingCosts",id:s.id,operationalCosts:d.target.value})})}),e.jsx("td",{className:"text-end",children:B(s.total)})]},s.id)),e.jsxs("tr",{className:"text-end fw-bold",children:[e.jsx("td",{colSpan:6}),e.jsx("td",{children:"Batch Total"}),e.jsx("td",{children:B(_)})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{onClick:f,className:"btn btn-info text-white",children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm d-inline-block me-2"}),"processing.."]}):"Submit"})})]})]})}v.layout=l=>e.jsx(P,{children:l,title:"Tenant Invoicing"});export{v as default};
