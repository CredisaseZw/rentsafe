var A=Object.defineProperty,T=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var P=(t,a,n)=>a in t?A(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,k=(t,a)=>{for(var n in a||(a={}))$.call(a,n)&&P(t,n,a[n]);if(D)for(var n of D(a))O.call(a,n)&&P(t,n,a[n]);return t},E=(t,a)=>T(t,C(a));import{j as e,r as x,u as I,b as v}from"./main-d83a2d54.js";import{l as w}from"./lodash-078c39ae.js";import{c as S,f as F}from"./index-ab81bb2e.js";import{A as _,W as L}from"./Layout-577747f1.js";function g({title:t,children:a,noBoundary:n,noOuterStyles:s}){const m=s?"":n?"bg-white mb-3":"bg-white rounded-2 border overflow-hidden border-dark shadow-sm mb-3";return e.jsxs("div",{className:m,children:[e.jsx("div",{className:"rounded-top-2 custom-bg-grey text-white text-center p-1",children:w.capitalize(t)}),a]})}function Q({data:t,isCreditorView:a}){let n=0;return Object.keys(t).forEach(s=>n+=t[s]),e.jsx(g,{title:a?"ageing":"aged analysis",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"90+ Days"}),e.jsx("th",{children:"90 Days"}),e.jsx("th",{children:"60 Days"}),e.jsx("th",{children:"30 Days"}),e.jsx("th",{children:"Current"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:t.oneTwentyDays}),e.jsx("td",{children:t.ninetyDays}),e.jsx("td",{children:t.sixtyDays}),e.jsx("td",{children:t.thirtyDays}),e.jsx("td",{children:t.current}),e.jsxs("td",{children:["$",n]})]})})]})})}function M(t,a,n){const[s,m]=x.useState(!t),[h,c]=x.useState(t),[d,o]=x.useState(""),[r,u]=x.useState(!1),{Auth:b}=I().props,p=`${b.user_profile.first_name} ${b.user_profile.last_name}`;function l(i){i.preventDefault(),u(!0),o("");const y=Object.fromEntries(new FormData(i.target).entries());n?y.creditor_id=a.toString():y.client_id=a.toString(),v.put(reverseUrl("debtor_intelligence"),y).then(j=>{const N={text:j.data.note,user:j.data.user_name,timestamp:j.data.updated_at||j.data.created_at};c(N),o(""),u(!1),m(!1)}).catch(j=>{j instanceof _?o(j.response.status===500?`Error: ${j.response.statusText}`:JSON.stringify(j.response.data)):o(j),u(!1),m(!h)})}return{data:h,isEditMode:s,handleSave:l,loggedInUser:p,setIsEditMode:m,error:d,setError:o,isLoading:r}}function X({data:t,clientId:a,isCreditorView:n}){const{data:s,isEditMode:m,handleSave:h,loggedInUser:c,setIsEditMode:d,error:o,setError:r,isLoading:u}=M(t,a,n);return e.jsx(g,{title:n?"creditor intelligence":"customer intelligence",children:e.jsxs("div",{className:"px-3 py-2",children:[o&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>r(""),className:"btn-close btn-sm"}),w.truncate(o,{length:150})]}),m?e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"note",className:"form-label",children:s&&s.text?"Edit note":"No note found, create new note"}),e.jsx("textarea",{className:"form-control",name:"note",id:"note",rows:"2",defaultValue:s&&s.text?s.text:"",placeholder:"type here...",disabled:u})]}),e.jsx("b",{className:"d-block my-1",children:c}),e.jsx("div",{className:"small text-success",children:"today"}),e.jsx("button",{disabled:u,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:u?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsx("small",{children:s.text}),e.jsx("b",{className:"d-block my-1",children:s.user}),e.jsx("div",{className:"small text-success",children:S(s.timestamp)}),e.jsx("button",{onClick:()=>d(!0),type:"button",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Edit"})]})]})})}function U(t,a,n){const[s,m]=x.useState(!t),[h,c]=x.useState(t),[d,o]=x.useState(""),[r,u]=x.useState(!1);function b(p){p.preventDefault(),u(!0),o("");const l=Object.fromEntries(new FormData(p.target).entries());n?l.creditor_id=a.toString():l.client_id=a.toString(),l.other_numbers=l.other_numbers.split(",").filter(Boolean).map(i=>i.trim()),v.put(reverseUrl("update_client_contact_details"),l).then(i=>{const y={contactPerson:`${i.data.firstname} ${i.data.surname}`,smsNumber:i.data.sms_number,otherNumbers:i.data.other_numbers?i.data.other_numbers.join(", "):"",emailAddress:i.data.email_address,address:i.data.address};c(y),o(""),u(!1),m(!1)}).catch(i=>{i instanceof _?o(i.response.status===500?`Error: ${i.response.statusText}`:JSON.stringify(i.response.data)):o(i),u(!1),m(!h)})}return{data:h,isEditMode:s,handleSave:b,setIsEditMode:m,error:d,setError:o,isLoading:r}}function Y({data:t,clientId:a,isCreditorView:n}){const{data:s,isEditMode:m,handleSave:h,setIsEditMode:c,error:d,setError:o,isLoading:r}=U(t,a,n);return e.jsx(g,{title:"contact details",children:e.jsxs("div",{className:"py-2",children:[d&&e.jsxs("p",{className:"d-flex align-items-start px-2 gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>o(""),className:"btn-close btn-sm"}),w.truncate(d,{length:150})]}),m?e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"firstname",className:"form-label small",children:"First Name"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"firstname",id:"firstname",disabled:r,defaultValue:s&&s.contactPerson?s.contactPerson.trim().split(" ")[0]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"surname",className:"form-label small",children:"Surname"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"surname",id:"surname",disabled:r,defaultValue:s&&s.contactPerson?s.contactPerson.trim().split(" ")[1]:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"sms_number",className:"form-label small",children:"SMS Number"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"sms_number",id:"sms_number",disabled:r,defaultValue:s&&s.smsNumber?s.smsNumber:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"other_numbers",className:"form-label small",children:"Other Numbers (comma separated)"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"other_numbers",id:"other_numbers",disabled:r,defaultValue:s&&s.other_numbers?s.other_numbers:"",placeholder:"(comma separated)"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("label",{htmlFor:"email_address",className:"form-label small",children:"Email Address"}),e.jsx("input",{type:"email",className:"form-control form-control-sm w-50 rounded-2",name:"email_address",id:"email_address",disabled:r,defaultValue:s&&s.emailAddress?s.emailAddress:""})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-between align-items-center py-1 px-2 border-bottom",children:[e.jsx("label",{htmlFor:"address",className:"form-label small",children:"Address"}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-50 rounded-2",name:"address",id:"address",disabled:r,defaultValue:s&&s.address?s.address:""})]}),e.jsx("button",{disabled:r,type:"submit",className:"d-block btn btn-info text-white w-100 mt-3",children:r?"Saving...":"Save"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Contact Person: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:s.contactPerson})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{children:"SMS Number: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:s.smsNumber})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Other Numbers: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:s.otherNumbers})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom",children:[e.jsx("div",{children:"Email Address: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:s.emailAddress})]}),e.jsxs("div",{className:"d-flex gap-2 py-1 px-2 border-bottom custom-bg-whitesmoke",children:[e.jsx("div",{children:"Address: "}),e.jsx("div",{className:"flex-grow-1 text-center",children:s.address})]}),e.jsx("div",{className:"mt-4 px-2",children:e.jsx("button",{onClick:()=>c(!0),type:"button",className:"d-block btn btn-info w-100 text-white",children:"Edit"})})]})]})})}function Z({data:t,isCreditorView:a}){return e.jsx(g,{title:a?"forecast outflows":"forecast inflows",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered  mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"0-7 Days"}),e.jsx("th",{children:"8-14 Days"}),e.jsx("th",{children:"15-21 Days"}),e.jsx("th",{children:"21+ Days"}),e.jsx("th",{children:"total"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:t.zeroToSevenDays}),e.jsx("td",{children:t.eightToFourteenDays}),e.jsx("td",{children:t.fourteenToTwentyOneDays}),e.jsx("td",{children:t.twentyOnePlusDays}),e.jsxs("td",{children:["$",t.total]})]})})]})})}function B(t,a,n){const[s,m]=x.useState(t),[h,c]=x.useState(""),[d,o]=x.useState(!1),[r,u]=x.useState("note");function b(p){p.preventDefault(),o(!0),c("");const l=Object.fromEntries(new FormData(p.target).entries());n?l.creditor_id=a.toString():l.client_id=a.toString(),l.reminder_type=r.toUpperCase(),r==="note"&&(l.action_date=new Date().toISOString().split("T")[0]),v.post(reverseUrl("communication_history"),l).then(i=>{m(y=>[...y,{text:i.data.message,actionDone:i.data.action_done,user:i.data.user_name,communicationType:i.data.reminder_type.toLowerCase(),timestamp:i.data.created_at}]),c(""),o(!1)}).catch(i=>{i instanceof _?c(i.response.status===500?`Error: ${i.response.statusText}`:JSON.stringify(i.response.data)):c(i),o(!1)})}return{messages:s,handleSubmit:b,error:h,setError:c,isLoading:d,remainderType:r,setRemainderType:u}}function ee({disabled:t,lease:a,messages:n,clientId:s,isCreditorView:m,creditorId:h}){const{error:c,messages:d,isLoading:o,remainderType:r,setRemainderType:u,handleSubmit:b,setError:p}=B(n,s,m);return e.jsxs(e.Fragment,{children:[e.jsx(L,{isOpen:r==="works",close:()=>u("note"),lease:a,creditorId:h}),e.jsx(g,{noBoundary:!0,title:"communication history",children:e.jsxs("div",{className:"custom-bg-whitesmoke px-5 py-3",children:[e.jsxs("div",{className:"custom-vh-50 custom-overflow-y-auto",children:[d.map((l,i)=>e.jsxs("div",{className:"custom-message py-2 px-3 border shadow-sm mb-3",children:[e.jsx("small",{children:l.text+(l.communicationType.toLowerCase().trim()!=="note"&&l.actionDone?` (action date: ${S(l.actionDone)})`:"")}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end align-items-center text-end gap-2",children:[e.jsx("small",{className:"smallest",children:e.jsxs("b",{children:[l.user,l.communicationType&&" | "+l.communicationType.toLowerCase()]})}),e.jsx("small",{className:"text-success smallest",children:S(l.timestamp)})]})]},i)),d.length===0&&e.jsxs("small",{className:"h-100 text-grey d-flex justify-content-center align-items-center text-center",children:["No communication ",e.jsx("br",{})," history"]})]}),e.jsxs("form",{onSubmit:b,className:"border-top border-4 w-100 pt-3",children:[c&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>p(""),className:"btn-close btn-sm"}),w.truncate(c,{length:150})]}),e.jsx("textarea",{rows:2,name:"message",id:"message",placeholder:"Type message here...",className:"d-block w-100 p-2 custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0,disabled:o}),e.jsxs("div",{className:"d-flex justify-content-center pt-2 gap-2 align-items-center",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"note",id:"reminder_type-note",checked:r==="note",onChange:l=>u(l.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-note",children:"Note"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"sms",id:"reminder_type-sms",checked:r==="sms",onChange:l=>u(l.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-sms",children:"SMS"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"email",id:"reminder_type-email",checked:r==="email",onChange:l=>u(l.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-email",children:"Email"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"reminder",id:"reminder_type-reminder",checked:r==="reminder",onChange:l=>u(l.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-reminder",children:"Reminder"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"reminder_type",disabled:o,value:"works",id:"reminder_type-works",checked:r==="works",onChange:l=>u(l.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:"reminder_type-works",children:"Works"})]})]}),r!=="note"&&r!=="works"&&e.jsxs("div",{className:"d-flex my-2 gap-2 align-items-center justify-content-center",children:[e.jsx("label",{htmlFor:"action_date",className:"small d-block text-nowrap form-label",children:`${r==="reminder"?"Show":"Send"} ${r} on:`}),e.jsx("input",{min:new Date().toISOString().split("T")[0],type:"date",className:"form-control form-control-sm rounded-4",name:"action_date",id:"action_date",required:!0})]}),e.jsx("button",{disabled:o||t,type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:o?"Submiting...":"Submit"})]})]})})]})}function q(t,a,n,s,m,h){const[c,d]=x.useState(t),[o,r]=x.useState(""),[u,b]=x.useState(!1),[p,l]=x.useState([]);function i(){b(!0),r("");const N={plans:p.map(f=>E(k(k({},f),s?{creditor_id:a.toString()}:{client_id:a.toString()}),{spoke_with:s?m:f.spoke_with,lease_id:h}))};v.post(reverseUrl("payment_plans"),N).then(f=>{l([]),r(""),b(!1),n()}).catch(f=>{f instanceof _?r(f.response.status===500?`Error: ${f.response.statusText}`:JSON.stringify(f.response.data)):r(f),l([]),b(!1)})}function y(N){l(f=>[...f,N])}function j(){l([])}return{paymentPlans:c,newPaymentPlans:p,addNewPaymentPlan:y,confirmNewPaymentPlans:i,clearNewPaymentPlans:j,error:o,setError:r,isLoading:u}}function J({addNewPaymentPlan:t,isCreditorView:a}){const[n,s]=x.useState("");function m(c){let d=c.target.value;if(d.includes(".")){const[o,r]=d.split(".");r.length>2&&(d=`${o}.${r.substring(0,2)}`)}s(d)}function h(c){c.preventDefault();const d=Object.fromEntries(new FormData(c.target).entries());t(d)}return e.jsx(g,{title:"payment plans",children:e.jsxs("form",{onSubmit:h,className:"p-3",children:[!a&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"spoke_with",className:"text-nowrap",children:"Person spoken with:"}),e.jsx("input",{type:"text",name:"spoke_with",id:"spoke_with",placeholder:"Person spoken with here",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"expected_pay_date",className:"text-nowrap",children:"Expected Pay Date:"}),e.jsx("input",{type:"date",name:"expected_pay_date",id:"expected_pay_date",className:"custom-form-control border-0 custom-pointer border-bottom border-bottom-3 border-dark",required:!0,defaultValue:new Date().toISOString().split("T")[0],min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-5 mb-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-nowrap",children:"Amount ($):"}),e.jsx("input",{min:0,type:"number",step:"0.01",name:"amount",id:"amount",value:n,onChange:m,placeholder:"Amount in $",className:"custom-form-control border-0 border-bottom border-bottom-3 border-dark",required:!0})]}),e.jsx("button",{type:"submit",className:"d-block btn btn-info w-100 mt-4 text-white",children:"Add to payment plan"})]})})}function R({paymentPlans:t,isCreditorView:a}){return e.jsx(g,{title:a?"active payment plans":"payment plans",children:e.jsx("div",{className:"custom-mx-h-15 overflow-auto",children:e.jsxs("table",{className:"table table-sm table-responsive table-bordered mb-0",children:[e.jsx("thead",{className:"custom-bg-grey-2 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan ID"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Date"})]})}),e.jsxs("tbody",{children:[t.map((n,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.id||s}),e.jsx("td",{children:n.amount}),e.jsx("td",{children:F(n.date)})]},n.id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center small text-grey py-3",children:"No payment plans"})})]})]})})})}function V({newPaymentPlans:t,confirmNewPaymentPlans:a,clearNewPaymentPlans:n,error:s,setError:m,isLoading:h,isCreditorView:c}){return e.jsx(g,{title:"plan details",children:e.jsxs("div",{className:"p-3 pb-2",children:[e.jsxs("div",{className:"custom-h-07 overflow-auto",children:[t.map((d,o)=>e.jsx("div",{className:"p-1 small border-bottom",children:`${d.spoke_with||""} promised to pay USD${d.amount} on ${F(d.expected_pay_date)}`},o)),t.length===0&&e.jsx("div",{className:"text-center small text-grey py-3",children:"No new payment plans"})]}),e.jsxs("div",{className:"pt-2 bg-white",children:[s&&e.jsxs("p",{className:"d-flex align-items-start gap-1 small text-danger",children:[e.jsx("button",{type:"button",onClick:()=>m(""),className:"btn-close btn-sm"}),w.truncate(s,{length:150})]}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"d-block btn btn-info w-100 text-white",disabled:h||!t.length,children:h?"Saving...":"Save plan"}),e.jsx("button",{type:"button",onClick:n,className:"d-block btn btn-dark w-100 text-white",disabled:h||!t.length,children:"Clear All"})]})]})]})})}function te({isCreditorView:t,paymentPlans:a,clientId:n,refreshClientViewData:s,creditorName:m,leaseId:h}){const{paymentPlans:c,newPaymentPlans:d,addNewPaymentPlan:o,confirmNewPaymentPlans:r,clearNewPaymentPlans:u,error:b,setError:p,isLoading:l}=q(a,n,s,t,m,h);return e.jsxs(e.Fragment,{children:[e.jsx(J,{isCreditorView:t,addNewPaymentPlan:o,clientId:n}),e.jsx(V,{isCreditorView:t,newPaymentPlans:d,confirmNewPaymentPlans:r,clearNewPaymentPlans:u,error:b,setError:p,isLoading:l}),e.jsx(R,{isCreditorView:t,paymentPlans:c})]})}export{Q as A,Y as C,X as D,Z as F,te as P,ee as a};
