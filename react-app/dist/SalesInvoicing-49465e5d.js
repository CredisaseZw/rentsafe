import{r as c,u as k,b as S,d as E,_ as w,j as e}from"./media/main-925d7cc6.js";import{u as q,f as D}from"./index-cbaa8a42.js";import{S as B}from"./SearchBar-3aa5055b.js";import{c as G,C as Z,I as $,L as K}from"./Layout-55074516.js";import"./formatting-fad57ba1.js";import"./lodash-8af9eb04.js";import"./assertThisInitialized-3be3daa4.js";import"./removeClass-13a0d155.js";import"./Modal-59afdcb2.js";import"./index-26a676b8.js";import"./MultipleUpload-f8b77316.js";import"./search-3f56cc7c.js";function Q(){const[s,a]=c.useState([]),[d,t]=c.useState(!1),{url:l}=k();function h(){t(!0),S.get("/accounting/proforma-invoices/").then(r=>{console.log(r),a(r.data)}).catch(r=>{console.log(r)}).finally(()=>t(!1))}c.useEffect(()=>{h()},[l]);function p(r){r.preventDefault();const b=r.target.year.value,j=r.target.month.value,u=new URL(l);u.searchParams.set("year",b),u.searchParams.set("month",j),E.Inertia.replace(u.href,{preserveState:!0})}return{loading:d,invoiceList:s,handleFilters:p}}function X(s,a){const[d,t]=c.useState(null),[l,h]=c.useState(!1),[p,r]=c.useState(!1),[b,j]=c.useState("USD"),[u,C]=c.useState([]),[F,i]=c.useState([]),[T,_]=c.useState(0),[v,N]=c.useState(0),[f,g]=c.useState([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]);c.useEffect(()=>{if(s){const n={document_number:s.document_number,bill_to:s.bill_to,address:s.address,phone:s.phone,email:s.email,vat_no:s.vat_no,tin:s.tin,currency:s.currency,monthly_rental:s.monthly_rental};t(n),j(n.currency),g([n.monthly_rental])}},[s]),c.useEffect(()=>{L(),V()},[]);function L(){S.get("/accounting/items/").then(n=>{C(n.data)}).catch(n=>{console.log(n)})}function V(){S.get("/accounting/vat-settings/").then(n=>{i(n.data)}).catch(n=>{console.error(n)})}function A(){g([...f,{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}])}function I(n){const o=f.filter((y,m)=>m!==n);g(o)}function U(){r(!0)}function M(){r(!1)}function Y(n){if(n.preventDefault(),!f.length){w.error("Please add at least one item");return}const o=Object.fromEntries(new FormData(n.target).entries());o.items=f.map(m=>{const x={...m};return x.vat=(parseFloat(x.vat)||0)/100*(parseFloat(x.price)||0)*(parseFloat(x.qty)||0),delete x.static,x}),Object.keys(O).forEach(m=>o[m]=O[m]),o.invoiceTotal+=Number(v),o.discount=Number(v),a?console.log("Proforma Invoice Data: ",o):console.log(o);const y=a?"/accounting/proforma-invoices/":"/accounting/invoices/";S.post(y,o).then(m=>{console.log(m),m.status===201?(w.success(q(m)),g([{static:!1,sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),N(0),_(x=>x+1)):w.error(q(m))}).catch(m=>{console.error(m),w.error(q(m))})}function J(n){g([{sales_code:"",sales_item:"",price:"",qty:"",vat:"",total:""}]),j(n.target.value),_(o=>o+1)}const O=f?.reduce((n,o)=>{if(!o)return n;const y=parseFloat(o.qty)||0,m=(parseFloat(o.vat)||0)/100,x=parseFloat(o.price)||0;return n.totalExcludingVat+=x*y,n.vatTotal+=x*m*y,n.invoiceTotal+=parseFloat(o.total)||0,n},{totalExcludingVat:0,vatTotal:0,invoiceTotal:0});function z(n){let o=parseFloat(n.target.value)||0;o>0?w.error("Discount should be input as a negative value"):N(o)}return{key:T,show:p,items:f,totals:O,discount:v,currency:b,isLoading:l,salesCodes:u,taxConfigs:F,invoiceData:d,addRow:A,setItems:g,onSubmit:Y,removeRow:I,handleShow:U,handleClose:M,setDiscount:N,changeCurrency:J,handleDiscount:z}}function H(){const[s,a]=c.useState("INDIVIDUAL");return e.jsxs("div",{className:"d-flex",children:[e.jsxs("select",{className:"me-1 px-1 border fw-light rounded-2",value:s,name:"customer_type",id:"customer_type",onChange:d=>a(d.target.value),children:[e.jsx("option",{value:"INDIVIDUAL",children:"Individual"}),e.jsx("option",{value:"COMPANY",children:"Company"})]}),e.jsx("div",{className:"custom-w-3",children:e.jsx(G,{extraProps:{placeholder:"Customer Name...",required:!0,id:"customer_id",name:"customer_id",className:"w-100"},defaultValue:null,isDisabled:s==="",useAlternateFetchOptions:{type:s.toLowerCase()}},s)})]})}function R({invoice:s,triggerClassname:a,triggerChildren:d,isProforma:t}){const{key:l,show:h,items:p,totals:r,discount:b,currency:j,isLoading:u,salesCodes:C,taxConfigs:F,invoiceData:i,addRow:T,setItems:_,onSubmit:v,removeRow:N,handleShow:f,handleClose:g,changeCurrency:L,handleDiscount:V}=X(s,t);return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:a||"btn btn-info text-white",onClick:f,children:d||e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"New"]})}),e.jsx(Z,{size:"xl",show:h,handleClose:g,title:t?"PROFORMA":"FISCAL TAX INVOICE",children:e.jsxs("form",{className:"py-3",onSubmit:v,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"row row-cols-2 pb-3 text-nowrap",children:[e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"document_number",className:"form-label",children:"Document Number:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"document_number",id:"document_number",placeholder:"e.g 112108",readOnly:!!i?.document_number,defaultValue:i?.document_number})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center justify-content-between",children:[e.jsx("label",{htmlFor:"bill_to",className:"form-label",children:"Bill To:"}),i?.bill_to?e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",name:"customer_id",id:"customer_id",readOnly:!0,value:i?.bill_to}):e.jsx(H,{})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"Address:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"address",id:"address",placeholder:"Address...",defaultValue:i?.address,readOnly:!!i?.address})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"phone",className:"form-label",children:"Phone:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"phone",id:"phone",placeholder:"Phone...",defaultValue:i?.phone,readOnly:!!i?.phone})]})]}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"email",id:"email",placeholder:"Email...",defaultValue:i?.email,readOnly:!!i?.email})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"vat_no",className:"form-label",children:"VAT No.:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"vat_no",id:"vat_no",placeholder:"VAT No....",defaultValue:i?.vat_no,readOnly:!!i?.vat_no})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"tin",className:"form-label",children:"TIN:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"tin",id:"tin",placeholder:"TIN...",defaultValue:i?.tin,readOnly:!!i?.tin})]}),e.jsxs("div",{className:"mb-3 d-flex gap-4 align-items-center",children:[e.jsx("label",{htmlFor:"date",className:"form-label",children:"Date:"}),e.jsx("input",{className:"form-control form-control-sm border-0 border-bottom flex-fill border-3 ",required:!0,name:"date",defaultValue:new Date().toISOString().split("T")[0],max:new Date().toISOString().split("T")[0],min:new Date(new Date().setDate(1)).toISOString().split("T")[0],id:"date",type:"date",readOnly:!!i})]})]})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive",children:[e.jsxs("thead",{className:"text-center text-nowrap",children:[e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:2,className:"text-danger",children:"Currency"}),e.jsx("th",{colSpan:2,className:"bg-danger text-white",children:e.jsx("div",{children:e.jsx("select",{value:j,name:"invoice_currency",id:"invoice_currency",onChange:L,children:i?.currency?e.jsx("option",{value:i.currency,children:i.currency}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"USD",children:"United States Dollar (USD)"}),e.jsx("option",{value:"ZIG",children:"Zimbabwean Dollar (ZIG)"})]})})})})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Sales Code"}),e.jsx("th",{children:"Sales Item"}),e.jsx("th",{children:"Price(Inc)"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"VAT"}),e.jsx("th",{children:"Total (Inc)"})]})]}),e.jsx("tbody",{children:p.map((A,I)=>e.jsx($,{item:A,index:I,currency:j,setItems:_,removeRow:N,isLoading:u,salesCodes:C,taxConfigs:F,itemsLength:p.length},I+"-"+l))}),e.jsxs("tfoot",{className:"text-end",children:[e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:e.jsxs("div",{className:"w-100 gap-3 align-items-center d-flex justify-content-between",children:[e.jsxs("button",{disabled:u,type:"button",className:"btn btn-sm btn-outline-info",onClick:T,children:[e.jsx("i",{className:"leading-icon material-icons",children:"add"}),"Add Row"]}),"Total (Excluding VAT)"]})}),e.jsx("td",{children:e.jsx("span",{children:r.totalExcludingVat})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"Discount"}),e.jsx("td",{children:e.jsx("input",{style:{width:"150px"},className:"form-control form-control-sm d-inline-block text-end",type:"number",name:"discount",id:"discount",vlaue:b,max:0,step:.001,onChange:V,readOnly:u})})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsx("td",{colSpan:5,children:"VAT Total"}),e.jsx("td",{children:r.vatTotal})]}),e.jsxs("tr",{children:[e.jsx("td",{}),e.jsxs("td",{colSpan:5,children:["Invoice Total ",j]}),e.jsx("td",{children:r.invoiceTotal+b})]})]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{disabled:u,className:"btn btn-info text-white",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-grow spinner-grow-sm"}),e.jsx("span",{className:"ms-2",children:"Submitting.."})]}):"Submit"})})]})})]})}function W(){const{loading:s,invoiceList:a,handleFilters:d}=Q();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:d,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((t,l)=>e.jsx("option",{value:new Date().getFullYear()-l,children:new Date().getFullYear()-l},l))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(B,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Proforma Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(R,{isProforma:!0})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):a?.length?a?.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"ps-3",children:t.currency}),e.jsx("td",{className:"ps-3 text-end",children:t.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}function ee(s){const[a,d]=c.useState(!1),[t,l]=c.useState(s?.map(h=>({id:h.id,date_created:D(new Date),customer_acc:"",customer:h.tenant_name,document_number:"",bill_to:h.tenant_name,address:h.address,phone:"",email:"",vat_no:"",tin:"",currency:h.lease_currency_type,monthly_rental:{static:!0,sales_code:"",sales_item:`"Rent - ${h.payment_period_start} ${new Date().getMonth()+1}`,price:h.owing_amount,qty:1,vat_id:"",total:h.owing_amount}})));return{loading:a,invoiceList:t}}function te({recurringInvoices:s}){const{loading:a,invoiceList:d}=ee(s);return e.jsx("div",{children:e.jsx("div",{children:e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsxs("thead",{className:"position-sticky c-table-top shadow-sm bg-white c-z-5",children:[e.jsx("tr",{children:e.jsx("th",{colSpan:6,className:"p-0",children:e.jsx("div",{className:" bg-danger text-white text-center p-2",children:"Recurring Invoices"})})}),e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Invoice Date"}),e.jsx("th",{children:"Customer Acc"}),e.jsx("th",{children:"Customer Name"}),e.jsx("th",{}),e.jsx("th",{})]})]}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):d?.length?d?.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer_acc||""}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"p-0 ",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx(R,{invoice:t,triggerChildren:"Generate",triggerClassname:"btn btn-sm w-100  justify-content-center btn-danger"})})}),e.jsx("td",{className:"p-0",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-dark text-white",children:e.jsx("span",{children:"-"})})})})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})})})}function se(){const[s,a]=c.useState([]),[d,t]=c.useState(!1),{url:l}=k();function h(){t(!0),S.get("/accounting/invoices/").then(r=>{console.log(r),a(r.data),t(!1)}).catch(r=>{console.log(r),t(!1)})}c.useEffect(()=>{h()},[l]);function p(r){r.preventDefault();const b=r.target.year.value,j=r.target.month.value,u=new URL(l);u.searchParams.set("year",b),u.searchParams.set("month",j),E.Inertia.replace(u.href,{preserveState:!0})}return{loading:d,invoiceList:s,handleFilters:p}}function ne(){const{loading:s,invoiceList:a,handleFilters:d}=se();return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center gap-4 mb-5",children:[e.jsxs("form",{onSubmit:d,className:"d-flex border  gap-2 align-items-center",children:[e.jsx("select",{className:"form-select",name:"year",id:"year",required:!0,defaultValue:new Date().getFullYear(),children:new Array(new Date().getFullYear()-2020).fill(0).map((t,l)=>e.jsx("option",{value:new Date().getFullYear()-l,children:new Date().getFullYear()-l},l))}),e.jsxs("select",{className:"form-select",name:"month",id:"month",required:!0,defaultValue:(new Date().getMonth()+1).toString(),children:[e.jsx("option",{value:"1",children:"January"}),e.jsx("option",{value:"2",children:"February"}),e.jsx("option",{value:"3",children:"March"}),e.jsx("option",{value:"4",children:"April"}),e.jsx("option",{value:"5",children:"May"}),e.jsx("option",{value:"6",children:"June"}),e.jsx("option",{value:"7",children:"July"}),e.jsx("option",{value:"8",children:"August"}),e.jsx("option",{value:"9",children:"September"}),e.jsx("option",{value:"10",children:"October"}),e.jsx("option",{value:"11",children:"November"}),e.jsx("option",{value:"12",children:"December"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"btn btn-success ",children:"Submit"})})]}),e.jsx("div",{className:"custom-mx-w-4",children:e.jsx(B,{placeholder:"Search...",searchBy:"invoice"})})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"position-relative text-center mb-2 p-2 mb-0",children:["Invoice List",e.jsx("div",{className:"position-absolute top-0 end-0",children:e.jsx(R,{})})]}),e.jsxs("table",{className:"table table-sm table-bordered table-responsive bg-white",children:[e.jsx("thead",{className:"position-sticky c-table-top text-white bg-info shadow-sm c-z-5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-3",children:"Inv. #"}),e.jsx("th",{children:"Date Created"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Currency"}),e.jsx("th",{className:"text-end",children:"Invoice Total"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-3 bg-white d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-info",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})}):a?.length?a?.map((t,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"ps-3",children:t.id}),e.jsx("td",{className:"ps-3",children:t.date_created&&D(t.date_created)}),e.jsx("td",{className:"ps-3",children:t.customer}),e.jsx("td",{className:"ps-3",children:t.currency}),e.jsx("td",{className:"ps-3 text-end",children:t.total.toFixed(2)}),e.jsx("td",{className:"d-flex justify-content-center align-items-center p-1",children:e.jsx("button",{className:"btn btn-sm w-100 justify-content-center btn-info text-white",children:"View"})})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx("div",{className:"custom-h-2 bg-white d-flex justify-content-center align-items-center",children:"Nothing to show"})})})})]})]})]})}const P=[{key:"Invoice",Content:ne},{key:"Recurring",Content:te},{key:"Proforma",Content:W}];function ae({invoice_list:s}){const[a,d]=c.useState(P[0]);return e.jsxs("div",{children:[e.jsx("div",{className:"d-flex gap-2 mb-3",children:P.map(t=>e.jsx("button",{onClick:()=>d(t),className:`btn ${a===t?"btn-info text-white":"border border-2"}`,children:t.key},t.key))}),e.jsx("div",{className:"p-3",children:e.jsx(a.Content,{...a.key==="Recurring"?{recurringInvoices:s}:{}})})]})}ae.layout=s=>e.jsx(K,{children:s,title:"Sales Categories"});export{ae as default};
